---
show: step
version: 1.0
enable_checker: true
---

# è¯­æ³• html ç”Ÿæˆ
## å›å¿†

- ç»ˆäºå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ„å»ºä¸€æ£µetreeäº†
- é€šè¿‡etree.HTML()å‡½æ•°å°†ç½‘é¡µæºæ–‡ä»¶è¿›è¡Œparse(è¯­æ³•åˆ†æ)ç”Ÿæˆä¸€æ£µetree
- é€šè¿‡etree.HTMLParser()å‡½æ•°è®¾ç½®parser
		- parser = etree.HTMLParser(remove_blank_text=True)
	- ç”¨parserä½œä¸ºç”Ÿæˆæ ‘çš„æ—¶å€™çš„å‚æ•°
			- root = etree.HTML("<root>  <a/>   <b>  </b>     </root>", parser)
	- parserå¯ä»¥æ§åˆ¶è¯­æ³•
- etee.indent()å‡½æ•°å¯ä»¥æ§åˆ¶etreeè¾“å‡ºçš„ç¼©è¿›
	- etree.indent(root, space="\t")
	- etree.tostring(root)
- æˆ‘èƒ½ç”¨å‰é¢çš„requestsçˆ¬åˆ°çš„å­—ç¬¦ä¸²ç”Ÿæˆetreeå…ƒç´ ä¹ˆï¼Ÿ
	- é€šè¿‡requestè·å¾—ç½‘é¡µæºæ–‡ä»¶
	- é€šè¿‡etreeæŠŠæºæ–‡ä»¶è½¬åŒ–ä¸ºä¸€æ£µetreeçš„å…ƒç´ æ ‘
- å°±æ˜¯æŠŠ
	- requestå¾—åˆ°çš„responseçš„content
	- å½“åšetree.HTML()éœ€è¦çš„å‚æ•°
	- å¯¹æ¥èµ·æ¥ï¼Œå¯ä»¥ä¹ˆï¼ŸğŸ¤”
- è¿˜è®°å¾—é‚£ä¸ªç½‘é¡µæ–‡ä»¶æ€ä¹ˆæ¥çš„ä¹ˆï¼Ÿ
- oeasy.html

### å‡†å¤‡ç¯å¢ƒ

- æŠŠgithubä¸Šçš„ç½‘é¡µç´ ææ‹·è´ä¸‹æ¥
- å¹¶æ”¾åˆ°åˆé€‚ä½ç½®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634439171366)

- å¯åŠ¨nginx
- æµè§ˆå™¨ä¸­ç¡®è®¤

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634435068115)t

### æ•´åˆ
- requests

```python
import requests
response = requests.get("http://localhost/oeasy.html")
b_html = response.content
s_html = response.text
```

### etree

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634436427443)

- å…¶å®ä»”ç»†çœ‹å¯ä»¥å‘ç°broken_html å…¶å®æ˜¯æ··ä¹±çš„htmlæºä»£ç 
- ç¼ºå°‘ä¸€äº›ç»“æŸæ ‡ç­¾
- ä½†æ˜¯å¹¶ä¸å¦¨ç¢æˆ‘ä»¬ç”Ÿæˆä¸€æ£µå®Œæˆçš„etree
- è¿™ä¸ªäº‹æƒ…å°±æ˜¯libxml2.6.21 ä»¥ä¸Šçš„åº“å¸®åŠ©æˆ‘ä»¬å®Œæˆçš„
- åŒ…æ‹¬è¡¥å……å¤´å°¾æ ‡ç­¾

### æ•´åˆ

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.text
et_html = etree.HTML(s_html)
print(etree.tostring(et_html,pretty_print=True).decode("utf-8"))
```



### æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿ
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634439859969)

- æˆ‘å€’æ˜¯å¯ä»¥ç”Ÿæˆetreeäº†
- ä½†æ˜¯æ•´ä¸ªç½‘é¡µéƒ½ä¸‹æ¥äº†
- æˆ‘éœ€è¦çš„åªæ˜¯å…¶ä¸­çš„ä¸‰ç§é£Ÿç‰©
	- è±†æ±
	- æŠ˜è€³æ ¹
	- ç¾Šç˜ªæ±¤
- å¦‚ä½•ç­›é€‰å‘¢ï¼Ÿ
- xpath

### å›å¿†xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630506661307)

```python
build_text_list = etree.XPath("//text()") # lxml.etree only!
print(build_text_list(et_html))
```



### å°è¯•é€‰æ‹©

```python
import requests
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.text
et_html = etree.HTML(s_html)
food = et_html.xpath("/html/body/ul/li")
print(type(food))
print(food)
```

- xpathé€‰æ‹©çš„æ˜¯
- htmlä¸‹é¢çš„
- bodyä¸‹é¢çš„
- ulä¸‹é¢çš„li

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634446900421)

- ç¡®å®æ‰¾åˆ°äº†ä¸€ä¸ªåˆ—è¡¨
- è¿™ä¸ªåˆ—è¡¨é‡ŒåŒ…å«ä¸‰ä¸ªli

### ä¹˜èƒœè¿½å‡»

```python
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.content
et_html = etree.HTML(s_html)
food = et_html.xpath("//html/body/ul/li")
print(food)
for element in food:
    print(element.text)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634446957236)

- è¯•éªŒæˆåŠŸ
- æŠŠè¿™ä¸ªä¸œè¥¿å†™æˆä¸€ä¸ªpyæ–‡ä»¶

### pyæ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630507176668)

## æ€»ç»“

- æŠŠå‰é¢çš„requestså’Œè¿™ä¸ªetreeç»“åˆäº†
	- é€šè¿‡requestè·å¾—ç½‘é¡µçš„response
	- etreeé€šè¿‡HTMLå‡½æ•°æŠŠä»–è½¬åŒ–ä¸ºä¸€æ£µetreeæ ‘
	- é€šè¿‡xpathç­›é€‰å‡ºèŠ‚ç‚¹
	- é€šè¿‡å¾ªç¯éå†èŠ‚ç‚¹è¿›è¡Œè¾“å‡º
- æµç¨‹è·‘èµ·æ¥äº†
- ä½†æ˜¯è¿™ä¸ªxpathæœ‰ç‚¹å¤æ‚
- è¦ä»å¤´åˆ°å°¾å†™å¾—è¿™ä¹ˆéº»çƒ¦ä¹ˆï¼Ÿ
- æœ‰ä»€ä¹ˆæŠ€å·§å—ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
