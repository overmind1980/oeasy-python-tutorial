---
show: step
version: 1.0
enable_checker: true
---

# flask æœ€å°åº”ç”¨

## å›å¿†ä¸Šæ¬¡

- ä¸Šæ¬¡ äº†è§£åˆ° `è·¯ç”±`
	- ç”¨è£…é¥°å™¨ å£°æ˜url
	- å† å°†è·¯ç”± å°è£…æˆ å‡½æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250621-1750483352166) 

- æœåŠ¡å™¨ éƒ½æ³¨å†Œäº† `å“ª`äº›è·¯ç”± å‘¢ï¼Ÿ

### æ¢å¤ç¯å¢ƒ

- é¦–å…ˆ è¦ æ¢å¤ ä¸Šæ¬¡çš„ ç¯å¢ƒ

```
mkdir myproject
cd myproject
vi app.py
```

- ç¼–è¾‘app.py


```
from flask import Flask

app = Flask(__name__)
@app.route('/')
def index():
    return 'Index Page'

@app.route('/hello')
def hello():
    return 'Hello, World'

if __name__ == "__main__":
    app.run(debug=True,host="0.0.0.0",port=8081)
```

### è®¿é—®

- åå°è¿è¡Œapp å¹¶æµè§ˆ

```
nohup python3 app.py >> flask.log 2>&1 &
firefox http://127.0.0.1:8081/hello http://127.0.0.1:8081/ &
```

- ä¸¤ä¸ªè·¯ç”±éƒ½èƒ½è®¿é—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568419992) 

- å¯ä»¥è®¿é—®åŠ¨æ€çš„åœ°å€å—ï¼Ÿ

### åŠ¨æ€åœ°å€

- pythonç½‘è¯¾åœ°å€
	- https://www.lanqiao.cn/courses/3584
	- 3584 å°±æ˜¯ è¯¾ç¨‹id

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568484569) 

- å¦‚æœæ”¹æˆ3781
	- å°±å˜æˆäº† å¦ä¸€é—¨è¯¾ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568566597) 

- è¿˜æœ‰ä»€ä¹ˆç±»ä¼¼çš„å—ï¼Ÿ

### ç”¨æˆ·id

- è“æ¡¥ç”¨æˆ·ç½‘å€
	- https://www.lanqiao.cn/users/1190679/?tab=2
	- å…¶ä¸­ 1190679 å°±æ˜¯ oeasyçš„ ç”¨æˆ·id

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568622542)

- æ¯ä¸ªç½‘ç«™ éƒ½æœ‰æŸ¥çœ‹ç”¨æˆ·idçš„é¡µé¢
	- æ ¹æ®ç”¨æˆ·id å¯ä»¥ç”Ÿæˆ é¡µé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568795848) 

- å¦‚ä½•æ ¹æ®urlä¸­çš„åŠ¨æ€ä¿¡æ¯ç”Ÿæˆç½‘é¡µå‘¢ï¼Ÿ

### æé—®ai

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750568987283) 

- flaskä¸­ åŠ¨æ€è·¯ç”±çš„ å®˜ç½‘é“¾æ¥
	- https://dormousehole.readthedocs.io/en/latest/quickstart.html#id5

### urlä¸­çš„å˜é‡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749357255207) 

- å…·ä½“è¯•è¯•

### åŠ¨æ€è·¯ç”±

- urlä¸­ çš„ name
	- å¯ä»¥æ˜¯ ä»»æ„å­—ç¬¦ä¸²
	- æ‰€ä»¥æ˜¯ åŠ¨æ€çš„
	- åŠ¨æ€è·¯å¾„ çš„ è·¯ç”±

```
from flask import Flask
from markupsafe import escape

app = Flask(__name__)

@app.route("/<name>")
def hello(name):
    return f"Hello, {escape(name)}!"

if __name__ == "__main__":
    app.run(debug=True,host="0.0.0.0",port=8081)
```

- ç”±äº æœåŠ¡å™¨æ˜¯ åå°è¿è¡Œçš„ debugæ¨¡å¼
	- ä¿å­˜æ–‡ä»¶ ä¼šè‡ªåŠ¨åŠ è½½ä»£ç 

### æµè§ˆç½‘é¡µ

```
firefox http://127.0.0.1:8081/oeasy &
```

- è®¿é—®æˆåŠŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749357999786) 

- å¯ä»¥æ ¹æ® name åšç‚¹ä»€ä¹ˆå—ï¼Ÿ

### è¿›è¡Œåˆ¤å®š

- æ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦è¿›è¡Œåˆ¤å®š

```
from flask import Flask
from markupsafe import escape

app = Flask(__name__)

@app.route("/<name>")
def hello(name):
    len_of_name = len(name)
    if len_of_name > 5:
        return "name is long"
    elif len_of_name <= 4:
        return "name is short"
    else:
        return f"Hello, {escape(name)}!"

if __name__ == "__main__":
    app.run(debug=True,host="0.0.0.0",port=8081)
```

### è§‚å¯Ÿ

```
firefox http://127.0.0.1:8081/oeasyo
```

- æ•ˆæœè®¿é—® å¤ªé•¿

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749358739931) 

### è§‚å¯Ÿ2

```
firefox http://127.0.0.1:8081/o &
```

- å¤ªçŸ­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749358723525) 

### è§‚å¯Ÿ3

```
firefox http://127.0.0.1:8081/oeasy &
```

- é•¿çŸ­åˆé€‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749358713266) 

- ä¸ºä»€ä¹ˆè¦æœ‰åŠ¨æ€è·¯ç”±å‘¢ï¼Ÿ

### åŠ¨æ€è·¯ç”±çš„æ„ä¹‰

- æˆ‘ä»¬çœ‹ è§†é¢‘çš„æ—¶å€™
	- è¦æ˜ç¡® æŸä¸ªBVå·
	- æ ¹æ®BVå· è®¿é—®è§†é¢‘ç›¸å…³çš„ å†…å®¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749358848261) 

- BVå· å°±æ˜¯ åŠ¨æ€è·¯ç”±

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/820494/uid1190679-20250608-1749358938952) 

- åŠ¨æ€è·¯ç”±å˜é‡ è¿˜è®¾ç½® ç±»å‹å—ï¼Ÿ 

### å¤šæ¡åŠ¨æ€è·¯ç”±

```
from flask import Flask
from markupsafe import escape

app = Flask(__name__)

@app.route('/user/<username>')
def show_user_profile(username):
    # show the user profile for that user
    return f'User {escape(username)}'

@app.route('/post/<int:post_id>')
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return f'Post {post_id}'

@app.route('/path/<path:subpath>')
def show_subpath(subpath):
    # show the subpath after /path/
    return f'Subpath {escape(subpath)}'


if __name__ == "__main__":
    app.run(debug=True,host="0.0.0.0",port=8081)
```

- è¿™é‡Œæœ‰ä¸‰ç±»è·¯ç”±

|è·¯ç”±ç±»å‹|è·¯ç”±å®šä¹‰è¯­æ³•|åŒ¹é…è§„åˆ™è¯´æ˜|ç¤ºä¾‹ URL åŠå¯¹åº”å¤„ç†é€»è¾‘|
|---|---|---|---|
|å­—ç¬¦ä¸²åœ°å€ï¼ˆæ— çº¦æŸï¼‰|/user/<username>|åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ï¼ˆé™¤ / å¤–  ï¼‰|å¦‚ localhost:5000/user/oeasy ï¼Œusername ä¸º oeasy ï¼Œè¿”å› User oeasy|
|æ•´æ•°ç±»å‹çº¦æŸ|/post/<int:post_id>|ä»…åŒ¹é…æ•´æ•°å½¢å¼å†…å®¹|å¦‚ localhost:5000/post/123 ï¼Œpost_id ä¸º 123 ï¼Œè¿”å› Post 123|
|è·¯å¾„ç±»å‹çº¦æŸ|/path/<path:subpath>|åŒ¹é…åŒ…å« / çš„å®Œæ•´è·¯å¾„ç‰‡æ®µ|å¦‚ localhost:5000/path/a/b/c ï¼Œsubpath ä¸º a/b/c ï¼Œè¿”å› Subpath a/b/c|

### ä¸‰ç±»è·¯ç”±

1. å­—ç¬¦ä¸²åœ°å€

```
@app.route('/user/<username>')
def show_user_profile(username):
    # show the user profile for that user
    return f'User {escape(username)}'
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230122-1674394997027)

2. æ•´å‹æ•°å­—

```
@app.route('/post/<int:post_id>')
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return f'Post {post_id}'
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230122-1674395008430)

3. å­è·¯å¾„åœ°å€

```
@app.route('/path/<path:subpath>')
def show_subpath(subpath):
    # show the subpath after /path/
    return f'Subpath {escape(subpath)}'
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230122-1674395022882)

- å¯ä»¥çœ‹çœ‹ç°åœ¨ æœ‰`å“ªäº›`è·¯ç”±å— ï¼Ÿ

### urlæ˜ å°„è§„åˆ™

- ä¿®æ”¹ ä¸»ç¨‹åº
	- è¾“å‡º è·¯ç”±åœ°å›¾
	- url_map

```
if __name__ == "__main__":
	print(app.url_map)
	app.run(debug=True,host="0.0.0.0",port=8081)
```

- åå°è‡ªåŠ¨æ›´æ–°å
	- è¿™æ¡è¾“å‡ºè¯­å¥èƒ½çœ‹åˆ°å—ï¼Ÿ

```
tail -n 5 flask.log
```

- åœ¨ifä¸­çš„è¿™å¥è¾“å‡ºæ²¡æœ‰è¿è¡Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750598946683) 

- éœ€è¦é‡å¯WebæœåŠ¡å™¨

### æ‰¾åˆ°è¿›ç¨‹pid

```
lsof -i:8081
```

- æ‰¾åˆ°å ç”¨ 8081çš„è¿›ç¨‹pid
	- 381
	- 743

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750599036871) 

- ç»“æŸè¿›ç¨‹

```
kill -9 381  743
```

- æˆåŠŸç»“æŸflask webæœåŠ¡å™¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750599244930) 

### å†å¯åŠ¨

- é‡å¯ æœåŠ¡å™¨

```
nohup python3 app.py >> flask.log 2>&1 &
```

- è§‚å¯Ÿæ—¥å¿—

```
tail -n 20 flask.log
```

- æ˜¾ç¤ºè§„åˆ™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/3590700/uid1190679-20250622-1750600327232) 

## æ€»ç»“

- è¿™æ¬¡ äº†è§£åˆ° `è·¯ç”±`
	- ç”¨è£…é¥°å™¨ å£°æ˜url
	- å† å°†è·¯ç”± å°è£…æˆ å‡½æ•°
- url ä¸­ å¯ä»¥åŒ…å«`å˜é‡`
	- å°†`å˜é‡`ä½œä¸º`å‚æ•°` ä¼ å…¥`å¤„ç†å‡½æ•°` 
	- è¿›è¡Œå¤„ç†

|è·¯ç”±ç±»å‹|è·¯ç”±å®šä¹‰è¯­æ³•|åŒ¹é…è§„åˆ™è¯´æ˜|ç¤ºä¾‹ URL åŠå¯¹åº”å¤„ç†é€»è¾‘|
|---|---|---|---|
|å­—ç¬¦ä¸²åœ°å€ï¼ˆæ— çº¦æŸï¼‰|/user/<username>|åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ï¼ˆé™¤ / å¤–  ï¼‰|å¦‚ localhost:5000/user/oeasy ï¼Œusername ä¸º oeasy ï¼Œè¿”å› User oeasy|
|æ•´æ•°ç±»å‹çº¦æŸ|/post/<int:post_id>|ä»…åŒ¹é…æ•´æ•°å½¢å¼å†…å®¹|å¦‚ localhost:5000/post/123 ï¼Œpost_id ä¸º 123 ï¼Œè¿”å› Post 123|
|è·¯å¾„ç±»å‹çº¦æŸ|/path/<path:subpath>|åŒ¹é…åŒ…å« / çš„å®Œæ•´è·¯å¾„ç‰‡æ®µ|å¦‚ localhost:5000/path/a/b/c ï¼Œsubpath ä¸º a/b/c ï¼Œè¿”å› Subpath a/b/c|

- å¤§å‹åº”ç”¨ æœ‰å„ç§ è¦å¤„ç†çš„url
	- éƒ½è¦ æ”¾ app.py é‡Œ
	- èƒ½åˆ†é—¨åˆ«ç±» æ”¾åˆ° ä¸åŒpyæ–‡ä»¶ ä¸­å—ï¼Ÿï¼Ÿ
- ä¸‹æ¬¡å†è¯´ğŸ‘‹ğŸ»

