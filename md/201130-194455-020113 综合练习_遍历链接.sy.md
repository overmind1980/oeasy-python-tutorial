---
show: step
version: 1.0
enable_checker: true
---

# xpath è·¯å¾„è¡¨è¾¾å¼
## å›å¿†

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
	- oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
	- è·å–xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§hrefçš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- èƒ½æŠŠè¿™äº›é“¾æ¥éƒ½çˆ¬ä¸€éä¹ˆï¼ŸğŸ¤”

### éå†
```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath(".")
    for element in et_target:
        print(element.tag)
        #attributes = element.attrib
        #f.write("http://localhost/oeasyorg"+attributes["href"][1:] + "\n")
```
- è¿è¡Œå‡ºç°äº†12æ¬¡htmlèŠ‚ç‚¹
- ä½†æ˜¯åé¢æŠ¥äº†é”™è¯¯
- æœ€åä¸€ä¸ªurlå‡ºäº†é—®é¢˜

### è§£å†³

- é—®é¢˜å¯èƒ½æ˜¯ç”±äºæœ€åä¸€ä¸ªé“¾æ¥åé¢æœ‰ä¸ª`\n`
- é€ æˆäº†æœ€åçš„å…ƒç´ æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²
- ä½¿ç”¨åˆ‡ç‰‡çš„æ–¹æ³•è§£å†³é—®é¢˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630590728046)

### æ‰¾åˆ°xpath

- å³é”®å·¥å…·è½¯ä»¶
- å¤åˆ¶xpath
- ä¿®æ”¹ä»£ç 
- æŒ‰ç…§åœ°å€
	- è¾“å‡ºé¡¹ç›®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630590988087)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630651702331)

- æˆ‘æƒ³åšçš„æ˜¯ä¿å­˜
	- è¯¾ç¨‹å
	- çœ‹æ•™ç¨‹ç½‘å€

### éå†
- æ‰“å¼€é“¾æ¥åå†å­˜å‚¨
	- å„æ•™ç¨‹åç§°
	- çœ‹æ•™ç¨‹ç½‘å€
```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")[0:-1]
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath("/html/body/div/div/div[1]")
    et_target2 = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    print("url----"+url)
    count = 0
    while ( count < len(et_target)):
        print(et_target[count].text)
        print(et_target2[count].text)
        print(et_target2[count].attrib["href"])
        count = count + 1
        print("count====" + str(count))
```

- è¾“å‡ºé¡ºåˆ©
- å¯ä»¥æŠŠå„ä¸ªç½‘å€è¾“å‡ºåˆ°å±å¹•
- ç°åœ¨éœ€è¦æŠŠè¾“å‡ºé‡å®šå‘åˆ°æ–‡æœ¬æ–‡ä»¶

### è¾“å‡ºé‡å®šå‘

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")[0:-1]
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath("/html/body/div/div/div[1]")
    et_target2 = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    print("url----"+url)
    count = 0
    with open("urls.csv","at") as f:
        while ( count < len(et_target)):
            print("count====" + str(count))
            print(et_target[count].text)
            print(et_target2[count].text)
            print(et_target2[count].attrib["href"])
            s_url = et_target[count].text + "," \
                  + et_target2[count].attrib["href"] + "\n"
            f.write(s_url)
            count = count + 1
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630653569803)

### ä¼˜åŒ–ä»£ç 

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")[0:-1]
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath("/html/body/div/div/div[1]")
    et_target2 = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    count = len(et_target)
    with open("urls.csv","at") as f:
        for cur in range(0,count-1):
            print("cur====" + str(cur))
            print(et_target[cur].text)
            print(et_target2[cur].text)
            print(et_target2[cur].attrib["href"])
            s_url = et_target[cur].text + "," \
                  + et_target2[cur].attrib["href"] + "\n"
            f.write(s_url)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630663926329)

### å…¥åº“
- æ›´æ–°ç³»ç»Ÿå®‰è£…postgres
- å¯åŠ¨postgres
- å¹¶ä»¥postgresç™»å½•

```
sudo apt update
sudo apt install postgresql
sudo /etc/init.d/postgres start
sudo -u postgres psql
```

- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“database

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630664944685)

### æŸ¥çœ‹æ•°æ®åº“
```
\l
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665003642)

- å»ºç«‹æ•°æ®åº“oeasy
- å¹¶è¿›å…¥

```
create database oeasy;
\l
```
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665050881)

### å»ºè¡¨å¹¶å¯¼å…¥æ•°æ®
```
\c oeasy
\dt
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665134696)

- å»ºè¡¨

```
create table urls(topic varchar, url varchar);
\dt
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665232801)

- å¯¼å…¥æ•°æ®

```
\copy urls from '/home/shiyanlou/urls.csv' delimiter ',' csv ;
```
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665741698)

- æŸ¥è¯¢æ•°æ®

```
select * from urls where topic like '%e%';
select * from urls where length(topic) > '5';
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665711812)

### æ€»ç»“

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
	- oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
	- è·å–xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§hrefçš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”æŠŠæ¯ä¸€ä¸ªé“¾æ¥éƒ½çˆ¬äº†ä¸€é
- èƒ½å‡ºå»çˆ¬ä¸ªç™¾åº¦ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
