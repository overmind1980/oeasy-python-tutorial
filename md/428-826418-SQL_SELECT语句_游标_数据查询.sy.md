---
show: step
version: 1.0
enable_checker: true
---

# psycopg3

## å›å¿†

- ä¸Šæ¬¡å¯ä»¥æ‰§è¡Œsqlè¯­å¥è¿›è¡Œ
	- create table
	- insert
	- ä¹Ÿå¯ä»¥ 
	- å¾—åˆ°selectæŸ¥è¯¢çš„ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672323440515)

- å¯ä»¥é€šè¿‡pythonæ¥è¿›è¡Œ
	- SELECTæŸ¥è¯¢å—ï¼Ÿ

### æ£€æŸ¥ç¯å¢ƒ

- ç¡®å®å»ºäº†è¡¨
- ä¹Ÿæ’äº†æ•°æ®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230203-1675417402418)

- å¯ä»¥åœ¨pythonä¸­è¿›è¡ŒæŸ¥è¯¢å—ï¼Ÿ

### è§‚å¯Ÿæ–‡æ¡£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672322988959)

### å°è¯•ä½¿ç”¨

```
import psycopg
conninfo = "postgres://postgres:oeasypg@localhost:5432/oeasydb"
with psycopg.connect(conninfo) as conn:
    print("connect!")
    with conn.cursor() as cur:
        cur.execute("SELECT * FROM test;")
        for record in cur.fetchall():
            print(record)
```

- å…·ä½“ä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230123-1674447348173)

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672323222177)

- åªæœ‰ä¸€æ¡è®°å½•
- å°è¯•å¤šæ’å‡ æ¡è®°å½•

### æ’å…¥æ•°æ®

- vi c2.py

```
import psycopg
conninfo = "postgres://postgres:oeasypg@localhost:5432/oeasydb"
with psycopg.connect(conninfo) as conn:
    print("connect!")
    conn.execute(
        "INSERT INTO test(num, data) VALUES (%s, %s)",
        (200, "efg")
    )
    conn.execute(
        "INSERT INTO test(num, data) VALUES (%s, %s)",
        (300, "hij")
    )
    print("Data is inserted!")
    conn.commit()
```

- æ‰§è¡Œè¿‡c2.pyå

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230330-1680180383914)

- å†go.pyæŸ¥çœ‹

### å†æ¬¡æŸ¥çœ‹

- æ–°æ•°æ®å·²ç»æ’å…¥
	- å¯ä»¥æŸ¥è¯¢åˆ°å¤šä¸ªå…ƒç»„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230330-1680180466781)

- å¦‚ä½•ç†è§£ æ¸¸æ ‡ å‘¢ï¼Ÿ

### æ¸¸æ ‡(cursor)

- ä½¿ç”¨ è¿æ¥å»ºç«‹ ä¸€ä¸ªæ¸¸æ ‡(cursor)
- ä»€ä¹ˆæ˜¯æ¸¸æ ‡(cursor)å‘¢ï¼Ÿ
	- æ¸¸æ ‡æ˜¯ç»™pgæœåŠ¡å™¨å‘é€å‘½ä»¤çš„ä¸€ä¸ªä¼šè¯
	- ä½¿ç”¨ç›¸åŒConnectionçš„ä¼šè¯æ˜¯ç›¸é€šçš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672322311626)

- psycopg å®ç°çš„æ˜¯ DBAPIçš„ä¸€ä¸ªæ¥å£
	- DBAPI æ˜¯ pythonå®šä¹‰çš„ä¸€å¥—æ•°æ®åº“ ç¼–ç¨‹æ¥å£
	-  æ¥å£æ˜¯å›ºå®šçš„
	-  æ— è®ºmysqlã€oracleã€db2 
	-  æ¥å£æ˜¯ç»Ÿä¸€çš„

- https://www.psycopg.org/psycopg3/docs/api/cursors.html#psycopg.Cursor

- æ¥å£æ˜¯æ€ä¹ˆè¦æ±‚çš„å‘¢ï¼Ÿ

### python DBAPIä¸­çš„æ¸¸æ ‡

- https://peps.python.org/pep-0249/#cursor-objects

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672322455438)

- æ¸¸æ ‡å¯ä»¥æ‰§è¡Œsqlè¯­å¥
- psycopgæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ

### pgçš„æ¸¸æ ‡

- é€šè¿‡è°ƒç”¨postgresçš„æ¥å£å®ç°çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672322757067)

- https://peps.python.org/pep-0249/#cursor-objects

### ibmå®šä¹‰çš„æ¸¸æ ‡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221230-1672363717191)

- æ¸¸æ ‡å¯ä»¥é€šè¿‡SELECT è¯­å¥
	- è·å¾—ä¸€ç³»åˆ—çš„ç»“æœé›†

### æ€»ç»“

- è¿™æ¬¡ä½¿ç”¨äº†æ¸¸æ ‡
-	é€šè¿‡æ¸¸æ ‡
	- å¯ä»¥å¾—åˆ°selectæŸ¥è¯¢çš„ç»“æœé›†
- è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥
	- é€šè¿‡pythonè¯­è¨€
		- ç›´æ¥æ“ä½œpostgresäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221229-1672323440515)

- psycopgè¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å—ğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹