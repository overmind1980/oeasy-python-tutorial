---
show: step
version: 1.0 
enable_checker: true
---


# python_éŸ³é¢‘å¤„ç†_midiåˆ¶ä½œ

## å¼€å§‹

- æˆ‘ä»¬é¦–å…ˆè¦ä»é›¶å¼€å§‹
- å®‰è£…midiè½¯ä»¶

```
sudo apt update
yes | sudo apt install rosegarden
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704697245143)

- ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ

### rosegarden

```
rosegarden
```

- è¿è¡ŒæˆåŠŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704698308051)

- å°è¯•ä½¿ç”¨pythonå†™midæ–‡ä»¶

### å®‰è£…ç±»åº“

```
pip install MIDIUtil
```

- å®‰è£…æˆåŠŸå
	- å‡†å¤‡ç”¨pythonå†™midiæ–‡ä»¶

### å¤§è°ƒéŸ³é˜¶

```python3
from midiutil import MIDIFile

# create MIDI file
midi_file = MIDIFile(1)

# add a track
track = 0
time = 0
midi_file.addTrackName(track, time, "Sample Track")
midi_file.addTempo(track, time, 120)

# add notes to the track
channel = 0
pitch = 60    # C3
duration = 1  # 1 beat
volume = 100  # max volume
for i in range(0, 8):
    midi_file.addNote(track, channel, pitch+i, time+i*duration, duration, volume)

# write MIDI file to disk
with open("output.mid", "wb") as output_file:
    midi_file.writeFile(output_file)
```

- è¿è¡Œä¹‹å
	- å°è¯•æ‰“å¼€output.mid

### æ‰“å¼€æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704698935734)

- æŸ¥çœ‹é’¢ç´å·å¸˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704699083704)

- å¯ä»¥ä¿®æ”¹ä¸ºå¤§è°ƒéŸ³é˜¶å—ï¼Ÿ

### å¤§è°ƒéŸ³é˜¶

```
from midiutil import MIDIFile

# create MIDI file
midi_file = MIDIFile(1)

# add a track
track = 0
time = 0
midi_file.addTrackName(track, time, "Sample Track")
midi_file.addTempo(track, time, 120)

# add notes to the track
channel = 0
pitch = 72    # C4
duration = 1  # 1 beat
volume = 100  # max volume
j = 0
for i in [0,2,4,5,7,9,11,12]:
    midi_file.addNote(track, channel, pitch+i, time+j*duration, duration, volume)
    j = j + 1

# write MIDI file to disk
with open("output.mid", "wb") as output_file:
    midi_file.writeFile(output_file)
```

- ä¿®æ”¹åç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704699793226)

- æœ‰æ›´æ ‡å‡†çš„å†™æ³•å—ï¼Ÿ

### å¸®åŠ©æ–‡æ¡£

```
firefox https://pypi.org/project/MIDIUtil/
```

- æ–‡æ¡£çŠ¶æ€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704704529903)

- å¯ä»¥è·‘è·‘å…¶ä¸­çš„ä»£ç å—ï¼Ÿ

### è¿è¡Œ

```
#!/usr/bin/env python

from midiutil import MIDIFile

degrees  = [60, 62, 64, 65, 67, 69, 71, 72]  # MIDI note number
track    = 0
channel  = 0
time     = 0    # In beats
duration = 1    # In beats
tempo    = 60   # In BPM
volume   = 100  # 0-127, as per the MIDI standard

MyMIDI = MIDIFile(1)  # One track, defaults to format 1 (tempo track is created
                      # automatically)
MyMIDI.addTempo(track, time, tempo)

for i, pitch in enumerate(degrees):
    MyMIDI.addNote(track, channel, pitch, time + i, duration, volume)

with open("major-scale.mid", "wb") as output_file:
    MyMIDI.writeFile(output_file)
```

- è¾“å‡ºäº†ä¸€ç³»åˆ—çš„ å¤§è°ƒéŸ³é˜¶
	- major-scale

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240108-1704704665657)

- æ‰“å¼€ä¹‹åæŸ¥çœ‹åˆ°midçŠ¶æ€
	- ç¡®å®æ˜¯å¤§è°ƒéŸ³é˜¶

### ã€Šæ¢ç¥ã€‹

```
from mido import MidiFile, MidiTrack, Message

# åˆ›å»ºä¸€ä¸ªæ–°çš„ MIDI æ–‡ä»¶
midi = MidiFile()

# åˆ›å»ºå³æ‰‹æ—‹å¾‹è½¨é“
melody_track = MidiTrack()
midi.tracks.append(melody_track)
melody_track.append(Message('program_change', program=0, time=0))

# å³æ‰‹æ—‹å¾‹ï¼ˆæ¢ç¥ä¸»é¢˜æ—‹å¾‹ï¼‰
right_hand_notes = [
    (64, 960), (67, 720), (69, 240),
    (72, 720), (74, 240), (69, 240), (72, 240), (67, 480),
    (79, 720), (84, 240), (81, 240), (79, 240), (76, 240), (79, 240),
    (74, 1920),
    (74, 480), (74, 240), (76, 240), (71, 480), (69, 480), 
    (67, 720), (69, 240), (72, 480), (74, 480),
    (64, 480), (72, 480), (69, 240), (67, 240), (69, 240), (72, 240),
    (67, 1920),
    (76,720),(79,240),(71,480),(74,480),
    (69,240),(72,240),(67,1440),
    (64,360),(67,120),(64,480),(67,240),(69,240),(71,240),(74,240),
    (69,1440),(67,240),(69,240),
    (72,720),(74,240),(79,480),(76,480),
    (74,480),(76,240),(74,240),(72,480),(69,240),(67,240),
    (64,960),(72,960),
    (69,360),(72,120),(69,240),(67,240),(64,240),(67,240),(69,240),(72,240),
    (67,1440),(76,240),(79,240),
    (74,240),(76,240),(74,240),(72,240),(71,480),(69,480),
    (67,1440),(64,240),(67,240),
    (62,240),(64,240),(62,240),(60,240),(59,480),(57,480),
    (55,1920),
]

# å·¦æ‰‹ä¼´å¥ï¼ˆç®€å•çš„ä½éŸ³è¿›è¡Œï¼‰
left_hand_notes = [
    (36,480),(43,480),(45,480),(48,480),
    (40,480),(48,480),(45,480),(43,480),
    (36,480),(43,480),(45,480),(48,480),
    (43,480),(48,480),(50,480),(55,480),
    (41,240),(50,240),(53,240),(57,1200),
    (40,240),(47,240),(50,240),(52,240),(55,960),
    (45,240),(52,240),(57,240),(48,240),(52,960),
    (31,240),(38,240),(43,240),(48,240),(55,960),
    (52,240),(59,240),(62,240),(64,240),(55,960),
    (45,240),(52,240),(55,240),(57,240),(60,960),
    (40,240),(47,240),(50,240),(52,240),(55,960),
    (45,240),(52,240),(55,240),(57,240),(60,240),(64,240),(0,480),
    (36,240),(43,240),(45,240),(48,1200),
    (43,240),(50,240),(55,240),(57,1200),
    (45,240),(52,240),(55,240),(57,1200),
    (38,240),(45,240),(48,240),(50,240),(55,960),
    (31,240),(38,240),(43,240),(48,240),(55,480),(72,480),
    (69,480),(67,480),(62,480),(64,480),
    (55,1440),(60,480),
    (57,480),(55,480),(50,480),(52,480),
    (43,1920)
]

# åˆ›å»ºå³æ‰‹æ—‹å¾‹è½¨é“
for note, duration in right_hand_notes:
    melody_track.append(Message('note_on', note=note, velocity=80, time=0))
    melody_track.append(Message('note_off', note=note, velocity=80, time=duration))

# åˆ›å»ºå·¦æ‰‹è½¨é“
bass_track = MidiTrack()
midi.tracks.append(bass_track)
bass_track.append(Message('program_change', program=0, time=0))

# æ·»åŠ å·¦æ‰‹ä¼´å¥
for note, duration in left_hand_notes:
    bass_track.append(Message('note_on', note=note, velocity=60, time=0))
    bass_track.append(Message('note_off', note=note, velocity=60, time=duration))

# åˆ›å»ºä¸­å›½ä¼ ç»Ÿæ‰“å‡»ä¹è½¨é“ï¼ˆé€šé“ 9ï¼‰
drum_track = MidiTrack()
midi.tracks.append(drum_track)

drum_pattern = [
    (56, 960),  # å¤§é¼“
    (57, 960),  # å°å ‚é¼“
    (58, 480),  # é“™é’¹
    (59, 480),  # æœ¨é±¼
    (60, 960),  # ç¢°é“ƒ
    (61, 480),  # äº‘é”£
    (56, 960), (58, 480), (59, 480), (57, 960), (60, 960), (61, 480)
]

# è®©æ‰“å‡»ä¹æŒç»­åŠé¦–æ­Œ
drum_repeats = len(right_hand_notes) // len(drum_pattern) // 2

for _ in range(drum_repeats):
    for note, duration in drum_pattern:
        drum_track.append(Message('note_on', note=note, velocity=80, time=0, channel=9))
        drum_track.append(Message('note_off', note=note, velocity=80, time=duration, channel=9))

# ä¿å­˜ MIDI æ–‡ä»¶
midi.save('liangzhu_piano_with_traditional_drums.mid')
print("MIDI æ–‡ä»¶å·²ä¿å­˜ï¼ŒåŒ…å«å·¦æ‰‹ä¼´å¥å’Œä¸­å›½ä¼ ç»Ÿæ‰“å‡»ä¹ï¼")
```

### æ€»ç»“

- è¿™æ¬¡ä»é›¶å¼€å§‹
	- å®‰è£…äº†midiè½¯ä»¶
	- ä½¿ç”¨pythonåˆ¶ä½œäº†midæ–‡ä»¶
- ä¸è¿‡
	- ç©¶ç«Ÿä»€ä¹ˆæ˜¯midå‘¢ï¼ŸğŸ¤”
- æˆ‘ä»¬ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹
