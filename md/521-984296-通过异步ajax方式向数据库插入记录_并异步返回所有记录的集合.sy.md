---
show: step
version: 1.0
enable_checker: true
---

#  é€šè¿‡å¼‚æ­¥ajaxæ–¹å¼å‘æ•°æ®åº“æ’å…¥è®°å½•_å¹¶å¼‚æ­¥è¿”å›æ‰€æœ‰è®°å½•çš„é›†åˆ

## å›å¿†ä¸Šæ¬¡

- ä¸Šæ¬¡ä»æµè§ˆå™¨å¼‚æ­¥å‘é€äº†ä¸€ä¸ªhttpè¯·æ±‚
	- ä½¿ç”¨çš„è¿˜æ˜¯ajax
	- å‘é€çš„å†…å®¹æ˜¯jsonæ–‡ä»¶
- æœåŠ¡å™¨ç«¯
	- å¯ä»¥å¯¹è¿™ä¸ªå¼‚æ­¥è¯·æ±‚è¿›è¡Œå¤„ç†
	- è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªåŸæ ·çš„jsonæ–‡ä»¶
- æµè§ˆå™¨æ¥æ”¶åˆ°å¼‚æ­¥è¯·æ±‚çš„å“åº”ä¹‹å
	- åœ¨æµè§ˆå™¨ç«¯æ˜¾ç¤ºå‡ºæœåŠ¡å™¨è¿”å›çš„jsonæ–‡ä»¶
	- æ•´ä¸ªæµç¨‹å®Œæˆ
- æˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§æ–¹å¼
	- å¼‚æ­¥åœ°å‘æ•°æ®åº“é‡Œé¢æ’å…¥ä¸€æ¡è®°å½•
	- ç„¶åå†åœ¨ç½‘é¡µé‡Œé¢æŠŠæ‰€æœ‰è®°å½•é›†æ˜¾ç¤ºå‡ºæ¥å—ï¼ŸğŸ¤”

### é¦–å…ˆå‡†å¤‡æ•°æ®åº“ç¯å¢ƒ

1. å¯åŠ¨æ•°æ®åº“æœåŠ¡
2. è¿›å…¥oeasydb
3. å»ºè¡¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230527-1685168042266)

4. æ’å…¥æ•°æ®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230527-1685168061922)

5. æŸ¥è¯¢

- å¦‚ä½•åœ¨flaskä¸­æ’å…¥æ•°æ®å‘¢ï¼Ÿ

### main.py

```python3
from flask import Flask,request,jsonify
import json
from db import pool

app = Flask(__name__)

@app.route("/")
def home():
    return "Home"

@app.route("/task/insert",methods=["POST"])
def task_insert():
    task_dict = request.get_json()
    print("task_dict==========",task_dict)
    task_name = task_dict.get("task_name")
    task_detail = task_dict.get("task_detail")
    status_code = 200
    response_headers =  {"Content-Type": "application/json"}
    if not task_name or not task_detail :
        return "task_name and task_detail cannot be none", status_code, response_headers
    try:
        with pool.connection() as conn:
            with conn.cursor() as cur:
                sql = """INSERT INTO task(task_name,task_detail) VALUES(%s,%s)"""
                t = (task_name, task_detail)
                cur.execute(sql,t)
                conn.commit()
                return "insert successful", status_code, response_headers
    except:
        return "insert failed!", status_code, response_headers

if __name__ == "__main__":
    app.run(debug=True)
```

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230527-1685169456282)

- ç¡®å®å¯ä»¥å¼‚æ­¥æ’å…¥æ•°æ®
- å¯ä»¥è®©ç½‘é¡µæ¥æ”¶åˆ°æ•°æ®å¹¶æ˜¾ç¤ºå—ï¼Ÿ

### ç½‘é¡µ

```html
<html>
  <head>
  <script type="text/javascript">
    function go(){
		var task_name = document.getElementById("task_name").value;
		var task_detail = document.getElementById("task_detail").value;
		var para = {"task_name": task_name, "task_detail":task_detail};
		para = JSON.stringify(para);
        var jsonHttp = new XMLHttpRequest();
		jsonHttp.open("POST","/task/insert",true);
		jsonHttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		jsonHttp.send(para);
		jsonHttp.onreadystatechange=function(){
			if (jsonHttp.readyState==4 && jsonHttp.status==200){
				var msg = jsonHttp.responseText;
                alert("msg========="+msg+"==========");
                alert("msg========="+(msg=="insert successful")+"==========");
				document.getElementById("result").innerHTML=msg;
                if (msg == "insert successful"){
                    refresh_data();
                }
			}
		}
	}
    function refresh_data(){
        var jsonHttp = new XMLHttpRequest();
		jsonHttp.open("POST","/task/tasks",true);
		jsonHttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        jsonHttp.send()
		jsonHttp.onreadystatechange=function(){
			if (jsonHttp.readyState==4 && jsonHttp.status==200){
				var msg = jsonHttp.responseText;
				document.getElementById("result").innerHTML=msg;
			}
		}
    }
  </script>
  </head>
  <body>
	task_name<input id="task_name" name="task_name"><br/>
	task_detail<input id="task_detail" name="task_detail"><br/>
	<input type="button" onclick="go()" value="go">
	<span id="result"></span>
	<span id="data"></span>
  </body>
<html>

```

- æ˜¾ç¤ºç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230527-1685178678737)

- ç¡®å®å°†æ•°æ®åº“è¯»å–ç»“æœæ˜¾ç¤ºå‡ºæ¥äº†
- å¯ä»¥æ˜¾ç¤ºå¾—å¥½çœ‹ä¸€ç‚¹å—ï¼Ÿ

## æ€»ç»“

- è¿™æ¬¡ä½¿ç”¨ajaxæŠ€æœ¯
	- å¼‚æ­¥åœ°å‘æ•°æ®åº“æ’å…¥æ•°æ®
	- å¹¶å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢
	- æŠŠæŸ¥è¯¢ç»“æœå†ç”¨å¼‚æ­¥çš„æ–¹å¼
	- ä¼ å›æµè§ˆå™¨
- æµè§ˆå™¨ä¸Šå¯ä»¥æ˜¾ç¤ºå‡ºæ•°æ®åº“ç»“æœ
	- ä½†æ˜¯æ˜¾ç¤ºæ•ˆæœæ¯”è¾ƒæ‚ä¹±
	- å¯ä»¥æ˜¾ç¤ºçš„æ›´åŠ è§„æ•´ä¸€äº›å—ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹ğŸ»

