---
show: step
version: 1.0
enable_checker: true
---

# è¯­æ³• html ç”Ÿæˆ

## å›å¿†

- ä¸Šæ¬¡ äº†è§£äº† ç¼–ç è®¾ç½®
	- response è·å¾— ç½‘é¡µ çš„ å­—èŠ‚æµä¹‹å
	- å¯æŒ‰ç…§æŒ‡å®šçš„ç¼–ç æ ¼å¼è§£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/83402/uid1190679-20250427-1745738929329) 

|ç¼–ç åç§°|åº”ç”¨é¢†åŸŸ|
|---|---|
|UTF-8|ä½¿ç”¨æœ€å¹¿æ³›|
|ASCII|è‹±è¯­|å•å­—èŠ‚é¦–é€‰|
|ISO-8859-1|æ‹‰ä¸å­—æ¯|
|GBK|ç®€ç¹ä½“ä¸­æ–‡|
|BIG5|ç¹ä½“ä¸­æ–‡|


- etree å¯ä»¥é¡ºåˆ©ç”Ÿæˆäº† 
	- å¦‚ä½• å¿«é€Ÿ å®šä½ è¦çˆ¬å–çš„èŠ‚ç‚¹å‘¢ï¼Ÿï¼ŸğŸ¤”

### æé—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745799471414)

- ä»€ä¹ˆæ˜¯`xpath`å‘¢ï¼Ÿ

### ç»§ç»­æé—®

- xpath


 ![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745799557436) 

###  è¯­æ³•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745799632624) 

|è¯­æ³•|æè¿°|ç¤ºä¾‹|
|---|---|---|
|/|ä»æ ¹èŠ‚ç‚¹é€‰å–ï¼Œä¹Ÿç”¨äºè¡¨ç¤ºè·¯å¾„ä¸­çš„åˆ†éš”ç¬¦|/root/childï¼šé€‰å–æ ¹èŠ‚ç‚¹rootä¸‹çš„childå­èŠ‚ç‚¹|
|//|åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­é€‰å–èŠ‚ç‚¹ï¼Œä¸è€ƒè™‘å…¶ä½ç½®|//elementï¼šé€‰å–æ–‡æ¡£ä¸­æ‰€æœ‰çš„elementèŠ‚ç‚¹|
|.|é€‰å–å½“å‰èŠ‚ç‚¹|åœ¨ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œ.è¡¨ç¤ºå½“å‰èŠ‚ç‚¹è‡ªèº«|
|..|é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹|å‡è®¾å½“å‰èŠ‚ç‚¹æ˜¯childï¼Œ..å¯é€‰å–å…¶çˆ¶èŠ‚ç‚¹|
|*|é€šé…ç¬¦ï¼Œé€‰å–ä»»ä½•å…ƒç´ èŠ‚ç‚¹|//*ï¼šé€‰å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹|
|@|é€‰å–å±æ€§èŠ‚ç‚¹|//element[@attribute]ï¼šé€‰å–æ‰€æœ‰å…·æœ‰attributeå±æ€§çš„elementèŠ‚ç‚¹|
|@*|é€‰å–æ‰€æœ‰å±æ€§èŠ‚ç‚¹|/root/element/@*ï¼šé€‰å–rootä¸‹elementèŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§èŠ‚ç‚¹|
|node()|é€‰å–æ‰€æœ‰èŠ‚ç‚¹|//node()ï¼šé€‰å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å…ƒç´ èŠ‚ç‚¹ã€æ–‡æœ¬èŠ‚ç‚¹ç­‰|
|[ ]|è°“è¯ï¼Œç”¨äºæ·»åŠ æ¡ä»¶ç­›é€‰èŠ‚ç‚¹|/root/element[1]ï¼šé€‰å–rootä¸‹çš„ç¬¬ä¸€ä¸ªelementèŠ‚ç‚¹//book[@price>10]ï¼šé€‰å–æ‰€æœ‰priceå±æ€§å€¼å¤§äº10çš„bookèŠ‚ç‚¹|
|andã€or|ç”¨äºç»„åˆå¤šä¸ªæ¡ä»¶|//book[@category='fiction' and @price>20]ï¼šé€‰å–categoryä¸ºfictionä¸”priceå¤§äº20çš„bookèŠ‚ç‚¹//book[@category='fiction' or @category='mystery']ï¼šé€‰å–categoryä¸ºfictionæˆ–mysteryçš„bookèŠ‚ç‚¹|
|union|ç”¨äºåˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹é›†|//book union //articleï¼šé€‰å–æ‰€æœ‰bookèŠ‚ç‚¹å’ŒarticleèŠ‚ç‚¹|


- å¤ªå¤šäº† ç®€åŒ–ä¸€ç‚¹ï½

### è·¯å¾„è¡¨è¾¾å¼

| è¡¨è¾¾å¼ | æè¿° | 
|--- |--- |
| nodename | åœ¨å½“å‰ä½ç½®é€‰æ‹©æ­¤ç±»èŠ‚ç‚¹ | 
|  / | ä»æ ¹èŠ‚ç‚¹é€‰å– æˆ– è¡¨ç¤ºå±‚çº§å…³ç³» |
| // | åœ¨ä»»æ„å±‚çº§ä¸‹çš„å­å­™è·¯å¾„ä¸‹ |
| . | é€‰å–å½“å‰èŠ‚ç‚¹ |
| .. | é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ | 

- è¿™äº›ä¸œè¥¿æ€ä¹ˆç†è§£å‘¢ï¼Ÿ

### æ„é€ ç¯å¢ƒ

- å¯åŠ¨ æœ¬åœ°WebæœåŠ¡

```
sudo service nginx start
sudo service nginx status
firefox http://localhost &
```

- æµè§ˆç½‘é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745801623894) 

- å³é”® 
	- æŸ¥çœ‹æºä»£ç 
	- view source

### åˆ†ææºä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240408-1712539021966)

- dom æ ‘å¦‚ä¸‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669525619191)

- æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹
	- å„ç§è·¯å¾„è¡¨è¾¾å¼

### ç‚¹(.)

- et_ä¸ºç±»å‹å‰ç¼€
	- å«ä¹‰ä¸ºelement_tree_node
	- å…ƒç´ æ ‘èŠ‚ç‚¹

```
import requests
from lxml import etree
response = requests.get("http://localhost")
b_html = response.content
et_html = etree.HTML(b_html)
et_element = et_html.xpath(".")
print(et_element)
```

- ç‚¹(.) ä¸ºå½“å‰èŠ‚ç‚¹
	- xpath å‚æ•°ä¸º ç‚¹(.) 
	- é€‰æ‹©çš„æ˜¯ å½“å‰èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240408-1712539113192)

- ç»“æœ 
	- ä¸­æ‹¬å· è¢«ä¸­æ‹¬å· `æ‹¬`èµ·æ¥
	- ç±»å‹ æ˜¯ `åˆ—è¡¨`ï¼Ÿ

### ç¨‹åºéªŒè¯

- è¿½åŠ è¾“å‡º
	- et_elementçš„type

```
print(type(et_element))
```

- å¤åˆ¶æœ€åä¸€å¥
	- è¾“å‡º et_element çš„ ç±»å‹(type)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240408-1712539218352)

- xpathå‡½æ•°çš„ è¿”å›å€¼
	- ç¡®å® æ˜¯ä¸€ä¸ªåˆ—è¡¨(list)
- xpath(".")
	- å¾—åˆ°çš„ æ˜¯ 
	- å½“å‰å…ƒç´ (et_html) çš„åˆ—è¡¨

### è¾“å‡º

- æ—¢ç„¶ è¿”å›å€¼ æ˜¯ åˆ—è¡¨(`l`ist)
	- æˆ‘ä»¬ å†ç»™ å˜é‡ååŠ ä¸Šå‰ç¼€ l_
	- l_et_element 
		- ç±»å‹ æ˜ç¡®
		- æ˜¯ etreeElementçš„åˆ—è¡¨

```
l_et_element =  et_html.xpath(".")
l_et_element
```

- å½“å‰èŠ‚ç‚¹ä¸ºhtml
	- ä¸‹é¢æœ‰headå­èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745802403372) 

- et_htmlèŠ‚ç‚¹ ä¸‹é¢ 
	- è¿˜æœ‰ä»€ä¹ˆ 
	- å­èŠ‚ç‚¹å‘¢ï¼Ÿ



### head

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745802434857) 

- xpathè¡¨è¾¾å¼ç›´æ¥å†™head
	- æ„æ€æ˜¯ å½“å‰å…ƒç´ (et_html) ä¸‹é¢çš„ head

```
l_et_element =  et_html.xpath("head")
l_et_element
```

- å¯ä»¥è¾“å‡ºheadå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745802567464) 

- å¯ä»¥ å†å¾€`æ›´`æ·±äº†æ‰¾ å—ï¼Ÿ

### å±‚çº§å…³ç³»

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745802767759) 

- body/p
	- ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„
	- ä»£è¡¨ç€ å½“å‰å…ƒç´ (et_html)
	- ä¸‹é¢çš„body
	- ä¸‹é¢çš„p

```
l_et_element =  et_html.xpath("body/p")
l_et_element
```

- è·å¾—äº† æ‰¾åˆ°3ä¸ªpå…ƒç´ 
	- éƒ½åœ¨åŒä¸€ä¸ªåˆ—è¡¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745802674874) 

- ç›®å‰ ä½¿ç”¨çš„æ˜¯ `ç›¸å¯¹è·¯å¾„` 
	- å¯ä»¥ ä½¿ç”¨ `ç»å¯¹è·¯å¾„` è¡¨ç¤º è¿™ä¸‰på—ï¼Ÿ


### å…¶ä»–å½¢å¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526234839)

- è¿˜å¯ä»¥ä½¿ç”¨ ç»å¯¹è·¯å¾„
	- /html/body/p

```
l_et_element =  et_html.xpath("/html/body/p")
l_et_element
```

- å’Œ `body/p` æ•ˆæœä¸€æ ·


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526259394)

- å¯ä»¥ å†å¾€`æ›´æ›´`æ·±äº†æ‰¾ å—ï¼Ÿ

### å†å‘ä¸‹ä¸€å±‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526419016)

|xpath|æè¿°æ–¹å¼|
|---|---|
|body/p/a|å½“å‰èŠ‚ç‚¹ä¸‹çš„<br/>bodyä¸‹çš„<br>pä¸‹çš„<br>aå…ƒç´ |
|/html/body/p/a|æ ¹ä¸‹çš„htmlä¸‹çš„<br>bodyä¸‹çš„<br>pä¸‹çš„<br>aå…ƒç´ |
|/html/body/p[2]/a|æ ¹ä¸‹çš„htmlä¸‹çš„<br>bodyä¸‹çš„<br>ç¬¬2ä¸ªpä¸‹çš„<br>aå…ƒç´ |

- ä¸Šè¿°çš„xpathç­‰ä»·

```
l_et_element =  et_html.xpath("body/p/a")
l_et_element
```

- å› ä¸ºæ‰€æœ‰a
	- `éƒ½`åœ¨ç¬¬äºŒä¸ªpé‡Œé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526455954)

- æƒ³`ç›´æ¥`æ‰¾åˆ° 
	- æ‰€æœ‰ aå…ƒç´  çš„ åˆ—è¡¨

### ä»»æ„å±‚çº§ä¸‹

- æ‰¾åˆ°ä»»æ„å±‚çº§ä¸‹çš„ aå…ƒç´ 

```
l_et_element =  et_html.xpath("//a")
l_et_element
```

- ä» æ ‘çš„ å±‚çº§ æ¥è¯´
	- æœ¬èŠ‚ç‚¹ä¸‹ æ˜¯ `/`
	- ä»»æ„å±‚çº§ä¸‹ æ˜¯ `//`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745803175281) 

- å†æ‰¾ä¸ª ä»»æ„å±‚çº§ä¸‹çš„

### ä»»æ„å±‚çº§ä¸‹

- //em
	- ä»»æ„å±‚çº§ä¸‹çš„emå…ƒç´ 

```
l_et_element =  et_html.xpath("//em")
l_et_element
```

- å¯ä»¥æ‰¾åˆ°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745803262610)

- æœ¬èŠ‚ç‚¹ä¸‹ æ˜¯ `/`
	- ä»»æ„å±‚çº§ä¸‹ æ˜¯ `//`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526539230)

- `å½“å‰èŠ‚ç‚¹` æ€ä¹ˆè¯´ ï¼Ÿ

### `å½“å‰èŠ‚ç‚¹`

- `å½“å‰èŠ‚ç‚¹`
	- ç‚¹(.) 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669527130581)

- bodyçš„å½“å‰èŠ‚ç‚¹
	- (è¿˜æ˜¯body)ä¸‹çš„
	- h1å…ƒç´ 

```
l_et_element =  et_html.xpath("body/./h1")
l_et_element
```

- `/`æ˜¯å½“å‰èŠ‚ç‚¹ä¸‹
	- `.` æ˜¯ å½“å‰èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240408-1712539828012)

- å¯ä»¥æ‰¾åˆ° å½“å‰èŠ‚ç‚¹ ä¹‹`ä¸Š` å—ï¼Ÿ

### å‘ä¸Šä¸€å±‚

- å‘ä¸Šä¸€å±‚	
	- ä¸¤ä¸ªç‚¹(..)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669526663256)

```
l_et_element =  et_html.xpath("/html/body/../head/style")
l_et_element
```

- æ ¹ä¸‹çš„htmlä¸‹çš„
	- bodyçš„
	- ä¸Šä¸€å±‚å…ƒç´ (html)ä¸‹çš„
	- headä¸‹çš„
	- styleå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/193139/uid1190679-20250428-1745804896588) 


## æ€»ç»“

- è¿™æ¬¡æ·±å…¥äº† xpath
- xpath 
	- ç”¨æ¥ç­›é€‰ 
	- xml æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹

| è¡¨è¾¾å¼ | æè¿° | 
|--- |--- |
| nodename | åœ¨å½“å‰ä½ç½®é€‰æ‹©æ­¤ç±»èŠ‚ç‚¹ | 
|  / | ä»æ ¹èŠ‚ç‚¹é€‰å– æˆ– è¡¨ç¤ºå±‚çº§å…³ç³» |
| // | åœ¨ä»»æ„å±‚çº§ä¸‹çš„å­å­™è·¯å¾„ä¸‹ |
| . | é€‰å–å½“å‰èŠ‚ç‚¹ |
| .. | é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ | 

- æˆ‘ä»¬æ€ä¹ˆçŸ¥é“
	- æŸä¸ªå…ƒç´  çš„ xpath å‘¢ï¼Ÿ
- ä¸‹æ¬¡å†è¯´ğŸ‘‹
