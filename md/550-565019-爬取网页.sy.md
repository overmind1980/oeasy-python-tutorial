---
show: step
version: 1.0
enable_checker: true
---

# å®‰è£…ç¯å¢ƒ

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬äº†è§£äº† selenium
	- seleniumæ˜¯ ä¸€ä¸ªé©±åŠ¨çœŸå®æµè§ˆå™¨çš„ å·¥å…·
	- æ”¯æŒ å„ç§ç³»ç»Ÿã€å¾ˆå¤šç§ ä¸»æµæµè§ˆå™¨
	- æŠŠ æµè§ˆå™¨çš„å„ç§æ“ä½œ
		- å°è£…æˆ å„ç§è¯­è¨€çš„ æ¥å£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/564969/uid1190679-20241211-1733921243204) 

- æˆ‘ä»¬ä½¿ç”¨ pythonçš„æ¥å£
	- å°±å¯ä»¥è®© ä¸€ä¸ªçœŸå®æµè§ˆå™¨ å»è®¿é—®ç½‘ç«™
	- ä»è€Œ å¾—åˆ°çˆ¬å–çš„ æ•ˆæœ
	- å¯ä»¥ çˆ¬ä¸‹æ¥äº›ä»€ä¹ˆ å‘¢ï¼ŸğŸ¤”

### å…ˆå¤ç°ç¯å¢ƒ

```
pip3 install selenium
cd Code
wget https://labfile.oss.aliyuncs.com/courses/3584/geckodriver-v0.35.0-linux64.tar.gz
tar xf geckodriver-v0.35.0-linux64.tar.gz
echo $PATH
sudo cp ./geckodriver /usr/bin
geckodriver
```

- å®‰è£…é©±åŠ¨å’Œç±»åº“

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241217-1734393558927) 

- <kbd>ctrl</kbd> + <kbd>c</kbd>
	- ç»“æŸè¿›ç¨‹

### ä»æ–‡æ¡£å…¥æ‰‹

- https://www.selenium.dev/documentation/webdriver/getting_started/first_script/

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220913-1663034670846)

### ä»£ç 

```
import time

from selenium.webdriver.firefox.service import Service
from selenium import webdriver

service = Service(executable_path="geckodriver")
driver = webdriver.Firefox(service=service)
driver.get("https://www.bilibili.com/video/BV1Es411Z7MH")
time.sleep(10)
title = driver.title
print(title)
driver.quit()
```

- ç¡®å®å¯ä»¥è·å¾—ç½‘é¡µæ ‡é¢˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220913-1663034865284)

- å¯ä»¥è·å¾—æ•´ä¸ªæºæ–‡ä»¶ä¹ˆï¼Ÿ

### è·å¾—æºä»£ç 

```
import time

from selenium.webdriver.firefox.service import Service
from selenium import webdriver

service = Service()
driver = webdriver.Firefox(service=service)
driver.get("https://www.bilibili.com/video/BV1Es411Z7MH")
time.sleep(10)
title = driver.title
print(title)
source = driver.page_source.encode("utf-8")
print(source)
driver.quit()
```

- ç¡®å®å¯ä»¥çˆ¬å–åˆ°ç½‘é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220913-1663035476270)

- å¯ä»¥æŠŠè¿™ä¸ªç½‘é¡µå¯¹æ¥åˆ°lxmlç”Ÿæˆä¸€æ£µetreeä¹ˆï¼Ÿ

### å¯¹æ¥

```
from selenium.webdriver.firefox.service import Service
from selenium import webdriver
from lxml import etree
import time
service = Service()
driver = webdriver.Firefox(service=service)
driver.get("https://www.bilibili.com/video/BV1Es411Z7MH")
time.sleep(10)
source = driver.page_source
html = etree.HTML(source)
for elem in html.iter():
    print(elem.tag,end=",")
driver.quit()
```

- å°è¯•è¾“å‡ºæ‰€æœ‰çš„å…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220913-1663036896857)

### xpath

- å°è¯•xpath

```
import time

from selenium.webdriver.firefox.service import Service
from selenium import webdriver
from lxml import etree

service = Service()
driver = webdriver.Firefox(service=service)
driver.get("https://www.bilibili.com/video/BV1Es411Z7MH")
time.sleep(10)
source = driver.page_source
html = etree.HTML(source)
title = html.xpath("/html/head/title")[0]
print(title.text)
driver.quit()
```

- å…ˆè¯•è¯•title
	- æ— éšœç¢å¯¹æ¥
	- åŸæ¥ç”¨requestsè·å–ç½‘é¡µ
	- ç°åœ¨ç”¨seleniumè·å–ç½‘é¡µ
	- åé¢éƒ½å¯ä»¥å¯¹æ¥lxml

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241211-1733921975273) 

- æˆ‘æƒ³è¦è·å¾—å¼¹å¹•æ•°æ®å¯ä»¥å—ï¼Ÿ

### æ’ä»¶

- æ‰¾åˆ°åŸºç¡€xpath
	- å¹¶å¤åˆ¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241211-1733922101913) 

- è®¾ç½®é€šç”¨xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241211-1733922237576) 

- è½¬åŒ–ä¸ºä»£ç 

### ç»“æœ

```
import time

from selenium.webdriver.firefox.service import Service
from selenium import webdriver
from lxml import etree

service = Service()
driver = webdriver.Firefox(service=service)
driver.get("https://www.bilibili.com/video/BV1Es411Z7MH")
time.sleep(10)
source = driver.page_source
html = etree.HTML(source)
lst_span = html.xpath("/html/body/div[2]/div[2]/div[2]/div/div[6]/div[2]/div[1]/div/div/div[2]/a/p")

for span in lst_span:
    print(span.text)
driver.quit()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241211-1733923767932) 

- time.sleep(10)
	- å»¶æ—¶10ç§’
	- æƒ³è¦è®©ä»–èƒ½å¤Ÿè®¿é—®ç›¸åº”å…ƒç´ æ—¶å€™
	- å°±åœæ­¢å»¶æ—¶

### è¯¢é—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241212-1733967568658) 

### æœ€ç»ˆ

```
from selenium.webdriver.firefox.service import Service
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from lxml import etree

# åˆå§‹åŒ– WebDriver
service = Service(executable_path="geckodriver")
driver = webdriver.Firefox(service=service)

# æ‰“å¼€ç›®æ ‡ç½‘é¡µ
url = "https://www.bilibili.com/video/BV1Es411Z7MH"
driver.get(url)

try:
    # ç­‰å¾…ç‰¹å®šçš„ XPath å…ƒç´ å‡ºç°
    wait = WebDriverWait(driver, 30)  # æœ€å¤šç­‰å¾… 30 ç§’
    element = wait.until(EC.presence_of_element_located((By.XPATH, "/html/body/div[2]/div[2]/div[2]/div/div[6]/div[2]/div[1]/div/div/div[2]/a/p")))

    # è·å–é¡µé¢æºä»£ç 
    source = driver.page_source
    html = etree.HTML(source)
    
    # ä½¿ç”¨ XPath è·å–æ‰€æœ‰åŒ¹é…çš„ span å…ƒç´ 
    lst_span = html.xpath("/html/body/div[2]/div[2]/div[2]/div/div[6]/div[2]/div[1]/div/div/div[2]/a/p")

    # æ‰“å°æ¯ä¸ª span å…ƒç´ çš„æ–‡æœ¬å†…å®¹
    for span in lst_span:
        print(span.text)
finally:
    # å…³é—­æµè§ˆå™¨
    driver.quit()
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241212-1733967640377) 

## æ€»ç»“ 

- è¿™æ¬¡æˆ‘ä»¬å°è¯•ç”¨seleniumè®¿é—®äº†ä¸€ä¸ªç½‘é¡µ
	- åŸç†ä¸Š selenium å’Œ requestså‘è¯·æ±‚ å·®ä¸å¤š
	- éƒ½æ˜¯å‘é€è¯·æ±‚
	- åªä¸è¿‡requestsæ˜¯ç›´æ¥å‘é€è¯·æ±‚
	- seleniumç”¨çœŸå®çš„æµè§ˆå™¨å‘é€è¯·æ±‚
		- å¯ä»¥åŠ¨æ€åŠ è½½ä¸€äº›åå°çš„ä¸€äº›æ•°æ®
- å¾—åˆ°ç½‘é¡µæºæ–‡ä»¶ä¹‹å
	- éƒ½å¯ä»¥xpathè¿›è¡Œç­›é€‰æå–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/565019/uid1190679-20241211-1733923842542) 

- ç”¨seleniumè¿˜å¯ä»¥åšäº›
	- ä»€ä¹ˆ`ç‹¬ç‰¹`çš„ä¸œè¥¿ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ğŸ‘‹