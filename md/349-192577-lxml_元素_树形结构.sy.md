---
show: step
version: 1.0
enable_checker: true
---

# lxml å…ƒç´  æ ‘å½¢ç»“æ„

## å›å¿†

- å¯¼å…¥äº† requests æ¨¡å—
- å®Œæˆäº† http get çš„è¿‡ç¨‹
  - å‘å‡ºäº† request
  - å¾—åˆ°äº† response
  - çŠ¶æ€ç  200
- ä½†æ˜¯è¯»åˆ°çš„å†…å®¹æ˜¯
  - å­—èŠ‚åºåˆ—
  - å­—ç¬¦ä¸²åºåˆ—
- å¦‚ä½•è§£æ html è¯­è¨€å‘¢ï¼ŸğŸ¤”

### åˆ†æ

- æƒ³è¦è§£æ html
	- é‚£é¦–å…ˆå°±è¦äº†è§£ html è¯­è¨€çš„ç»“æ„
- `html`å…¨ç§°`h`yper-`t`ext `m`arkup `l`anguage
  - æ˜¯ä¸€é—¨ markup(æ ‡è®°æ€§) çš„è¯­è¨€
  - `markup` æ˜¯é  `html` æ ‡ç­¾å…ƒç´  å®ç°çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630451887662)

- å…ƒç´ ä½¿ç”¨çš„ `æ ‡ç­¾tag` åŒ…æ‹¬
  - å¼€å§‹æ ‡ç­¾
  - ç»“æŸæ ‡ç­¾
- æ ‡ç­¾æ˜¯æˆå¯¹å„¿å‡ºç°çš„

### å®ä¾‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630452159874)

- F12 å¯ä»¥æ£€æŸ¥å…ƒç´ 
	- ä¹Ÿå¯ä»¥å³é”®å…¨éƒ¨å±•å¼€
	- è¿™å°±æ˜¯ä¸€æ£µæ ‘
- ä¸€æ£µä»€ä¹ˆæ ‘ï¼Ÿ
  - ä¸€æ£µ Dom æ ‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668823401607)

- ä»€ä¹ˆæ˜¯ Dom æ ‘å‘¢ï¼Ÿ

### Dom æ ‘

- Document Object Model
  - æ–‡æ¡£å¯¹è±¡æ¨¡å‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453123602)

- æ ¹èŠ‚ç‚¹åœ¨ html
	- html é•¿å‡ºä¸¤ä¸ªåˆ†æ”¯
	  - head
	  - body
- ç„¶åå„è‡ªåº•ä¸‹è¿˜æœ‰å­åˆ†æ”¯

### æ¸²æŸ“è¿‡ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824125270)

- response åˆ°è¾¾æµè§ˆå™¨å
  - é¦–å…ˆéœ€è¦åˆ†è¯ parse
  - ç„¶åæ ¹æ®è¯­ä¹‰ semantic
  - å°è¯•ç”Ÿæˆä¸€æ£µ dom è¯­ä¹‰æ ‘
  - ç„¶åå†æ ¹æ® css æ ·å¼è¡¨
  - ä¸€æ­¥æ­¥åœ°è¿›è¡Œæ¸²æŸ“æˆä¸€ä¸ªå¥½çœ‹çš„é¡µé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824141134)

- çˆ¬è™«ä¹Ÿéœ€è¦æ¸²æŸ“å—ï¼Ÿ

### çˆ¬è™«

- çˆ¬è™«åªçœ‹å†…å®¹
	- ä¸éœ€è¦æ¸²æŸ“
  - ä½†ä¹Ÿéœ€è¦å…ˆç”Ÿæˆ dom æ ‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824279118)

- æ€ä¹ˆç”Ÿæˆå‘¢ï¼Ÿ
  - å°è¯•å¼•å…¥ä¸€ä¸ªåŒ…

### lxml

- è¿™æ˜¯ç›®å‰åˆ†æ html æœ€å¥½çš„åŒ…
  - lxml
  - æ˜¯ç¬¬ä¸‰æ–¹çš„åŒ…

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453359293)


- ç¬¬ä¸‰æ–¹çš„åŒ…å“ªé‡ŒæŸ¥è¯¢å¸®åŠ©å‘¢ï¼Ÿ

### æœç´¢

- åœ¨ç™¾åº¦æœç´¢lxml

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453447141)


- è¿™æ˜¯ä¸€ä¸ªå¼€æºçš„é¡¹ç›® lxml
  - http://lxml.de
	 - github çš„åœ°å€ä¹ŸæŒ‡å‘è¿™é‡Œ
  - l çš„æ„æ€æ˜¯ library
  - xml çš„æ„æ€å°±æ˜¯ e`x`tensible `m`arkup `l`anguage
- æ•´ä½“çš„æ„æ€å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿç®€å•åœ°å¤„ç† xml çš„ python åº“

### æ‰“å¼€lxml.de

- ä»–çš„ç‰¹ç‚¹æ˜¯
  - ç”¨ c è¯­è¨€å†™äº†
	- é«˜æ•ˆçš„ libxml2 å’Œ libxslt ä¸¤ä¸ªç±»åº“
	- å¹¶å°è£…æˆçš„ api
  - ä½¿ç”¨ python çš„ç®€æ´è¯­æ³•è°ƒç”¨
  - ç”Ÿæˆè‘—åçš„ ElementTree

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453454445)


- ä»–å¯ä»¥è§£æ xml
  - ä¹Ÿå°±å¯ä»¥è§£æ html
  - å…¶å® html æ˜¯ xml çš„ä¸€ä¸ªå­é›†
  - æ¯•ç«Ÿéƒ½æ˜¯ ml(Markup Language)
  - éƒ½æ˜¯æ ‘å‹ç»“æ„

### tutorial

- è¿›å…¥æ•™ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453747733)

- æœ¬æ¥æƒ³ç€æ˜¯è¯»å–ä¸€ä¸ªç½‘é¡µæ–‡ä»¶ç„¶åå†ç”Ÿæˆæ ‘
	- ä½†æ˜¯ç›®å‰çœ‹èµ·æ¥çš„æ€è·¯æ˜¯
	- åœ¨å†…å­˜é‡Œç›´æ¥é€šè¿‡è°ƒç”¨å‡½æ•°ç”Ÿæˆæ ‘
	- ç„¶åå†å¤„ç†è¿™æ£µæ ‘
- æ ‘å˜›
	- é¦–å…ˆè¦æœ‰æ ‘æ ¹èŠ‚ç‚¹

### æ‰æ ¹

- etree çš„æ„æ€æ˜¯
  - element tree
	- å…ƒç´ æ ‘
  - å…ƒç´ æ ‘æ ‘æ˜¯ç”±å…ƒç´ èŠ‚ç‚¹æ„æˆçš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824641142)

- å“ªä¸ªå…ƒç´ æ˜¯æ•´æ£µæ ‘çš„æ ¹å‘¢ï¼Ÿ

### htmlå…ƒç´ 

- è·å¾—èŠ‚ç‚¹çš„æ–¹å¼æ˜¯
  - etree.Element("html")
  - æˆ‘ä»¬çŸ¥é“ html å…ƒç´  æ˜¯ç½‘é¡µæ–‡æ¡£çš„æ ¹
  - è¿™ä¸ª htmlå…ƒç´ çš„èŠ‚ç‚¹ æ˜¯ æˆ‘ä»¬æ‰€æœ‰å…¶ä»–å…ƒç´ çš„æ ¹
  - ä¹Ÿæ˜¯æˆ‘ä»¬ä»æ— åˆ°æœ‰ç”Ÿæˆè¿™æ£µæ ‘çš„æ ¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824985944)

- å˜é‡åæ˜¯ et_html
  - et ä»£è¡¨ä»–æ˜¯ element tree ç±»å‹çš„
  - html ä»£è¡¨ä»–æ˜¯ html æ ¹èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668824997169)

- å…ˆæŠŠæ ¹æ‰ä¸‹ä¹‹å
  - éœ€è¦å¼€ææ•£å¶

### å¼€æ

- å¯ä»¥ä¸º html å…ƒç´ èŠ‚ç‚¹ 
	- append è¿½åŠ  
		- body å­èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668825103811)

- å¯ä»¥è¿½åŠ å‡ºæ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668825158114)

- ä½†æ˜¯htmlèŠ‚ç‚¹å’ŒbodyèŠ‚ç‚¹çš„å…³ç³»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

### å»ºç«‹å±‚çº§

- html èŠ‚ç‚¹ä¸‹	
	- append bodyèŠ‚ç‚¹
	- çˆ¶å­å…³ç³»ç”± append å‡½æ•°ç¡®å®š

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668825507395)

- åœ¨htmlå…ƒç´ èŠ‚ç‚¹ä¸Š
    - é™„åŠ (append)äº†bodyå­å…ƒç´ èŠ‚ç‚¹
    - è°ƒç”¨å‡½æ•°çš„æ˜¯ html å…ƒç´ èŠ‚ç‚¹ï¼Œæ˜¯çˆ¶äº²
    - è¢«è°ƒç”¨çš„æ˜¯ body å…ƒç´ èŠ‚ç‚¹ï¼Œæ˜¯å„¿å­
- æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸»åŠ¨è°ƒç”¨çš„æ„ä¹‰æ˜¯å¤šä¹ˆçš„é‡è¦å•Šï¼
	- è¿™æ ·ä¸¤ä¸ªèŠ‚ç‚¹å°±å»ºç«‹äº†çˆ¶å­å…³ç³»
- å¯ä»¥çœ‹çœ‹è¿™çˆ¶å­å…³ç³»å—ï¼Ÿ

### è¾“å‡ºçˆ¶å­å…³ç³»

- æˆ‘ä»¬å¯ä»¥æŠŠä»æ— ä¸­ç”Ÿæˆçš„è¿™æ£µæ ‘ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¾“å‡º
  - etree.tostring() å°†etreeèŠ‚ç‚¹è¾“å‡ºä¸ºå­—èŠ‚åºåˆ—
	  - å‚æ•° pretty_print=True å‚æ•°æ§åˆ¶å±‚çº§çš„ç¼©è¿›è¡¨ç¤º
  - å°†å­—èŠ‚åºåˆ—ç”¨ decode() è§£ç 
	- å¯ä»¥å°†å­—èŠ‚åºåˆ—è§£ç ä¸ºå­—ç¬¦ä¸²

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668825678940)

- å›å¿†ä¸€ä¸‹:
  - encode å‡½æ•°æŠŠå­—ç¬¦ä¸²ç¼–ç ä¸ºå­—èŠ‚åºåˆ—
  - decode å‡½æ•°æŠŠå­—èŠ‚åºåˆ—è§£ç ä¸ºå­—ç¬¦ä¸²
  - ç„¶åç”¨ print()å¯ä»¥æŠŠè¿™æ£µæ ‘è§£ç å‡ºçš„å­—ç¬¦ä¸²è¾“å‡ºå‡ºæ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668825695639)

- è¿™æ ·æˆ‘ä»¬ä¸ä½†ç»™ html å…ƒç´ è¿½åŠ äº† body å…ƒç´ 
	- è€Œä¸”è¾“å‡ºäº†æ•´æ£µæ ‘
- æœ‰è¿½åŠ å°±æœ‰åˆ é™¤

### åˆ é™¤

- append 
	- å¯ä»¥ç»™èŠ‚ç‚¹æ·»åŠ å­èŠ‚ç‚¹
- remove 
	- å¯ä»¥ç»™èŠ‚ç‚¹åˆ é™¤å­èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826282841)

- å°±å½“æˆ‘ html æ²¡æœ‰ body ä½ è¿™ä¸ªå„¿å­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826318896)

- å½“ç„¶åˆ äº†ä¹‹åè¿˜å¯ä»¥å†æ·»åŠ 

### å†å¼€æ”¯

- ç»§ç»­æ·»åŠ å­èŠ‚ç‚¹
	- è¿™æ¬¡æ·»åŠ ä¸¤ä¸ªå­èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826456193)

- æ·»åŠ æ–°çš„å­èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826496500)

- å†è¾“å‡ºæ•´æ£µæ ‘

### å†æ•£å¶

- body å­èŠ‚ç‚¹é‡Œé¢æœ‰ä¸€ä¸ª ul

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826661377)

- è¾“å‡ºç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221119-1668826689676)

- ä¸è¿‡ ul é‡Œé¢æœ‰ä¸‰ä¸ª li
- è¿™æ€ä¹ˆæ·»åŠ å‘¢ï¼Ÿ

## æ€»ç»“

- äº†è§£äº† html ä¸­çš„ dom æ ‘
- æ ‘æ˜¯ç”±èŠ‚ç‚¹å…ƒç´ ç»„æˆçš„
  - èŠ‚ç‚¹å…ƒç´ å¯ä»¥ç”¨ etree.Element()å¾—åˆ°
  - æœ€æ ¹æœ¬çš„å…ƒç´ æ˜¯æ ¹å…ƒç´ 
  - dom-tree çš„æ ¹å°±æ˜¯ html å…ƒç´ 
- html é‡Œé¢åŒ…æ‹¬å­èŠ‚å…ƒç´ ç‚¹
  - head
  - body
    - ul

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630453123602)

- é‡å¤çš„liå…ƒç´ æ€ä¹ˆæ·»åŠ (append)å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
