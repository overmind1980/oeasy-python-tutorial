---
show: step
version: 1.0
enable_checker: true
---

# xpath è·¯å¾„è¡¨è¾¾å¼
## å›å¿†
- è¿™æ¬¡æ·±å…¥äº†xpathä¸­çš„å…ƒç´ é€‰æ‹©
- å¯ä»¥æ ¹æ®å…ƒç´ å±‚çº§å…³ç³»é€‰æ‹©
	- ä¹Ÿå¯ä»¥æ ¹æ®å±æ€§å…·ä½“å€¼é€‰æ‹©
	- è¿˜å¯ä»¥æ ¹æ®æ–‡æœ¬çš„å€¼è¿›è¡Œé€‰æ‹©
	- ç”šè‡³å¼€å§‹ä½¿ç”¨é€šé…ç¬¦
- æˆ‘ä»¬æ¥çˆ¬å–ä¸€ä¸ªçœŸæ­£çš„ç½‘ç«™å§
	- æ¯”å¦‚oeasy.org
	- æ€ä¹ˆå¼„å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´

### ä¸‹è½½ç½‘ç«™

```
git clone http://gitee.com/overmind1980/oeasyorg.git
sudo cp oeasyorg /usr/share/engix/html/
sudo nginx
firefox http://localhost/oeasyorg/index2.html
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630587764363)

- åœ¨æµè§ˆå™¨é‡Œé¢èƒ½æ‰“å¼€ 
- å¹¶ä¸”è§‚å¯Ÿåˆ°ç¼–ç æ ¼å¼æ˜¯`utf-8`
- æˆ‘çš„ç›®æ ‡æ˜¯æŠŠçº¢æ¡†é‡Œé¢çš„èœå•æ‰’ä¸‹æ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630651569966)
### è·å–xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630587857006)

- å³é”®"çˆ±æƒ…"
- å¤åˆ¶xpath

### ä¿®æ”¹

- æŠŠåŸæ¥çš„get.pyè¿›è¡Œä¿®æ”¹

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasyorg/index2.html")
s_html = response.content.decode("utf-8")
et_html = etree.HTML(s_html)
et_target = et_html.xpath("/html/body/header/nav/ul/li/a")
for element in et_target:
    print(element.text)
```

- ç‰¹åˆ«æ³¨æ„è¦æŠŠä¸‹è½½åˆ°çš„å­—èŠ‚åºåˆ—
- è§£ç ä¸ºstring
- ç„¶åå†é€åˆ°parseé‡Œé¢åˆ†æ

### è¿è¡Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630588016510)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630588074620)

- è¿è¡ŒæˆåŠŸ
- å¦‚æœæˆ‘æƒ³æŠŠé“¾æ¥åœ°å€æ‹¿åˆ°
- åº”è¯¥æ€ä¹ˆåŠï¼Ÿ
- å»æºå¤´

### lxml

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630588320923)

- æ‰¾åˆ°etreeèŠ‚ç‚¹ä¹‹å
- æ‰¾åˆ°ä»–çš„attribå±æ€§
- è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªdictå­—å…¸
- ç„¶åæ‰¾åˆ°["href"]å±æ€§çš„å€¼

### åœ°å€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630588541314)

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasyorg/index2.html")
s_html = response.content.decode("utf-8")
et_html = etree.HTML(s_html)
et_target = et_html.xpath("/html/body/header/nav/ul/li/a")
for element in et_target:
    print(element.text)
    attributes = element.attrib
    print(attributes["href"])
```

### å­˜å…¥æ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630588772241)

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasyorg/index2.html")
s_html = response.content.decode("utf-8")
et_html = etree.HTML(s_html)
et_target = et_html.xpath("/html/body/header/nav/ul/li/a")
for element in et_target:
    print(element.text)
    attributes = element.attrib
    print(attributes["href"])
```
- ç›®å‰å­˜å‚¨çš„æ˜¯ç›¸å¯¹é“¾æ¥
- éœ€è¦è½¬åŒ–ä¸ºç»å¯¹é“¾æ¥

### ç»å¯¹é“¾æ¥
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630589231614)
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630589240273)

- å®Œæˆäº†é“¾æ¥å­—ç¬¦ä¸²çš„åˆ‡ç‰‡å’Œæ‹¼æ¥

```
import requests
from lxml import etree
response = requests.get("http://oeasy.org/index.html")
s_html = response.content.decode("utf-8")
et_html = etree.HTML(s_html)
et_target = et_html.xpath("/html/body/header/nav/ul/li/a")
with open("urls.txt","wt") as f:
    for element in et_target:
        attributes = element.attrib
        f.write("http://oeasy.org/"+attributes["href"][1:]+"\n")
```


### æ€»ç»“

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
	- oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
	- è·å–xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§hrefçš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”å­˜å‚¨åˆ°äº†urls.txtä¸­
- èƒ½æŠŠè¿™äº›é“¾æ¥éƒ½çˆ¬ä¸€éä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
