---
show: step
version: 1.0
enable_checker: true
---

# è¯­æ³• html ç”Ÿæˆ
## å›å¿†

- å·²ç»åœ¨å†…å­˜æ„å»ºäº†ä¸€æ£µetreeæ ‘äº†
- æ ‘æ˜¯ç”±èŠ‚ç‚¹æ„æˆçš„
- èŠ‚ç‚¹åŒ…æ‹¬
	- Entity
	- Comment
	- Element
- Elementå…ƒç´ æœ€é‡è¦ï¼Œä»–çš„æˆå‘˜æœ‰:
	- attrib å±æ€§å­—å…¸
	- text å…·ä½“æ–‡æœ¬
- è€Œä¸”å¯ä»¥ç”¨foréå†etree.Element
- ä½†æ˜¯æˆ‘ä»¬çš„ç´ ææ˜¯ç½‘ä¸Šçˆ¬åˆ°çš„ç½‘é¡µæºæ–‡ä»¶
- æºæ–‡ä»¶æ˜¯çº¯æ–‡æœ¬çš„
- å¦‚ä½•é€šè¿‡çº¯æ–‡æœ¬å¾—åˆ°ä¸€æ£µEtreeæ ‘å‘¢ï¼ŸğŸ¤”



### ä»å­—ç¬¦ä¸²ç”Ÿæˆ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630503765091)

```
some_xml_data = "<root>data</root>"
root = etree.fromstring(some_xml_data)
print(root.tag)
etree.tostring(root)
```

### ç”Ÿæˆ

- å¯ä»¥çœ‹åˆ°
	- å­—ç¬¦ä¸²å¯ä»¥ç”Ÿæˆetree
- ç»™ä»–ä¸€ä¸ªå­—ç¬¦ä¸²
- ä»–ç»™ä½ ä¸€ä¸ªetreeèŠ‚ç‚¹
- èŠ‚ç‚¹çš„æ ¹ç›®å½•æ ‡ç­¾
- å–å†³äºå­—ç¬¦ä¸²æœ€å¤–å±‚çš„æ ‡ç­¾

### ç”Ÿæˆetree

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466004301)

```python
root = etree.XML('<html><head/><body><p>Hello<br/>World</p></body></html>')
etree.tostring(root) 
# default: method = 'xml'
etree.tostring(root, method='xml') 
# same as above
etree.tostring(root, method='html')
print(etree.tostring(root, method='html', pretty_print=True).decode("utf-8"))
etree.tostring(root, method='text')
```

### æ“ä½œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466164563)

- è¿™æ ·ç¡®å®å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥ç”Ÿæˆä¸€æ£µetree
- æˆ‘ä»¬å°±æŠŠå­—ç¬¦ä¸²strå’Œetreeå…³è”èµ·æ¥äº†
- ä¸è¿‡å¦‚æœæˆ‘ä»¬çš„htmlä»£ç ä¸æ˜¯é‚£ä¹ˆè§„èŒƒåˆä¼šå¦‚ä½•å‘¢ï¼Ÿ


### ç”Ÿæˆhtml

- é¦–å…ˆæŸ¥è¯¢æ–‡æ¡£
- æ‰¾åˆ°parsersè¯­æ³•åˆ†æå™¨
- Parsing HTML
	- HTMLå°±æ˜¯ç½‘é¡µ
	- Parsingå°±æ˜¯æŠŠçº¯æ–‡æœ¬çš„htmlå˜æˆhtmlè¯­æ³•æ ‘å‹ç»“æ„
	- ä¹Ÿå°±æ˜¯ç”Ÿæˆæˆ‘ä»¬çš„etree

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634436427443)

### åŠ¨æ‰‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211017-1634437629258)

- å¦‚æœåªæœ‰éƒ¨åˆ†å…ƒç´ 
- ä¹Ÿå¯ä»¥ç”Ÿæˆä¸€æ£µhtmlæ ‘ä¹ˆï¼Ÿ

### éƒ¨åˆ†å…ƒç´ 

```
root = etree.HTML("<p>data</p>")
etree.tostring(root)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504602875)

- è¿™æ¬¡åº”è¯¥æ˜¯å¯ä»¥ç”Ÿæˆhtmlå…ƒç´ 
- è€Œä¸”å¯ä»¥è‡ªåŠ¨è¡¥å…¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504739828)

- è¯­æ³•åˆ†æå™¨ä¼šåˆ†æå‡ºç›®å‰çš„æ ‡ç­¾æƒ…å†µ
- ä»–ä¼šè‡ªåŠ¨è¡¥å…¨è¿™æ£µæ ‘
- æŠŠç›¸å…³å†…å®¹æ”¾åœ¨htmlçš„æ ¹ä¸‹çš„bodyèŠ‚ç‚¹çš„ä¸‹é¢

### ç§»é™¤ç©ºæ ¼

```
parser = etree.HTMLParser(remove_blank_text=True)
root = etree.HTML("<root>  <a/>   <b>  </b>     </root>", parser)
etree.tostring(root)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504914540)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505103633)

- æ ‡ç­¾ä¹‹é—´æ²¡æœ‰æ„ä¹‰çš„ç©ºæ ¼è¢«åˆ é™¤æ‰äº†

### æ§åˆ¶ç¼©è¿›

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505528348)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505481176)

```python
etree.indent(root, space="    ")
print(etree.tostring(root))
etree.indent(root, space="\t")
etree.tostring(root)
```

### ç¼–ç é—®é¢˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466274184)

```python
# å¾—åˆ°rootä¸­çš„brå…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ª
# get first result of iteration
br = next(root.iter('br'))  
#å°†br.tailèµ‹å€¼ä¸ºä¸€ä¸ªunicodeå­—ç¬¦ä¸²
br.tail = u'W\xf6rld'
# æƒ³è¦ç›´æ¥ç”¨é»˜è®¤ç¼–ç æ–¹å¼è¾“å‡ºæ˜¯ä¸è¡Œçš„
etree.tostring(root, method='text')  
# å¿…é¡»æŒ‡å®šç¼–ç æ ¼å¼ä¸ºutf-8
etree.tostring(root, method='text', encoding="utf-8")
```

### æ“ä½œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211016-1634393774811)

- æˆ‘ä»¬å¯ä»¥ä»æ ‘ä¸Šæ‰¾åˆ°brè¿™ä¸ªèŠ‚ç‚¹
- ç„¶åè®¾ç½®ä»–çš„å°¾å·´
- è¿™ä¸ªå°¾å·´ä¸æ˜¯ä¸€èˆ¬çš„asciiå­—ç¬¦
- åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºä¸º&#246;
- è¿™ä¸ªå­—ç¬¦çš„unicodeç¼–ç æ˜¯`\xf6`

### utf-8
- è¿™ä¸ªå­—ç¬¦çš„unicodeç¼–ç æ˜¯`\xf6`
- ä¼ è¾“çš„æ—¶å€™éœ€è¦ä½¿ç”¨utf-8
- ç¼–ç ä¸ºutf-8æ–¹å¼å
- å æ®ä¸¤ä¸ªå­—èŠ‚
- ä¸º`\xc3\xb6`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466672155)

### è¿‡ç¨‹
- rootçš„ç±»å‹æ˜¯unicodeç¼–ç çš„å­—èŠ‚æµbytes
- ä¼ è¾“æ—¶éœ€è¦æŠŠä»–å˜æˆutf-8ç¼–ç 
- è¾“å‡ºçš„æ—¶å€™è¿˜éœ€è¦æŠŠä»–ä»utf-8è§£ç ä¸ºå…·ä½“çš„å­—ç¬¦
- è¿›è¡Œè¾“å‡º

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211016-1634393857739)


## æ€»ç»“

- ç»ˆäºå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ„å»ºä¸€æ£µetreeäº†
- é€šè¿‡etree.HTML()å‡½æ•°å°†ç½‘é¡µæºæ–‡ä»¶è¿›è¡Œparse(è¯­æ³•åˆ†æ)ç”Ÿæˆä¸€æ£µetree
- é€šè¿‡etree.HTMLParser()å‡½æ•°è®¾ç½®parser
		- parser = etree.HTMLParser(remove_blank_text=True)
	- ç”¨parserä½œä¸ºç”Ÿæˆæ ‘çš„æ—¶å€™çš„å‚æ•°
			- root = etree.HTML("<root>  <a/>   <b>  </b>     </root>", parser)
	- parserå¯ä»¥æ§åˆ¶è¯­æ³•
- etee.indent()å‡½æ•°å¯ä»¥æ§åˆ¶etreeè¾“å‡ºçš„ç¼©è¿›
	- etree.indent(root, space="\t")
	- etree.tostring(root)
- æˆ‘èƒ½ç”¨å‰é¢çš„requestsçˆ¬åˆ°çš„å­—ç¬¦ä¸²ç”Ÿæˆetreeå…ƒç´ ä¹ˆï¼Ÿ
	- é€šè¿‡requestè·å¾—ç½‘é¡µæºæ–‡ä»¶
	- é€šè¿‡etreeæŠŠæºæ–‡ä»¶è½¬åŒ–ä¸ºä¸€æ£µetreeçš„å…ƒç´ æ ‘
- å°±æ˜¯æŠŠ
	- requestå¾—åˆ°çš„responseçš„content
	- å½“åšetree.HTML()éœ€è¦çš„å‚æ•°
	- å¯¹æ¥èµ·æ¥ï¼Œå¯ä»¥ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
