---
show: step
version: 1.0
enable_checker: true
---

# VizTracer

## å›å¿†

- ä¸Šæ¬¡çœ‹è§
- é€’å½’è°ƒç”¨çš„å‹(push)æ ˆ(stack)è¿‡ç¨‹
	- ä¸€å±‚å±‚å‹
	- å‹çš„æ˜¯å¸§(frame)
	- ä¸åŒçš„å¸§æœ‰ä¸åŒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡
- ä»£ç (code)å¯¹è±¡(object)å°±ä¸€ä¸ª
	- é€»è¾‘ä¸å˜
	- åå¤æ‰§è¡Œ
- èƒ½æ›´ç›´è§‚ä¸€ç‚¹ä¹ˆï¼ŸğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176673567)

### å‡½æ•°å †æ ˆæŸ¥çœ‹å·¥å…·VizTrace

- VizTracer
	- Visualå¯è§†åŒ–
	- Tracerè·Ÿè¸ªå™¨
	- https://github.com/gaogaotiantian/viztracer

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660632115863)

- å®‰è£…ä¹‹åæˆ‘ä»¬å…ˆçœ‹çœ‹ç”»æ¾æ ‘

### ç”»æ¾æ ‘ç¨‹åº

```
def draw_pine(n,color="white"):
    draw_pine_head(n,color)
    draw_pine_body()

def draw_pine_head(n,color="white"):
    print(color)
    print("\\33["+d_colors[color]+"m",end="")
    draw_pine_triangle()
    draw_pine_triangle()
    print("\\33[0m",end="")

def draw_pine_triangle():
    for i in range(6):
        for j in range(6-i):
            print(" ",end="",sep="")
        for k in range(2*i+1):
            print("*",end="",sep="")
        print()


def draw_pine_body():
    for i in range(5):
        for j in range(5):
            print(" ",end="",sep="")
        for k in range(3):
            print("*",end="",sep="")
        print()
    for i in range(6):
        for j in range(6-i):
            print(" ",end="",sep=",")

if __name__ == '__main__':
    d_colors = {"green":"32","yellow":"33","white":"0"}
    draw_pine(6,"yellow")
```

- å¦‚æœå¤åˆ¶ç²˜è´´æœ‰é—®é¢˜
- å¯ä»¥å…ˆåœ¨æœ¬åœ°åš
- ç„¶åä¸Šä¼ ä¸Šæ¥

### ç”Ÿæˆjson

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660632243058)

- ç„¶åç”¨çº¢æ¡†ä¸­çš„è¯­å¥
- æŸ¥çœ‹ç”Ÿæˆçš„å †æ ˆä¿¡æ¯æ–‡ä»¶
	- result.json

### æŸ¥çœ‹å †æ ˆä¿¡æ¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660632524910)

- ä»–ä¼šæ‰“å¼€ä¸€ä¸ªç«ç‹
- åœ¨ç«ç‹é‡Œé¢æ˜¾ç¤ºç›¸åº”çš„ä¿¡æ¯

### æ˜¾ç¤ºè¿‡ç¨‹

- ç”»æ¾æ ‘åŒ…æ‹¬
	- æ¾æ ‘å¤´
		- 2ä¸ªä¸‰è§’
	- æ¾æ ‘èº«ä½“
- å…·ä½“éƒ½æ˜¯é€šè¿‡è°ƒç”¨å†…ç½®çš„printå®Œæˆçš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660632792982)

- å±‚æ¬¡å…³ç³»éå¸¸æ¸…æ™°

### é€‰ä¸­ç”»æ ‘å† å‡½æ•°

- é€‰ä¸­`draw_pine_head`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660633005257)

- æ·±åº¦(depth)æ˜¯3
- çˆ¶çº§å †æ ˆidæ˜¯draw_pineçš„å †æ ˆid
- çˆ¶çº§idæ˜¯draw_pineçš„id
- ä¹Ÿå°±æ˜¯è¯´`draw_pine_head`æ˜¯`draw_pine`çš„å„¿å­

### é€‰ä¸­å·¦è¾¹çš„ç”»ä¸‰è§’å‡½æ•°

- é€‰ä¸­`draw_pine_triangle`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660633755743)

- æ·±åº¦(depth)æ˜¯4
- çˆ¶çº§å †æ ˆidæ˜¯`draw_pine_head`çš„å †æ ˆid
- çˆ¶çº§idæ˜¯`draw_pine_head`çš„id
- ä¹Ÿå°±æ˜¯è¯´`draw_pine_triangle`æ˜¯`draw_pine_head`çš„å„¿å­

### é€‰ä¸­å³è¾¹çš„ç”»ä¸‰è§’å‡½æ•°

- ä»–å’Œå·¦è¾¹çš„å…„å¼Ÿä¸€æ ·
- éƒ½æ˜¯`draw_pine_head`çš„å„¿å­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660633917019)

- ä½†æ˜¯åˆ‡ç‰‡å·(SliceID)æ˜¯70
- ä»–çš„å“¥å“¥è°ƒç”¨äº†å¾ˆå¤šprintå æ®äº†ä¸å°‘SliceID

### ç¼©æ”¾ç§»åŠ¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660634133519)

- w æ¨ªå‘ç¼©å°è§‚æµ‹èŒƒå›´
- s æ¨ªå‘æ‰©å¤§è§‚æµ‹èŒƒå›´
- a è§‚æµ‹èŒƒå›´å·¦ç§»
- d è§‚æµ‹èŒƒå›´å³ç§»
- f å›åˆ°æœ€åˆçš„å…¨éƒ¨è§‚æµ‹èŒƒå›´

### é˜¶ä¹˜å‡½æ•°

- ç¡®å®å¯ä»¥çœ‹åˆ°å±‚å±‚è°ƒç”¨çš„æ ·å­äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660636699299)

- ä¸è¿‡æ²¡æœ‰å‚æ•°å’Œè¿”å›å€¼
- æ€»æœ‰ç‚¹ä¸åˆ°ä½

### æŸ¥è¯¢å¸®åŠ©

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660636745013)

- æ‰¾åˆ°ä¸¤ä¸ªå‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660636823900)

### å¸¦å‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660636984895)

```shell
viztracer --log_func_retval --log_func_args test.py
vizviewer result.json
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220816-1660637291832)

- ç¡®å®å¯ä»¥çœ‹åˆ°è¿”å›å€¼äº†

### æ€»ç»“ 
- æˆ‘ä»¬è¿™æ¬¡äº†è§£äº†ä¸€ä¸ªå‡½æ•°å †æ ˆè·Ÿè¸ªå¯è§†åŒ–å·¥å…·
	- viztracer
	- è¿™é‡Œèƒ½çœ‹æ¸…çˆ¶å­å…„å¼Ÿå…³ç³»
	- è°ƒç”¨çš„é¡ºåº
	- ç”¨æ—¶ç­‰ç­‰
- è¿˜èƒ½çœ‹åˆ°å‚æ•°å’Œè¿”å›å€¼
	- çœŸçš„å¯ä»¥çœ‹åˆ°é€’å½’è°ƒç”¨ä¸€å±‚å±‚çš„æ ·å­
- ä¸è¿‡é˜¶ä¹˜è²Œä¼¼ä¹Ÿå¯ä»¥ç”¨forå¾ªç¯æ¥åš
	- é‚£ä¹ˆç©¶ç«Ÿåº”è¯¥ç”¨é€’å½’è¿˜æ˜¯å¾ªç¯
- - é€’å½’çœŸçš„å¯ä»¥è½¬åŒ–ä¸ºå¾ªç¯ä¹ˆï¼Ÿï¼ŸğŸ¤”
- æˆ‘ä»¬ä¸‹æ¬¡å†è¯´ğŸ‘‹
