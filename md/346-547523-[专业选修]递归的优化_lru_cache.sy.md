---
show: step
version: 1.0
enable_checker: true
---

# åµŒå¥—è°ƒç”¨

## å›å¿†

- ä¸Šæ¬¡ç ”ç©¶äº†è®¡æ—¶å‡½æ•°timeit.timeit()
	- å¯ä»¥æŠŠä¸€æ®µä»£ç çš„æ–‡æœ¬ä½œä¸ºå‚æ•°ä¼ è¿›æ¥
	- ç„¶åé‡å¤æ‰§è¡Œnumberæ¬¡
	- æŠŠè¿™ä¸ªæ—¶é—´è®°å½•ä¸‹æ¥
	- è¿™æ ·å°±å¯ä»¥æ¯”è¾ƒé€’å½’å’Œå¾ªç¯çš„è¿è¡Œæ—¶é—´
- å®è·µå‡ºçœŸçŸ¥
- å¾—å‡ºå“ªä¸ªå‡½æ•°æ›´å¥½
- æˆ–è€…è¯´å¾—å‡ºå“ªä¸ªç®—æ³•æ›´å¥½
- å¾ˆæ˜æ˜¾æ˜¯å¾ªç¯æ¯”é€’å½’å¿«å¾ˆå¤š
- å…³é”®é€’å½’æœ‰å¾ˆå¤šé‡å¤çš„å†…å®¹
- æˆ‘å¯ä»¥æŠŠè¿™äº›é‡å¤çš„éƒ¨åˆ†ç»™ä¼˜åŒ–äº†ä¹ˆï¼Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660811378276)

### ä¼˜åŒ–æ€è·¯

- åˆ¶ä½œä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¼“å­˜å­—å…¸

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660811712626)

- å¦‚æœå­—å…¸é‡Œé¢æœ‰è¿™ä¸ªæ•°å­—
	- å°±ä»å­—å…¸é‡Œé¢å‡ºè¿”å›å€¼
- å¦‚æœå­—å…¸é‡Œæ²¡æœ‰è¿™ä¸ªæ•°å­—
	- å°±è®¡ç®—
	- å¹¶æŠŠè¿™ä¸ªåå€¼å¯¹åŠ å…¥å­—å…¸

### ä»£ç 

```
fibonacci_cache = {}

def fibo_recur_cached(n):
    if n in fibonacci_cache:
        return fibonacci_cache[n]
    elif n == 1:
        return 1
    elif n == 2:
        return 1
    else:
        value =  fibo_recur_cached(n-1) + fibo_recur_cached(n-2)
        fibonacci_cache[n] = value
        return value

def fibo_get_series(n):
    """Return a list containing the Fibonacci series up to n."""
    i = 0
    result = 0
    l = []
    while result<n :
        l.append(result)
        i += 1
        result = fibo_recur_cached(i)
    return l

fibo_get_series(10000)
```

### ä¿®æ”¹main.py

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660816688315)

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660816695971)

- å·®è·è¢«å‹ç¼©åˆ°åä»¥å†…

### å¯è§†åŒ–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660816810442)

- ç”±äºå‰é¢æ‰“å¥½äº†é“ºå«
- åé¢ç›´æ¥ä»cacheé‡Œé¢å¾—åˆ°ç›¸åº”çš„å€¼å°±å¥½äº†
- ä¸è¿‡è¿™æœ‰ç‚¹ç ´åå‡½æ•°çš„å®Œæ•´æ€§
- å¤–é¢è¿˜å¾—æœ‰ä¸€ä¸ªå­—å…¸
- è¯´å¥½çš„å°è£…æ€§(encapsulation)å‘¢?

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660817072959)

### lru_cache

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660817441334)

### æ–°çš„æ–¹å¼

- ä½¿ç”¨@lru_cacheä½œä¸ºè£…é¥°å™¨(decorator)

```
from functools import lru_cache

@lru_cache(maxsize = 1000)
def fibo_recur_lru_cached(n):
    if n == 1:
        return 1
    elif n == 2:
        return 1
    else:
        value =  fibo_recur_lru_cached(n-1) + fibo_recur_lru_cached(n-2)
        return value

def fibo_get_series(n):
    """Return a list containing the Fibonacci series up to n."""
    i = 0
    result = 0
    l = []
    while result<n :
        l.append(result)
        i += 1
        result = fibo_recur_lru_cached(i)
    return l

fibo_get_series(10000)
```

- è¿™æ ·å°±çœŸçš„å¯ä»¥å®Œæˆå°è£…äº†
- æˆ‘ä»¬å»æµ‹é€Ÿåº¦

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660817838385)

### æµ‹é€Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660817916278)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660817924231)
- å·®è·10ä»¥å†…
- ç¡®å®æœ‰ä¼˜åŒ–
- æ€ä¹ˆä¼˜åŒ–çš„å‘¢ï¼Ÿ

### ç»†èŠ‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660819147908)

- è°ƒç”¨å‡½æ•°å¯¹è±¡çš„cache_info()

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660819158345)

- å‡½æ•°è¢«è°ƒç”¨38æ¬¡
- ç¼“å­˜é‡Œé¢æ²¡æœ‰çš„21æ¬¡
- æœ€å¤§å¤§å°1000
- å½“å‰å¤§å°21
- å¦‚ä½•ç†è§£lruå‘¢ï¼Ÿ

### cache
- cacheæŒ‡çš„æ˜¯ç¼“å­˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660824893745)

- lruæŒ‡çš„æ˜¯ä¸€ç§ç¼“å­˜(cache)ç½®æ¢ç­–ç•¥
- å°±æ˜¯æŠŠå“ªäº›ç¼“å­˜æ¸…ç©ºï¼Œå“ªäº›ç¼“å­˜ç•™ç€çš„ç­–ç•¥

- æœ‰å„ç§ç¼“å­˜ç½®æ¢ç®—æ³•
	- FIFOï¼ˆFirst In, First Outï¼‰å…ˆé€²å…ˆå‡ºç®—æ³•
	- LFUï¼ˆLeast Frequently Usedï¼‰æœ€è¿‘æœ€ä¸å¸¸ä½¿ç”¨ç®—æ³•
	- LRUï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•
	- NMRUï¼ˆNot Most Recently Usedï¼‰éæœ€è¿‘ä½¿ç”¨ç®—æ³•


### lru

- åœ¨æˆ‘ä»¬è¿™é‡Œç¼“å­˜çš„æ˜¯å‡½æ•°è¿è¡Œçš„ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660819996791)

- æ€»ç©¿çš„è¡£æœæ”¾å‰é¢
	- æœ‰æ—¶ä¼šç»Ÿè®¡ç©¿è¡£æ¬¡æ•°
- ä¸ç©¿çš„è¡£æœæ”¾åé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660825046893)

- æœ‰æ–°è¡£æœçš„æ—¶å€™
- æœ€ä¸é•¿ç©¿çš„è¡£æœè¢«æ›¿æ¢å‡ºç¼“å­˜

### æºç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660820517842)

- å…·ä½“å®ç°æ˜¯åœ¨`_lru_cache`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220818-1660820591931)

- ä¸è¿‡è¿™ä¸ªå‡½æ•°é‡Œé¢æ€ä¹ˆè¿˜èƒ½å®šä¹‰å‡½æ•°å‘¢ï¼Ÿ
- è¿™æ€ä¹ˆç†è§£å‘¢ï¼Ÿ
- æˆ‘ä»¬å…ˆå»æ€»ç»“ä¸€ä¸‹


### æ€»ç»“ 
- è¿™æ¬¡ç ”ç©¶äº†å‡½æ•°çš„ç¼“å­˜(cache)
	- æœ‰äº›å‡½æ•°åå¤è¿è¡Œ
	- å¦‚æœç®—æ³•ã€å‚æ•°éƒ½ä¸å˜çš„è¯
	- å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å–å¾—è¿è¡Œç»“æœ
- æˆ‘ä»¬ç”¨çš„æ˜¯functoolsä¸­çš„lru_cache
	- lruæŒ‡çš„æ˜¯Least Frequently Used
	- æœ€ä¸å¸¸ç©¿çš„è¡£æœè¢«æ–°è¡£æœæ›¿æ¢æ‰
- ä¸è¿‡æŸ¥çœ‹æºä»£ç æˆ‘ä»¬å‘ç°
- å‡½æ•°é‡Œé¢è¿˜å¯ä»¥æœ‰å‡½æ•°ï¼Ÿï¼Ÿ
- è¿™æ€ä¹ˆç†è§£ï¼Ÿï¼ŸğŸ¤”
- æˆ‘ä»¬ä¸‹æ¬¡å†è¯´ğŸ‘‹



