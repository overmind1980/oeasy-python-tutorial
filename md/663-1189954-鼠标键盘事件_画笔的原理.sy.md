---
show: step
version: 1.0
enable_checker: true
---

# opencv

## å›å¿†

- ä¸Šæ¬¡ç ”ç©¶äº†é¢å‘ä¼ ç»Ÿç»ˆç«¯çš„å›¾ç‰‡ç”Ÿæˆæ•ˆæœ
	- 80 * 24 å­—ç¬¦
	- 640 * 480 åƒç´ 
- å…¶ä¸­
	- å­—ä½“ã€é¢œè‰²éƒ½å¯ä»¥è¿›è¡Œä¿®æ”¹
- é™¤äº†ç»ˆç«¯æ˜¾ç¤ºå™¨ä¹‹å¤–
- å¯ä»¥è®©é¼ æ ‡é”®ç›˜å‚ä¸å›¾åƒç”Ÿæˆå—ï¼ŸğŸ¤¡

### é¼ æ ‡æŒ‰ä¸‹

```
import cv2 as cv                                                              
import numpy as np
img = np.zeros((200,200))
                
def draw_circle(event,x,y,flags,param):
    if event == cv.EVENT_LBUTTONDOWN:
        cv.circle(img,(x,y),20,255,-1)
                
cv.namedWindow("img")
cv.setMouseCallback("img",draw_circle)
while True:     
    cv.imshow("img",img)
    n = cv.waitKey(5)
    if n == ord("q"):
        break   
    elif n == ord("s"):
        cv.imwrite("res.jpg",img)
        print("pictrure saved!")
                
cv.destroyAllWindows()
```

- é¼ æ ‡å³é”®è½ä¸‹çš„æ—¶å€™	
	- å°±ä¼šç”»ä¸€ä¸ªåœ†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240109-1704810317000)

- é¼ æ ‡ç§»åŠ¨å¯ä»¥æœ‰äº‹ä»¶å“åº”å‡½æ•°å—ï¼Ÿ

### äº‹ä»¶å“åº”

```
import cv2
import numpy as np

def mouse_callback(event, x, y, flags, param):
    if event == cv2.EVENT_MOUSEMOVE:
        print("Current position: ({}, {})".format(x, y))
    global image
    image = cv2.line(image,(200,200),(x,y),(255,0,0),5)

# åˆ›å»ºä¸€ä¸ªç©ºç™½ç”»å¸ƒä½œä¸ºè¾“å…¥å›¾åƒ
image = np.zeros((400, 400, 3), dtype=np.uint8)

# è®¾ç½®é¼ æ ‡å›è°ƒå‡½æ•°
cv2.namedWindow('Image')
cv2.setMouseCallback('Image', mouse_callback)

while True:
    # å°†å›¾åƒæ˜¾ç¤ºåˆ°çª—å£ä¸­
    cv2.imshow('Image', image)

    # æŒ‰ä¸‹ESCé”®æ—¶é€€å‡ºå¾ªç¯
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# å…³é—­æ‰€æœ‰æ‰“å¼€çš„çª—å£
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240120-1705751280977)

- å¯ä»¥åšå‡ºç‚¹äº’åŠ¨è‰ºæœ¯å—ï¼Ÿ

### äº’åŠ¨åª’ä½“è‰ºæœ¯

```
import cv2
import numpy as np

def mouse_callback(event, x, y, flags, param):
    if event == cv2.EVENT_MOUSEMOVE:
        print("Current position: ({}, {})".format(x, y))
    global image
    image = np.zeros((400, 400, 3), dtype=np.uint8)
    ix = 400 - x
    iy = 400 - y
    image = cv2.rectangle(image,(x,200,y,y),(0,0,255),5)
    image = cv2.circle(image,(ix,200),y,(0,255,0),5)

# åˆ›å»ºä¸€ä¸ªç©ºç™½ç”»å¸ƒä½œä¸ºè¾“å…¥å›¾åƒ
image = np.zeros((400, 400, 3), dtype=np.uint8)

# è®¾ç½®é¼ æ ‡å›è°ƒå‡½æ•°
cv2.namedWindow('Image')
cv2.setMouseCallback('Image', mouse_callback)

while True:
    # å°†å›¾åƒæ˜¾ç¤ºåˆ°çª—å£ä¸­
    cv2.imshow('Image', image)

    # æŒ‰ä¸‹ESCé”®æ—¶é€€å‡ºå¾ªç¯
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# å…³é—­æ‰€æœ‰æ‰“å¼€çš„çª—å£
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240120-1705751612848)

- å¯ä»¥è®¾ç½®é”®ç›˜ä¸ç”Ÿæˆå›¾åƒçš„æ•ˆæœå—ï¼Ÿ

- å¯ä»¥å†è®¾ç½®é¼ æ ‡æŠ¬èµ·æ—¶çš„æ•ˆæœå—ï¼Ÿ

### é¼ æ ‡æ¾å¼€
```
import numpy as np
import cv2       
drawing=False    
mode=True        
ix,iy=-1,-1      
def draw_circle(event,x,y,flags,param):
    global ix,iy,drawing,mode
    if event==cv2.EVENT_LBUTTONDOWN:
        drawing=True
        ix,iy=x,y
    elif event==cv2.EVENT_MOUSEMOVE and flags==cv2.EVENT_FLAG_LBUTTON:
        if drawing==True:
            if mode==True:
                cv2.rectangle(img,(ix,iy),(x,y),(0,255,0),-1)
            else:
                cv2.circle(img,(x,y),3,(0,0,255),-1)
    elif event==cv2.EVENT_LBUTTONUP:
        drawing==False
                 
img=np.zeros((512,512,3),np.uint8)
cv2.namedWindow('image')
cv2.setMouseCallback('image',draw_circle)
while(1):        
    cv2.imshow('image',img)                                                    
    k=cv2.waitKey(1)&0xff
    if k==ord('m'):
        mode=not mode
    elif k==27:  
        break
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240109-1704810420689)

- å¯ä»¥åšä¸€ä¸ªç”»ç¬”å—ï¼Ÿ

### ç”»ç¬”åˆ¶ä½œ

```
import numpy as np
import cv2
b_drawing=False
def draw_circle(event,x,y,flags,param):
    global b_drawing
    if event==cv2.EVENT_LBUTTONDOWN:
        b_drawing=True
    elif event==cv2.EVENT_MOUSEMOVE and flags==cv2.EVENT_FLAG_LBUTTON:
        if b_drawing==True:
            cv2.circle(img,(x,y),10,(0,0,0),-1)
    elif event==cv2.EVENT_LBUTTONUP:
        b_drawing==False

img=np.ones((512,512,3),np.uint8)*255
cv2.namedWindow('image')
cv2.setMouseCallback('image',draw_circle)
while(1):
    cv2.imshow('image',img)
    k=cv2.waitKey(1)&0xff
    if k==ord('m'):
        mode=not mode
    elif k==27:
        break
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240217-1708156984090)

- å¯ä»¥è°ƒèŠ‚ç¬”åˆ·çš„å¤§å°å—ï¼Ÿ

### è°ƒæ•´ç¬”åˆ·

```
import numpy as np
import cv2
b_drawing=False
radius = 10

def draw_circle(event,x,y,flags,param):
    global b_drawing,radius
    if event==cv2.EVENT_LBUTTONDOWN:
        b_drawing=True
    elif event==cv2.EVENT_MOUSEMOVE and flags==cv2.EVENT_FLAG_LBUTTON:
        if b_drawing==True:
            cv2.circle(img,(x,y),radius,(0,0,0),-1)
    elif event==cv2.EVENT_LBUTTONUP:
        b_drawing==False

def set_radius(value):
    global radius
    radius = value
    print(value)

img=np.ones((512,512,3),np.uint8)*255
cv2.namedWindow('image')
cv2.setMouseCallback('image',draw_circle)
cv2.createTrackbar('T', 'image', 0, 100, set_radius)
while(1):
    cv2.imshow('image',img)
    k=cv2.waitKey(1)&0xff
    if k==ord('m'):
        mode=not mode
    elif k==27:
        break
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240217-1708157487775)

### æ§åˆ¶é—´è·

```
if ((x-ix)**2 + (y-iy)**2)**0.5 >= distance:
    cv2.circle(img,(x,y),radius,(128,128,128),-1)
    ix = x
    iy = y
```

- å¦‚æœå…‰æ ‡å½“å‰ç‚¹(x,y)
	- è·ç¦»ä¸Šä¸€ç‚¹çš„è·ç¦»((x-ix)**2 + (y-iy)**2)**0.5 
	- å¤§äºç»™å®šçš„distance
	- å°±è½ç¬”ç”»ä¸‹åœ†åœˆ

```import numpy as np
import cv2
import math
b_drawing=False
radius = 10
ix,iy = -1,-1
distance = 0

def draw_circle(event,x,y,flags,param):
    global b_drawing,radius,distance,ix,iy
    if event==cv2.EVENT_LBUTTONDOWN:
        b_drawing=True
    elif event==cv2.EVENT_MOUSEMOVE and flags==cv2.EVENT_FLAG_LBUTTON:
        if b_drawing==True:
            if ((x-ix)**2 + (y-iy)**2)**0.5 >= distance:
                cv2.circle(img,(x,y),radius,(128,128,128),-1)
                ix = x
                iy = y
    elif event==cv2.EVENT_LBUTTONUP:
        b_drawing==False

def set_distance(value):
    global distance
    distance = value
    print(value)

def set_radius(value):
    global radius
    radius = value
    print(value)

img=np.ones((512,512,3),np.uint8)*255
cv2.namedWindow('image')
cv2.setMouseCallback('image',draw_circle)
cv2.createTrackbar('radius', 'image', 0, 100, set_radius)
cv2.createTrackbar('distance', 'image', 0, 100, set_distance)
while(True):
    cv2.imshow('image',img)
    k=cv2.waitKey(1)&0xff
    if k==ord('m'):
        mode=not mode
    elif k==27:
        break
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240217-1708160664784)

### æ€»ç»“ ğŸ¤”

- è¿™æ¬¡ç ”ç©¶äº†é¼ æ ‡çš„å„ç§äº’åŠ¨æ•ˆæœ
- é”®ç›˜å¯ä»¥æœ‰ä»€ä¹ˆäº’åŠ¨æ•ˆæœå—ï¼Ÿï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ğŸ‘‹


