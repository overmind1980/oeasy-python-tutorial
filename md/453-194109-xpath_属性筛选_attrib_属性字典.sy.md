---
show: step
version: 1.0
enable_checker: true
---

# è¯­æ³• html ç”Ÿæˆ

## å›å¿†

- ä¸Šæ¬¡æ·±å…¥äº† xpath
- xpath å¯ä»¥ç”¨æ¥ç­›é€‰ xml æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹
- xpath æœ‰ä¸€å¥—è‡ªå·±çš„è¯­æ³•


| ç¬¦å· | ä½œç”¨ |
| --- | --- |
| . | é€‰å–å½“å‰èŠ‚ç‚¹ |
|  / | ä»æ ¹èŠ‚ç‚¹é€‰å– æˆ– è¡¨ç¤ºå±‚çº§å…³ç³» |
| nodename | åœ¨å½“å‰ä½ç½®é€‰æ‹©æ­¤ç±»èŠ‚ç‚¹ | 
| // | åœ¨ä»»æ„å±‚çº§è·¯å¾„ä¸‹ |
| .. | é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ | 
| @ | é€‰å–å±æ€§ |

- è¿™ä¸ª@é€‰å±æ€§æˆ‘ä»¬è¿˜æ²¡æœ‰è¯•è¯•
- æ€ä¹ˆç”¨å‘¢ï¼ŸğŸ¤”

### ç›´æ¥æœç´¢å…ƒç´ 

```python
import requests
from lxml import etree
response = requests.get("http://localhost")
b_html = response.content
print(b_html)
et_html = etree.HTML(b_html)
l_attrib = et_html.xpath("//a")
print(l_attrib)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027535333)

- ä»»æ„è·¯å¾„ä¸‹çš„aå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027552580)

### æ ¹æ®æ˜¯å¦æœ‰å±æ€§è°“è¯ç­›é€‰

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027653580)

- ä»»æ„è·¯å¾„ä¸‹æœ‰ä»»æ„å±æ€§çš„aå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027673635)

### æ ¹æ®å±æ€§ç±»å‹ç­›é€‰

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027751966)

- ä»»æ„è·¯å¾„ä¸‹æœ‰hrefå±æ€§çš„aå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027759394)

### æ ¹æ®å±æ€§å€¼ç­›é€‰

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027868489)

- ä»»æ„è·¯å¾„ä¸‹
	- æœ‰hrefå±æ€§å€¼ä¸ºhttp://nginx.org/çš„
	- aå…ƒç´ 
- æ³¨æ„å¼•ç”¨å±æ€§å€¼å•å¼•å·æˆ–è€…åŒå¼•å·éƒ½å¯ä»¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542517451)

### åŒé‡è°“è¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670029048298)

- ä»»æ„å±‚çº§ä¸‹çš„
	- ä½ç½®å°äº2çš„
		- æœ‰hrefçš„aå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670029184013)

- å¯ä»¥æˆåŠŸå¾—åˆ°å…ƒç´ 
- è¿™é‡Œè·å–å…ƒç´ çš„æ–¹æ³•å«ä»€ä¹ˆå‘¢ï¼Ÿ

### è°“è¯­ predicates

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670028229949)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552360248)

- æˆ‘ä»¬é’ˆå¯¹ä¸€æ¡æ¡çš„éƒ½è¯•è¯•

### è§‚å¯Ÿç½‘é¡µ

```python
import requests
from lxml import etree
response = requests.get("http://localhost")
b_html = response.content
print(b_html)
et_html = etree.HTML(b_html)
l_attrib = et_html.xpath("//a/@href")
print(l_attrib)
```


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669541813289)

- a å…ƒç´  æœ‰ href å±æ€§

### xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670027314021)

- ä»»æ„è·¯å¾„ä¸‹aå…ƒç´ çš„
	- hrefå±æ€§

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542041751)

- éå†æˆåŠŸ
- å¦‚æœä¸å¯¹aå…ƒç´ è¿›è¡Œç­›é€‰å‘¢ï¼Ÿ

### href

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542128636)

- ä»»æ„è·¯å¾„ä¸‹ä»»æ„å…ƒç´ çš„
	- hrefå±æ€§

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542166221)

- ç›®å‰å¯ä»¥ç­›é€‰åˆ°å±æ€§
	- å¯ä»¥æ ¹æ®å±æ€§å€¼ç­›é€‰å…ƒç´ å—ï¼Ÿ

### å°è¯•

- è¿™é‡Œé¢å‡ºç°äº†ç´¢å¼•è¿ç®—ç¬¦[]
- æ‰¾ä¸€ä¸‹/html/bodyä¸‹	
	- ç¬¬ 1 ä¸ª p

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542698464)


### æœ€åä¸€ä¸ª

- /html/body/
	- æœ€åä¸€ä¸ªpå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542854651)

- åœ¨ç´¢å¼•è¿ç®—ç¬¦ä¸­ä½¿ç”¨äº† last()
	- æ­¤æ—¶last() = 3


### å€’æ•°ç¬¬äºŒ

- å€’æ•°ç¬¬äºŒä¸ªp

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669542974392)

- å…³é”®è¿˜æ˜¯å¯¹ li ä½¿ç”¨ç´¢å¼•è¿ç®—ç¬¦
  - last()æ˜¯æœ€åä¸€ä¸ª
  - last() - 1 æ˜¯å€’æ•°ç¬¬äºŒä¸ª

### å‰ä¸¤å position

- å‰ä¸¤ä¸ªp

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669543060055)

- p[position()<3]
	- å¯ä»¥æ‰¾åˆ°å‰ä¸¤é¡¹
- å¦‚æœæˆ‘æƒ³æ‰¾åä¸¤é¡¹å‘¢ï¼ŸğŸ¤”

### åä¸¤é¡¹ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670028432090)

- p[position()>last()-2]
- å¯ä»¥æ‰¾åˆ°åä¸¤é¡¹

### å­˜åœ¨hrefå±æ€§çš„aå…ƒç´ 

- æ‹¥æœ‰hrefå±æ€§ çš„ aå…ƒç´  ğŸ¤ª

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669546658719)


- å¯ä»¥è¯•è¯•hrefå±æ€§æ˜¯ç‰¹å®šå€¼å—ï¼Ÿ

### å±æ€§å†…å®¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221127-1669546941736)

- hrefå±æ€§æ˜¯ http://nginx.org çš„aå…ƒç´ 

### æ€»ç»“

- è¿™æ¬¡æ·±å…¥äº† xpath çš„ç­›é€‰
  - å¯ä»¥ç”¨ä¸­æ‹¬å·ç´¢å¼•çš„æ–¹å¼å¯¹äºå­å…ƒç´ çš„ä½ç½®è¿›è¡Œç­›é€‰
    - ç¬¬ä¸€ä¸ª
      - xpath("//p[1]")
    - æœ€åä¸€ä¸ª
      - xpath("//p[last()]")
    - æ­£æ•°å‰ä¸‰ä¸ª
      - xpath("//p[position()<=3]")
    - å€’æ•°ä¸¤ä¸ª
      - xpath("//p[position()>last()-2"])
  - å¯ä»¥åœ¨ç´¢å¼•ä¸­å¯¹å±æ€§è¿›è¡Œç­›é€‰
    - @ ä¿—ç§°èŠ± a
    - å¯¹åº”@ttribute
    - å¯ä»¥æ‰¾å‡ºæœ‰è¿™ä¸ªå±æ€§çš„å…ƒç´ 
      - et_html.xpath("//*[@href]")
    - ä¹Ÿèƒ½æ‰¾åˆ°å±æ€§æ˜¯ç‰¹å®šå€¼çš„å…ƒç´ 
      - et_html.xpath("//*[@href=\\"http://nginx.org/\"]")
  - ä½ç½®ã€å±æ€§ç­›é€‰è¿˜å¯ä»¥é…åˆèŠ‚ç‚¹ç­›é€‰
    - et_target = et_html.xpath("//a[last()][@href=\\"http://nginx.org/\"]")
- è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
