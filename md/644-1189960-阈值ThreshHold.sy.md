---
show: step
version: 1.0
enable_checker: true
---

# opencv

## å›å¿†

- ä¸Šæ¬¡ç ”ç©¶äº†è§†é¢‘çš„ä¿®æ”¹
	- è§†é¢‘å¦å­˜
	- è§†é¢‘å¤§å°è°ƒæ•´
	- è§†é¢‘ç©ºé—´è£å‰ª
	- è§†é¢‘æ—¶é—´æˆªå–
	- åœ¨åŸè§†é¢‘ä¸Šç”»åˆ«çš„
	- åœ¨åŸè§†é¢‘ä¸Šæ·»åŠ å­—å¹•
- opencv ç¡®å®å¾ˆå¼ºå¤§
- è¿˜èƒ½åšç‚¹ä»€ä¹ˆï¼ŸğŸ¤”

### è®¾ç½®é˜ˆå€¼
```
import cv2 
image = cv2.imread("/home/shiyanlou/gear.jpg")
t1, dst1 = cv2.threshold(image,127,255,cv2.THRESH_BINARY)
print(t1)
print(dst1)
cv2.imshow("img",image) 
cv2.imshow("dst1",dst1)
cv2.waitKey()
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705155279109)

- å…¶ä¸­
	- t1 æ˜¯ threshold1
	- dst1 æ˜¯ ç»“æœçŸ©é˜µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240823-1724387643492)

- å¦‚ä½•ç†è§£threshold

### threshold

- é˜ˆå€¼
	- å°±åƒä¸€ä¸ªé—¨æ§›
	- è¿‡äº†é—¨æ§› 
	- å°±ç®—è¿›å±‹äº†
	- åˆ°äº†å¦ä¸€ä¸ªé˜¶æ®µäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240114-1705196152951)

- æ‰‹å†Œé‡Œé¢æ€ä¹ˆè¯´å‘¢ï¼Ÿ

### æŸ¥çœ‹æ‰‹å†Œ

```
firefox https://docs.opencv.org/4.x/d7/d4d/tutorial_py_thresholding.html
```

- å…·ä½“æ‰‹å†Œå†…å®¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705155712107)

- å¦‚ä½•ç†è§£typeå‘¢ï¼Ÿ

### type

- å¯ä»¥æ ¹æ®é˜ˆå€¼
	- åšå‡ºä¸åŒçš„æ“ä½œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705155855965)

### å»ºç«‹æ¸å˜

```
import cv2
import numpy
width = height = 200
img = numpy.zeros((height,width),dtype=numpy.uint8)
for num in range(width):
    img[:,num] = 0 + num /(width-1) * 255
cv2.imshow("1",img)
cv2.waitKey()
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240114-1705193801281)

- å¯ä»¥æ”¹ç”¨matplotlibæ¥è¾“å‡º

## matplotlib

```
import cv2
import numpy
from matplotlib import pyplot as plt
width = height = 200
img = numpy.zeros((height,width),dtype=numpy.uint8)
for num in range(width):
    img[:,num] = 0 + num /(width-1) * 255
plt.imshow(img,'gray')
plt.show()
```

- è¾“å‡ºç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240114-1705194110174)

### å…·ä½“æ•ˆæœ

```
import cv2 as cv
import numpy
from matplotlib import pyplot as plt
width = height = 200
img = numpy.zeros((height,width),dtype=numpy.uint8)
for num in range(width):
    img[:,num] = 0 + num /(width-1) * 255
ret,thresh1 = cv.threshold(img,127,255,cv.THRESH_BINARY)
ret,thresh2 = cv.threshold(img,127,255,cv.THRESH_BINARY_INV)
ret,thresh3 = cv.threshold(img,127,255,cv.THRESH_TRUNC)
ret,thresh4 = cv.threshold(img,127,255,cv.THRESH_TOZERO)
ret,thresh5 = cv.threshold(img,127,255,cv.THRESH_TOZERO_INV)
titles = ['Original Image','BINARY','BINARY_INV','TRUNC','TOZERO','TOZERO_INV']
images = [img, thresh1, thresh2, thresh3, thresh4, thresh5]
for i in range(6):
    plt.subplot(2,3,i+1),plt.imshow(images[i],'gray',vmin=0,vmax=255)
    plt.title(titles[i])
    plt.xticks([]),plt.yticks([])
plt.show()
```

- æ‰§è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705156277429)

- å…·ä½“ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ

### æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705155974620)

- å…·ä½“å…¬å¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705155987621)


### è¿™ä¸ªé˜ˆå€¼è®¾ç½®ä¸ºå¤šå°‘åˆé€‚å‘¢ï¼Ÿ

```
import numpy as np
import cv2
src = cv2.imread("./gear.jpg", cv2.IMREAD_GRAYSCALE)
cv2.imshow("origin",src)

#æœ€å¤§å€¼æœ€å°å€¼å’Œç›¸åº”çš„ä½ç½®
min, max, minLoc, maxLoc = cv2.minMaxLoc(src)
print("min: %.2f, max: %.2f"% (min, max))
print("min loc: ", minLoc)
print("max loc: ", maxLoc)

#å‡å€¼å’Œæ ‡å‡†å·®
means, stddev = cv2.meanStdDev(src)
print("mean: %.2f, stddev: %.2f"% (means, stddev))
#äºŒå€¼åŒ–
src[np.where(src < means)] = 0
src[np.where(src > means)] = 255
cv2.imshow("final",src)

cv2.waitKey(0)
cv2.destroyAllWindows()
```

- é€šè¿‡å‡½æ•°æ‰¾åˆ°ç”»é¢çš„å‡å€¼
- ç„¶åå°†é˜ˆå€¼è®¾ç½®ä¸ºå‡å€¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240113-1705154909419)

- æœ‰æ²¡æœ‰ä»€ä¹ˆè‡ªåŠ¨çš„é˜ˆå€¼å‘¢ï¼Ÿ

### è‡ªåŠ¨é˜ˆå€¼
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240226-1708919186896)

```
import numpy as np
from matplotlib import pyplot as plt
import cv2 as cv

src = cv.imread("gear.jpg")
h, w = src.shape[:2]
gray = cv.cvtColor(src, cv.COLOR_BGR2GRAY)
ret, binary = cv.threshold(gray, 0, 255, cv.THRESH_BINARY | cv.THRESH_OTSU)
print("ret :", ret)
result = np.zeros([h, w*2, 3], dtype=src.dtype)
result[0:h,0:w,:] = src
result[0:h,w:2*w,:] = cv.cvtColor(binary, cv.COLOR_GRAY2BGR)
cv.putText(result, "input", (10, 30), cv.FONT_ITALIC, 1.0, (0, 0, 255), 2)
cv.putText(result, "binary, threshold = " + str(ret), (w+10, 30), cv.FONT_ITALIC, 1.0, (0, 0, 255), 2)
plt.imshow(result)
plt.show()
cv.imwrite("binary_result.png", result)
cv.waitKey(0)
cv.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240114-1705204505999)

- å¯ä»¥é€šè¿‡æ»‘å—æ§åˆ¶é˜ˆå€¼å—ï¼Ÿ

### æ€»ç»“ 
- è¿™æ¬¡ç ”ç©¶äº†
	- é˜ˆå€¼
	- threshold
- å¯ä»¥è¯´æ˜¯åˆ†ç•Œç‚¹
	- å°±åƒäºŒæç®¡ä¸€æ ·
	- ä¸€åˆ†ä¸ºäºŒ 
	- åŒºåˆ†ä¸¤ç§çŠ¶æ€
		- å¯æ„ŸçŸ¥çš„åˆºæ¿€
		- é˜ˆä¸‹åˆºæ¿€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240114-1705196223327)

- å›¾åƒçš„é˜ˆå€¼æ—¶æ ¹æ®äº®åº¦åˆ’åˆ†çš„
	- å¯ä»¥æ˜¯å…·ä½“å€¼
	- ä¹Ÿå¯ä»¥æ ¹æ®å›¾åƒç”»é¢çš„å‡å€¼
- å¯ä»¥æ ¹æ®ä¸€ä¸ªå˜åŒ–çš„æ•°å€¼æ¥è§‚çœ‹å—ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ğŸ‘‹