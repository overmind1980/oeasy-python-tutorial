---
show: step
version: 1.0
enable_checker: true
---

# xpath è·¯å¾„è¡¨è¾¾å¼

## å›å¿†

- ä¸Šæ¬¡æ·±å…¥äº† xpath çš„ç­›é€‰
  - å¯ä»¥ç”¨ä¸­æ‹¬å·ç´¢å¼•çš„æ–¹å¼å¯¹äºå­å…ƒç´ çš„ä½ç½®è¿›è¡Œç­›é€‰
    - ç¬¬ä¸€ä¸ª
      - xpath("//p[1]")
    - æœ€åä¸€ä¸ª
      - xpath("//p[last()]")
    - æ­£æ•°å‰ä¸‰ä¸ª
      - xpath("//p[position()<=3]")
    - å€’æ•°ä¸¤ä¸ª
      - xpath("//p[position()>last()-2"])
  - å¯ä»¥åœ¨ç´¢å¼•ä¸­å¯¹å±æ€§è¿›è¡Œç­›é€‰
    - @ ä¿—ç§°èŠ± a
    - å¯¹åº”@ttribute
    - å¯ä»¥æ‰¾å‡ºæœ‰è¿™ä¸ªå±æ€§çš„å…ƒç´ 
      - et_html.xpath("//*[@href]")
    - ä¹Ÿèƒ½æ‰¾åˆ°å±æ€§æ˜¯ç‰¹å®šå€¼çš„å…ƒç´ 
      - et_html.xpath("//*[@href=\\"http://nginx.org/\"]")
  - ä½ç½®ã€å±æ€§ç­›é€‰è¿˜å¯ä»¥é…åˆèŠ‚ç‚¹ç­›é€‰
    - et_target = et_html.xpath("//a[last()][@href=\\"http://nginx.org/\"]")
- è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å‘¢ï¼ŸğŸ¤”

### æ„é€ ç¯å¢ƒ

- é¦–å…ˆåœ¨ç”¨æˆ·å®¿ä¸»æ–‡ä»¶å¤¹
	- å»ºç«‹ä¸€ä¸ªç½‘é¡µ

```bash
vi food.html
```

- ç½‘é¡µæ–‡ä»¶å¦‚ä¸‹

```html
<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<title>menu</title>
		<meta charset="utf-8">
	</head>
	<body width="700px">
		<h1>menu</h1>
		<ul id="ulist">
			<li>
				<span class="food">è±†æ±</span>
				<price>10</price>
			</li>
			<li>
				<span class="food">ç¾Šç˜ªæ±¤</span>
				<price>15</price>
			</li>
			<li>
				<span class="food">æŠ˜è€³æ ¹</span>
				<price>20</price>
			</li>
		</ul>
	</body>
</html>
```

- å¤åˆ¶åˆ°å‰ªè´´æ¿å
	- åœ¨æ’å…¥æ¨¡å¼ä¸‹è¿›è¡Œç²˜è´´
	- ç”¨<kbd>g</kbd><kbd>g</kbd><kbd>=</kbd><kbd>G</kbd>è°ƒæ•´ç¼©è¿›

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670030602904)

- ç„¶åä¿å­˜å¹¶é€€å‡º

### å¯åŠ¨webæœåŠ¡å™¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670030012452)

- å°†ç½‘é¡µæ–‡ä»¶æ‹·è´è‡³webæœåŠ¡å™¨æ ¹ä¸‹
- å¹¶å¯åŠ¨webæœåŠ¡
- ç”¨ç«ç‹è®¿é—®åˆ°ç½‘é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670030659782)

### å°è¯•è®¿é—®

```python
import requests
from lxml import etree
response = requests.get("http://localhost/food.html")
b_html = response.content
print(b_html)
et_html = etree.HTML(b_html)
l_element = et_html.xpath("//li")
for element in l_element:
	print(l_element)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670030822973)

- è®¿é—®ä»»æ„å…ƒç´ ä¸‹çš„liå…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670030848235)

- è®¿é—®æˆåŠŸ
- å°è¯•ä½¿ç”¨è°“è¯

### å±æ€§æ¯”è¾ƒ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630566795961)

- å‚è€ƒä¸Šé¢çš„ä¾‹å­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568001180)

- æ ¹æ®ç½‘é¡µçš„ç»“æ„
	- å°è¯•ä¿®æ”¹xpath
- et_target = et_html.xpath("//li[price>=20]")
  - æ‰¾åˆ° 1 æ¡ li
- et_target = et_html.xpath("//li[price>=15]")
  - æ‰¾åˆ° 2 æ¡ li
- et_target = et_html.xpath("//li[price>=10]")
  - æ‰¾åˆ° 3 æ¡ li

### ç»§ç»­ç ”ç©¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568371007)

- æ ¹æ®ä¸Šé¢çš„ä¾‹å­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568001180)

- et_target = et_html.xpath("//li[price<=10]/span")

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031300427)

- 10 å…ƒä»¥å†…(å«10å…ƒ)çš„é£Ÿå“åç§°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031314170)

- æ³¨æ„è·å–çš„æ˜¯èŠ‚ç‚¹çš„ text

### é€šé…ç¬¦

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568599049)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568001180)

- å…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ

### é€‰ä¸­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031450673)

- et_target = et_html.xpath("\*")
  - åŒ¹é…å½“å‰èŠ‚ç‚¹(html)ä¸‹çš„ç›´æ¥å­èŠ‚ç‚¹

- å…±ä¸¤ä¸ª headã€body	
- è¦é€‰å‡ºæ‰€æœ‰çš„å…ƒç´ èŠ‚ç‚¹åº”è¯¥å¦‚ä½•å‘¢ï¼Ÿ

### æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹


```python
import requests
from lxml import etree
response = requests.get("http://localhost/food.html")
b_html = response.content
et_html = etree.HTML(b_html)
l_et_element = et_html.xpath("//*")
for element in l_et_element:
	print(element)
```

- et_target = et_html.xpath("//\*")
  - åŒ¹é…ä»»æ„è·¯å¾„ä¸‹çš„ä»»æ„èŠ‚ç‚¹
  - ç›¸å½“å¤š

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656645264113)

- è€Œä¸”æ˜¯æ·±åº¦ä¼˜å…ˆçš„
- å¦‚æœæˆ‘è¦ç­›é€‰å‡ºæ‰€æœ‰æœ‰å±æ€§çš„å…ƒç´ èŠ‚ç‚¹å‘¢ï¼Ÿ

### æœ‰å±æ€§çš„æ‰€æœ‰èŠ‚ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031564597)

- et_target = et_html.xpath("//\*[@\*]")
  - åŒ¹é…ä»»æ„è·¯å¾„ä¸‹çš„å…¨éƒ¨æœ‰å±æ€§çš„èŠ‚ç‚¹
  - æ•°é‡ç¨æœ‰å‡å°‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031591129)

- è¿˜æœ‰ä»€ä¹ˆå¯ç©çš„ï¼Ÿ

### å°è¯•è®¿é—®

```python
import requests
from lxml import etree
response = requests.get("http://localhost/food.html")
b_html = response.content
et_html = etree.HTML(b_html)
l_attributes = et_html.xpath("//@*")
for attrib in l_attributes:
	print(attrib)
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231022-1697976158324)

### è·¯å¾„å¹¶é›†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630569224426)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630568001180)

- et_target = et_html.xpath("//h1|//price")
  - ç¬¦åˆå‰é¢//h1 æˆ–è€…ç¬¦åˆåé¢//price éƒ½å¯ä»¥

### å…·ä½“ä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031647049)

- å®ç°ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221203-1670031679443)

- åŸºæœ¬ä¸Š xpath çš„ç”¨æ³•æˆ‘ä»¬äº†è§£äº†
- è¿™xpathæ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ

### xpath çš„æºå¤´

- xpath æ˜¯è°å®šçš„ï¼Ÿ
- ä¸ºä»€ä¹ˆä¼šæœ‰ xpathï¼Ÿ
- è¿™è¿˜è¦ä»å¤´è¯´èµ·

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630569561042)

- æ—©å¹´é—´æ–‡æœ¬æ²¡æœ‰ç»Ÿä¸€çš„äº¤æ¢æ ¼å¼
	- ä¸ºäº†äº¤æµçš„æ–¹ä¾¿
	- å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ iso åˆ¶å®šäº†æ ‡å‡† SGML
		- Standard Generalized Markup Language 
		- SGML æ˜¯å›½é™…ä¸Šå®šä¹‰ç”µå­æ–‡ä»¶ç»“æ„å’Œå†…å®¹æè¿°çš„æ ‡å‡†
		- SGML å…·æœ‰éå¸¸å¤æ‚çš„æ–‡æ¡£ç»“æ„
		- ä¸»è¦ç”¨äºå¤§é‡é«˜åº¦ç»“æ„åŒ–æ•°æ®çš„è®¿é—®å’Œå…¶ä»–å„ç§å·¥ä¸šé¢†åŸŸ
		- åœ¨åˆ†ç±»å’Œç´¢å¼•æ•°æ®ä¸­éå¸¸æœ‰ç”¨

### SGML

- æè¿°æ•°æ®çš„æ•°æ®
	- å°±æ˜¯å…ƒæ•°æ®
- ä½¿ç”¨çš„æ–¹å¼æ˜¯ç»™æ–‡æœ¬æ·»åŠ æ ‡ç­¾
	- ä¿—ç§°è´´æ ‡ç­¾
	- æ ‡ç­¾æœ¬èº«ä¹Ÿæ˜¯æ–‡æ¡£çš„ä¸€éƒ¨åˆ†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630569551704)

- åæ¥è¯»å†™æ–‡ä»¶å¼€å§‹ä¾èµ–äºäº’è”ç½‘æµè§ˆå™¨
	- ä¸€ç§æ–°çš„äº¤æ¢æ ‡å‡†åœ¨å®è·µä¸­è¯ç”Ÿ

### html

- åœ¨å„ç§ç½‘ç»œæ•°æ®äº¤æ¢å·¥å…·çš„è¯•æ¢å®è·µä¸­
	- htmlè¿™ç§è¶…æ–‡æœ¬è¯­è¨€å‡ºç°äº†
	- åŒæ—¶æœŸæµè§ˆå™¨å‡ºç°äº†
	- æˆ–è€…è¯´å¯¹äºhtmlè¿™ç§æ ‡ç­¾çš„æ¸²æŸ“å·¥å…·å‡ºç°äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630570031771)

- 1989 å¹´
	- HTML è¯ç”Ÿ
		- Tim Berners-Lee
		- æœ€å…ˆåœ¨è‡ªå·±çš„ next æœºå™¨ä¸Šå»ºç«‹äº†è¿™ç§è¯­è¨€
	- HTML æŠ›å¼ƒäº† SGML å¤æ‚åºå¤§çš„ç¼ºç‚¹
		- ç»§æ‰¿äº† SGML çš„å¾ˆå¤šä¼˜ç‚¹
		- HTML æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ç®€å•æ€§å’Œè·¨å¹³å°æ€§
- æµè§ˆå™¨å„ç§å…¼å®¹å’Œè¯•æ–°çš„è¿‡ç¨‹ä¸­è¿›åŒ–

### ç›®å‰çŠ¶æ€

- æˆ‘ä»¬çœ‹çš„ç½‘é¡µéƒ½æ˜¯html

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630569932502)

- ä½†æ˜¯ html æ¯•ç«Ÿæ˜¯åŸºäºç½‘é¡µçš„æ ‡ç­¾
	- ä¸æ˜¯åŸºäºæ•°æ®çš„
	- éšç€æ•°æ®é‡çš„å‘å±•
	- xml å‡ºç°äº†

### xml

- HTML æè¿°çš„æ˜¯ç½‘é¡µæ¸²æŸ“æ—¶å€™çš„ç»“æ„
	- ä½†ä¸æè¿°æ•°æ®
	- å¯è¯»æ€§å·®ã€æœç´¢æ—¶é—´é•¿
		- 1998 å¹´ 2 æœˆ 10 æ—¥
		- W3C(World Wide Web Consortiumï¼Œä¸‡ç»´ç½‘è”ç›Ÿ)
		- å…¬å¸ƒ XML 1.0 æ ‡å‡†
- XML è¯ç”Ÿäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630570251257)

- ä½†æ˜¯å¦‚ä½•è®©xmlæ¸²æŸ“æˆäººçœ¼èƒ½å¤Ÿæ¥å—çš„é¡µé¢å‘¢ï¼Ÿ

### xslt

- ä¸ºäº†è®© xml çœ‹èµ·æ¥æ›´å¥½çœ‹
	- XSLT è§„èŒƒå‡ºç°äº†
	- æ˜¯æ¸²æŸ“xmlçš„è§„èŒƒ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656642715446)

- XSLT å¯¹äº xml
	- å°±åƒ css å¯¹äº html
- xmlã€html
    - æ¥¼æˆ¿ç»“æ„
    - æ˜¯è¯­ä¹‰
- xsltã€css
	- æ˜¯å…·ä½“çš„æ¥¼æˆ¿è£…ä¿®é£æ ¼
	- æ˜¯å¤–è§‚

- é™¤æ­¤ä¹‹å¤–
	- è¿˜æœ‰å¯¹äºxmlçš„ç­›é€‰å·¥å…·

### xpath

- å…¶ä¸­çš„ xpath æ˜¯å…³äº xml å…ƒç´ ç­›é€‰çš„æ ‡å‡†
	- `xpath` çš„æ„æ€ å°±æ˜¯ `x`ml `path` language

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630570677195)

- https://www.w3.org/TR/2010/REC-xpath20-20101214/#context

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630570705394)


### å›åˆ°å†å²

- xml(e`X`tensible `M`arkup `L`anguage)
	- æ˜¯ä¸ºäº†è§£å†³htmlæ ‡ç­¾å¤ªè¿‡é¢å‘æ¸²æŸ“è€Œä¸é¢å‘æ•°æ®è€Œäº§ç”Ÿçš„
	- æ˜¯htmlçš„å‡çº§
	- æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„SGML(`S`tandard `G`eneralized `M`arkup `L`anguage)
- xslt(E`x`tensible `S`tylesheet `L`anguage `T`ransformations)
	- æ˜¯ä¸ºäº†è§£å†³xmlå‘ˆç°èƒ½åŠ›è€Œäº§ç”Ÿçš„
	- æ˜¯cssçš„å‡çº§
	- æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„SGML
- è¯´åˆ°åº•åˆå›åˆ°äº†æœ€åˆ
	- SGML

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656643739364)

- è™½è¯´å›åˆ°äº†æœ€åˆ
- ä½†è¿™ä¸ªæœ€åˆå·²ç»ä¸æ˜¯1986å¹´é‚£ä¸ªçº¸è´¨çš„æœ€åˆäº†
- çº¸å¼ çš„ä¸œè¥¿æ”¾åˆ°äº†ç½‘é¡µä¸­

### åå™¬

- å°±è¿1986å¹´çš„çº¸è´¨æ–‡æ¡£ä¹Ÿç½‘é¡µåŒ–äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656643834774)

- æœ€åˆä¹‹å‰çš„æ›´åˆå‘¢

### æ›´åˆ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656643864383)

- sgmlæ¥è‡ªäºgml
	- generic markup language


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220701-1656643913342)


- gmlæ˜¯ä¸€ç§æ–‡æ¡£æ ¼å¼çš„è„šæœ¬
	- gmlæ˜¯ibmç”¨æ¥æè¿°æ–‡æ¡£æ ‡é¢˜æ ¼å¼ç”¨çš„
	- å®šä¹‰äº†
		- æ®µè½
		- æ ‡é¢˜
		- åˆ—è¡¨
		- è¡¨æ ¼ç­‰
- æ˜¯ä¸ºäº†å½“æ—¶æ¸²æŸ“è®¾å¤‡
	- é’ˆå¼æ‰“å­—æœºæœåŠ¡çš„ä¸€ç§è¯­è¨€
- gmlè¿˜å¯ä»¥å¾€å‰å€’ä¹ˆï¼Ÿ

### ml

- markup language
	- markup å…¶å®å°±æ˜¯ make up
	- èµ·æºå°±æ˜¯ç”¨ç¬”åšç¬”è®°æˆ–è€…æ ‡è®°
	- è¿™æ˜¯æ ‡ç­¾åšæ ‡è®°çš„èµ·ç‚¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220712-1657603357016)

- æ­¤åä¸€è·¯å‘å±•
	- mlæ ‡è®°æ–¹å¼çš„å¯èƒ½æ€§å¾ˆå¤š
	- æ‰€ä»¥è¦ä¸€ç§é€šç”¨çš„generic
		- gml
	- gmléœ€è¦è§„èŒƒåŒ–æ‰€ä»¥éœ€è¦standard
	- è¿™å°±æ˜¯sgml
- å½“ç„¶å†å¾€å‰å€’ä¹Ÿå¯ä»¥
	- markup languageæ¥è‡ªäºlanguage
	- è¯­è¨€å’ŒåŠ³åŠ¨åˆ›é€ äº†äººæœ¬èº«
	- è¿™å°±æœ‰ç‚¹å¤ªè¿œäº†ã€‚ã€‚ã€‚
		- æˆ‘ä¹ŸçŸ¥é“ã€‚ã€‚ã€‚
- æ‰€ä»¥æˆ‘ä»¬æ‰“ä½
	- å»æ€»ç»“ä¸€ä¸‹


### æ€»ç»“

- è¿™æ¬¡æ·±å…¥äº† xpath ä¸­çš„å…ƒç´ é€‰æ‹©
  - å¯ä»¥æ ¹æ®å…ƒç´ å±‚çº§å…³ç³»é€‰æ‹©
  - ä¹Ÿå¯ä»¥æ ¹æ®å…ƒç´ ä½ç½®é€‰æ‹©
  - è¿˜å¯ä»¥æ ¹æ®å±æ€§å…·ä½“å€¼é€‰æ‹©
  - è€Œä¸”å¯ä»¥æ ¹æ®æ–‡æœ¬çš„å€¼è¿›è¡Œé€‰æ‹©
  - ç”šè‡³å¼€å§‹ä½¿ç”¨é€šé…ç¬¦
- xpath æ˜¯æ•´ä¸ªçˆ¬å–çš„æ ¸å¿ƒ
  - æœ‰ä»€ä¹ˆä¸œè¥¿å¯ä»¥ç»ƒä¹ ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
