---
show: step
version: 1.0
enable_checker: true
---

# cookieæ•ˆæœ

## å›å¿†ä¸Šæ¬¡

- ä¸Šæ¬¡ç ”ç©¶äº†åˆ é™¤ç”¨æˆ·
	- å•ä¸ªåˆ é™¤
- å¯ä»¥æ‰¹é‡åˆ é™¤å¤šä¸ªç”¨æˆ·å—ï¼ŸğŸ¤”

### æ„å»ºç½‘é¡µ

```
<!DOCTYPE html>
<html>
<head>
<script>
	function delete_user(name){
		f = document.getElementById("f");
		u = document.getElementById("d_un");
		u.value = name;
		f.submit();
	}
</script>
<title>Hello from Flask</title>
</head>
<body>
<form id="f" method="POST" action="/user/del">
	<input id="d_un" name="d_un" type="hidden">
</form>
{% if current_user == "admin" %}
    <h1>Hello {{ current_user }}!</h1>
    <form id="d2" method="POST" action="/user/dels">
    <input type="submit" value="del">   
    {% for record in l %}
        <p> 
            <input type="checkbox" value="{{ record[0] }}" name="users">
            {{ record[0] }}
            <input type=button value="del" onclick="delete_user('{{record[0]}}')"/>
        </p>
    {% endfor %}
    </form>
{% else %}
    <h1>You dont have permission</h1>
{% endif %}
</body>
</html>
```

### æäº¤åçš„ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230209-1675915987463)

- å¯ä»¥çœ‹åˆ°æäº¤ä¸Šæ¥çš„è¡¨å•æœ‰ä¸¤é¡¹
- å¦‚ä½•åœ¨åå°å¾—åˆ°è¿™ä¸¤é¡¹å‘¢ï¼Ÿ

### åå°pythonå¤„ç†

```
@app_user.route("/user/dels", methods=['POST', 'GET'])
def del_users():
    users = request.form.getlist("users")
    current_user = session["current_user"]
    if current_user == "admin":
        with pool.connection() as conn:
            with conn.cursor() as cur:
                try:
                    sql = """DELETE FROM login WHERE username=%s"""
                    for user in users:
                        t = (user,)
                        cur.execute(sql,t)
                    conn.commit()
                    cur.close()
                    conn.close()
                except Exception:
                    print(traceback.print_exc())
                    cur.close()
                    conn.close()
                    return  username + " already exists"
                else:
                    return redirect("/user")
    else:
        return "del users failed!"
```

- å¤„ç†ä¹‹åå°±å¯ä»¥æ‰¹é‡åˆ é™¤ç”¨æˆ·äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230209-1675916320804)

- å¯ä»¥æœ‰ä¸ªå…¨é€‰çš„å‹¾å—ï¼Ÿ

### å…¨é€‰ å’Œ å…¨ä¸é€‰

```
<!DOCTYPE html>
<html>
	<head>
		<script>
			function delete_user(name){
				f = document.getElementById("f");
				u = document.getElementById("d_un");
				u.value = name;
				f.submit();
			}

			function all_users(){
				document.getElementById("select_none").checked = false;
				objs = document.getElementsByName("users");
				for(var i=0;i<objs.length;i++){
					if (objs[i].type == "checkbox" && objs[i].disabled==false){
						objs[i].checked = true;      
					}           
				}
			}

			function none_users(){
				document.getElementById("select_all").checked = false;
				objs = document.getElementsByName("users");
				for(var i=0;i<objs.length;i++){
					if (objs[i].type == "checkbox" && objs[i].disabled==false){
						objs[i].checked = false;      
					}           
				}
			}
		</script>
	<title>Hello from Flask</title>
	</head>
	<body>
		<form action="/user/add" method="POST">
			username:<input name="username"/><br/>
			password:<input name="password"/><br/>
			<input type="submit" name="regist"><br/>
		</form>

		<form id="f" method="POST" action="/user/del">
			<input id="d_un" name="d_un" type="hidden">
		</form>
		{% if current_user == "admin" %}
		<h1>Hello {{ current_user }}!</h1>
		<form id="d2" method="POST" action="/user/dels">
			<input type="checkbox" onclick="all_users();" id="select_all">select all
			<input type="checkbox" onclick="none_users();" id="select_none">select none
			<input type="submit" value="del selected!">   
			{% for record in l %}
			<p> 
			<input type="checkbox" value="{{ record[0] }}" name="users">
			<a href="./prepareUpdate?id={{record[0]}}"> {{ record[0] }}</a>
			<input type=button value="del" onclick="delete_user('{{record[0]}}')"/>
			</p>
			{% endfor %}
		</form>
		{% else %}
		<h1>You dont have permission</h1>
		{% endif %}
	</body>
</html>
```

## æ€»ç»“

- è¿™æ¬¡ç ”ç©¶äº†æ‰¹é‡åˆ é™¤ç”¨æˆ·
	- æ‰¹é‡åˆ é™¤
- åˆ é™¤ç”¨æˆ·å¤ªå¿«äº†
- å¯ä»¥æŠŠæ³¨å†Œç”¨æˆ·é›†æˆèƒ½è¿›æ¥å—ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´!