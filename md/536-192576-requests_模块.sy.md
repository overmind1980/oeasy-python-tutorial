---
show: step
version: 1.0
enable_checker: true
---

# å¯¼å…¥ request åŒ…

## æ–°çš„å¼€å§‹

- æˆ‘ä»¬ å®‰è£…å¹¶å¯åŠ¨äº† 
	- nginx æœåŠ¡å™¨
	- äº†è§£äº† çŠ¶æ€ç 

|çŠ¶æ€ç  | çŠ¶æ€|
|---|---|
|200| Ok|
|304| Not modified|
|404| Not found|

- ä½¿ç”¨æµè§ˆå™¨ è®¿é—® æœåŠ¡å™¨ä¸Šçš„ ç½‘é¡µ

|ä¸­æ–‡|è‹±æ–‡|å‘é€æ–¹|æ¥æ”¶æ–¹|
|---|---|---|---|
|è¯·æ±‚|request|æµè§ˆå™¨|æœåŠ¡å™¨|
|å“åº”|response|æœåŠ¡å™¨|æµè§ˆå™¨|

- çˆ¬è™« åˆ°åº•`æ€ä¹ˆç”¨` å‘¢ï¼ŸğŸ¤£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220912-1662951986226)

### è¿‡ç¨‹

- æµè§ˆçš„è¿‡ç¨‹ æ˜¯
  - åœ¨å®¢æˆ·æœºä¸Šæµè§ˆå™¨ 
	- å‘è¯·æ±‚ request
  - æœåŠ¡å™¨æ¥æ”¶ è¯·æ±‚
	- è¿”å›å“åº” response
  - æµè§ˆå™¨æ”¶åˆ° response å¹¶æ¸²æŸ“æˆé¡µé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210831-1630412050376)

- çˆ¬è™«å°±å‡è£… è‡ªå·±æ˜¯ä¸€ä¸ªæµè§ˆå™¨
	- ç”¨ä»£ç  å‘è¯·æ±‚
	- åæ­£éƒ½æ˜¯ 0101 çš„å­—èŠ‚æµ

- é‚£æˆ‘åº”è¯¥ å¦‚ä½• å‡è£…è‡ªå·±æ˜¯ä¸ªæµè§ˆå™¨ å‘¢ï¼Ÿ

### è¯¢é—®

- é—®é—®ai

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745061377074) 

- ai è¯´å…ˆè¦ å¯¼å…¥ requests

### å¯¼å…¥åŒ…

```
import requests
requests
help(requests)
```

- å¯¼å…¥æ¨¡å—

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210831-1630412431769)

-  æŸ¥çœ‹å¸®åŠ©

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210831-1630404683669)

- æ ¹æ®è¿™ä¸ªå¸®åŠ©

### å°è¯•é‡ç°

- æˆ‘ä»¬æ¥è¯•è¯•
	- ç…§çŒ«ç”»è™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221118-1668761027794)

### ç…§çŒ«ç”»è™

```
import requests
requests.get("http://localhost/")
```

- å‡ºç°é”™è¯¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069493746) 

- æ€ä¹ˆåŠï¼Ÿ

### åˆ†æåŸå› 

- å°±åƒä¹‹å‰ æµè§ˆå™¨ æ— æ³•è®¿é—®ä¸€æ ·

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069457934) 

- å› ä¸ºwebæœåŠ¡æ²¡å¼€ 
	- çˆ¬è™« å°±åƒæµè§ˆå™¨ä¸€æ · æ— æ³•è®¿é—®

### å¼€å¯æœåŠ¡

- <kbd>ctrl<kbd>+<kbd>d<kbd> é€€å‡ºæ¸¸ä¹åœº

```
sudo service nginx start
sudo service nginx status
```

- å¼€å¯ webæœåŠ¡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069609403)

### å†è¿› æ¸¸ä¹åœº

```
import requests
requests.get("http://localhost/")
```

- å¯ä»¥å¾—åˆ°å“åº”(response)äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069737123)

- å“åº”(response)é‡Œé¢ åˆ°åº• æœ‰`ä»€ä¹ˆ`å‘¢ï¼Ÿ

### æŸ¥çœ‹å“åº”


```
import requests
r = requests.get("http://localhost/")
```

- å°† è¿”å›ç»“æœ èµ‹ç»™ r

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069937583) 

- r æ˜¯ ä»€ä¹ˆ `ç±»å‹` å‘¢ï¼Ÿ

### Response å“åº”

```
r
type(r)
```

- Response å¯¹è±¡ 
	- åŒ…æ‹¬äº†ä¸€ä¸ª http è¯·æ±‚çš„è¿”å›ç»“æœ
	- requests.models.Response

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745069973532) 

- å…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ


### åªè¯»å¯¹è±¡

- å¯¹ç€rå–Šæ•‘å‘½

```
help(r)
```

- r é‡Œé¢æœ‰å¾ˆå¤šå±æ€§
	- content å°±æ˜¯ å¯ä»¥è¯»å‡ºæ¥çš„å†…å®¹
	- å½¢å¼æ˜¯ å­—èŠ‚åºåˆ— bytes

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210831-1630412969842)

### content

```
r.content
type(r.content)
```

- å¾—åˆ°å“åº”å†…å®¹
	- å½¢å¼ æ˜¯ å­—èŠ‚åºåˆ—

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070128736)

- å¦‚æœ æˆ‘ä»¬
	- åªæƒ³è¦ çº¯æ–‡æœ¬ 
	- æ€ä¹ˆåŠå‘¢ï¼Ÿ

### æ–‡æœ¬

```
help(r)
```

- ç»§ç»­æŸ¥æ‰¾å¸®åŠ©

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211015-1634305462282)

- æ‰¾åˆ° textå±æ€§

### text

```
r.text
type(r.text)
```

- æ¥çœ‹çœ‹ r.text

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211015-1634305478003)

- r.content å’Œ r.text
	- æœ‰å•¥`åŒºåˆ«`ï¼Ÿ

### å¯¹æ¯”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211016-1634396395638)

|å±æ€§|ç±»å‹|
|---|---|
|content | å­—èŠ‚åºåˆ—|
| text | å­—ç¬¦ä¸²åºåˆ—|

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210831-1630413092545)

- å†™ä¸ªpyæ–‡ä»¶ åšå¯¹æ¯”

### æ˜ç¡®

```
vi t.py
```

- é€šè¿‡ å˜é‡åå‰ç¼€
	- æ˜ç¡® å˜é‡ç±»å‹

```
import requests
response = requests.get("http://localhost/")
b_html = response.content
s_html = response.text
print("b_html:", type(b_html), b_html)
print("s_html:", type(s_html), s_html)
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240331-1711882096950)

- é‚£è¿™ bytes å’Œsträ¹‹é—´
	- å¯ä»¥ç›¸äº’`è½¬åŒ–`ä¹ˆï¼Ÿ

### è½¬åŒ–

- å­—èŠ‚åºåˆ—å’Œå­—ç¬¦ä¸²çš„è½¬åŒ–
	- å°±æ˜¯å­—ç¬¦ä¸²çš„ç¼–ç å’Œè§£ç 

```
import requests
response = requests.get("http://localhost/")
b_html = response.content
s_html = response.text
print(b_html.decode()==s_html)
print(s_html.encode()==b_html)
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240331-1711882214199)

- å­—èŠ‚åºåˆ—
	- `è§£ç ` decode ä¹‹å
		- å¾—åˆ°å­—ç¬¦ä¸²
- å­—ç¬¦ä¸² 
	- `ç¼–ç ` encode ä¹‹å
		- å¾—åˆ°å­—èŠ‚åºåˆ—

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211016-1634396459875)

- ç¼–ç å’Œè§£ç 
	- äº’ä¸ºé€†æ–¹æ³•
- å¯ä»¥æŸ¥åˆ°å¸®åŠ©å—ï¼Ÿ

### æé—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070652515) 

### è¯·æ±‚ requests

- http://cn.python-requests.org/zh_CN/latest/

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070707943) 

- ä¸ºä»€ä¹ˆrequestsæ²¡æœ‰å®‰è£…å°±èƒ½ä½¿ç”¨å‘¢ï¼Ÿ

### ä¸‹è½½åŒ…

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070782477) 

- å¦‚æœæœ¬åœ°æ²¡æœ‰çš„è¯ 
	- è¦å…ˆä¸‹è½½

```
pip3 install requests
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070824420) 

## æ€»ç»“

- æˆ‘ä»¬ å¯¼å…¥äº† requests æ¨¡å—
	- requests å¸®æˆ‘ä»¬ å‘è¯·æ±‚
	  - çŠ¶æ€ç  200

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/192576/uid1190679-20250419-1745070923344) 

- è¿™æ · æˆ‘ä»¬å°±å¯ä»¥
	- å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ªæµè§ˆå™¨
	- å®Œæˆäº† http get çš„è¿‡ç¨‹
	  - å‘å‡ºäº† request
	  - å¾—åˆ°äº† response

|å±æ€§|ç±»å‹|
|---|---|
|content | å­—èŠ‚åºåˆ—|
| text | å­—ç¬¦ä¸²åºåˆ—|

- å¦‚ä½•æ‰¾åˆ° ç½‘é¡µä¸­å…·ä½“çš„å†…å®¹ å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
