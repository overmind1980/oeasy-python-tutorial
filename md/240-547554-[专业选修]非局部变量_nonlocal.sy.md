---
show: step
version: 1.0
enable_checker: true
---

# éå±€éƒ¨å˜é‡(nonlocal)

## å›å¿†

- ä¸Šæ¬¡å­¦ä¹ äº†åµŒå¥—çš„å‡½æ•°å®šä¹‰
	- åœ¨outeré‡Œé¢åˆå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°inner
	- å¯ä»¥åœ¨outeré‡Œç”¨ç¨‹åºè°ƒç”¨inner

- è¿™ä¸ªåµŒå¥—å±‚æ¬¡å¯èƒ½æœ‰å¾ˆå¤šå¾ˆå¤šå±‚
- ç®€å•æ¥è¯´å°±æ˜¯
	- å¤–éƒ¨å®šä¹‰çš„å†…éƒ¨å¯è§
	- å†…éƒ¨å®šä¹‰çš„å¤–éƒ¨ä¸å¯è§
	- å†…å¤–åŒåçš„å†…å±‚å±è”½å¤–å±‚
- å¦‚æœæˆ‘å°±æƒ³è®©innerå‡½æ•°è¯»å†™outerå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡
- åº”è¯¥å¦‚ä½•å‘¢ï¼ŸğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220820-1660967646106)

### ç®€åŒ–å‡½æ•°

- å†…éƒ¨ä¼˜å…ˆ
	- å¦‚æœå†…éƒ¨æœ‰åŒåå˜é‡
	- å°±æŠŠå¤–éƒ¨çš„ç»™shadowäº†
- åœ¨innerä¸­
	- å…¶ä¸­gæ˜¯å…¨å±€çš„
	- læ˜¯inneræœ¬åœ°çš„
	- cæ—¢ä¸æ˜¯å…¨å±€çš„
	- ä¹Ÿä¸æ˜¯inneræœ¬åœ°çš„
	- è€Œæ˜¯ä¸Šå±‚å‡½æ•°é—­åŒ… (closure)çš„

```
g = 0

def outer():
    c = 1
    def inner():
        l = 2
        print(g,c,l)
    inner()

outer()
```

| å˜é‡å|ç±»å‹|è‹±æ–‡|ç®€ç§°|
|---|---|---|---|
|global_temp|å…¨å±€|global|g|
|outer_temp|é—­åŒ…|closure|c|
|inner_temp|å±€éƒ¨|local|l|


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240907-1725720114800)

- å¦‚æœcå˜æˆä¸€ä¸ªå…¨å±€çš„å‘¢ï¼Ÿ

### è¿è¡Œ

```
g = 0
c = 1
l = 2

def outer():
    c = 3
    l = 4
    def inner():
        l = 5
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- åœ¨innerä¸­
	- cæ˜¯é—­åŒ…çš„
	- èƒ½å½±å“åˆ°outer
- åœ¨outerä¸­
	- cæ˜¯å±€éƒ¨çš„
	- ä¸èƒ½å½±å“åˆ°å…¨å±€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725765863151)


### ç»“æœ

```
g = 0
c = 1
l = 2

def outer():
    c = 3
    l = 4
    def inner():
        c = 5
        l = 6
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- è¿™ä¸ªæ—¶å€™
	- cå…¶å®æˆäº†innerä¸­çš„local
	- å½±å“ä¸åˆ° outer
	- æ›´å½±å“ä¸åˆ°global

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725763157702)

- ä½†æˆ‘å°±æƒ³è®©ä»–å½±å“åˆ°ï¼Ÿ

### æŸ¥æ‰¾

- è¿™ä¸ªåº”è¯¥ç¦»ç€globalçš„å¸®åŠ©æ–‡æ¡£ä¸è¿œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220820-1660963839490)

- nonlocalå£°æ˜çš„å˜é‡
- å¿…é¡»æ˜¯ä¸Šä¸€å±‚å‡½æ•°ä¸­
	- å·²ç»å­˜åœ¨çš„å±€éƒ¨(local)å˜é‡

### æ­£ç¡®ç”¨æ³•

```
g = 0
c = 1
l = 2

def outer():
    c = 3
    l = 4
    def inner():
        nonlocal c
        c = 5
        l = 6
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- è¿™æ—¶å€™
	- innerä¸­çš„c 
	- ä¸æ˜¯ innerçš„å±€éƒ¨(local)å˜é‡ 
	- è€Œæ˜¯outerä¸­çš„é—­åŒ…(closure)å˜é‡ 
- ç®€å•è¯´å°±æ˜¯innerä¸­çš„c
	- å¯ä»¥å½±å“åˆ°outer

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725763237341)

- å¦‚æœåœ¨outerä¸­ä¿®æ”¹
	- å…¨å±€å˜é‡gå‘¢ï¼Ÿ

### åµŒå¥—å‡½æ•°é‡Œé¢çš„æƒé™

```
g = 0
c = 1
l = 2

def outer():
    g = 3
    c = 4
    l = 5
    def inner():
        nonlocal c
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- outerä¸­çš„g
	- æ˜¯outerå±€éƒ¨çš„
	- å½±å“ä¸åˆ°å…¨å±€çš„g
	- ä½œç”¨åŸŸå°±åœ¨outeré‡Œé¢
- innerä¸­çš„g
	- æ˜¯innerå±€éƒ¨çš„
	- å½±å“ä¸åˆ°outerçš„g
	- æ›´å½±å“ä¸åˆ°å…¨å±€çš„g

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725763392128)

- å¦‚ä½•è®©innerè®¿é—®åˆ°outerçš„çš„gå‘¢ï¼Ÿ

### è®¿é—®

- å’Œåˆšæ‰ä¸€æ ·
	- åœ¨inneré‡Œé¢
	- å°†gå£°æ˜ä¸ºnonlocal

```
g = 0
c = 1
l = 2

def outer():
    g = 3
    c = 4
    l = 5
    def inner():
        nonlocal c
        nonlocal g
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- innerä¸­çš„g
	- æ˜¯nonlocal
	- å¯ä»¥è®¿é—®outerä¸­çš„g

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725763632379)


- æƒ³è¦åœ¨outeré‡Œé¢æ§åˆ¶
	- æœ€å¤–é¢çš„å…¨å±€å˜é‡
	- è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿï¼Ÿ


### å›å¿†global

- è¯´outerå‡½æ•°é‡Œçš„g
	- æ˜¯globalçš„

```
g = 0
c = 1
l = 2

def outer():
    global g
    g = 3
    c = 4
    l = 5
    def inner():
        nonlocal c
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- è¿™ä¸‹outerä¸­çš„g
	- ä¸å†æ˜¯æœ¬åœ°(local)çš„äº†
	- æ˜¯ å…¨å±€çš„(global)çš„gäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725764314711)

- å¦‚æœæƒ³è¦
	- outerä¸­çš„gæ˜¯å†…éƒ¨çš„
	- innerä¸­çš„gæ˜¯å…¨å±€çš„å‘¢ï¼Ÿ

### ä¿®æ”¹

- åˆ æ‰outerä¸­å¯¹äºgæ˜¯globalçš„å£°æ˜
	- æ”¾åˆ°inneré‡Œ

```
g = 0
c = 1
l = 2

def outer():
    g = 3
    c = 4
    l = 5
    def inner():
        global g
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- ç°åœ¨
	- innerä¸­çš„gæ˜¯globalçš„
	- outerä¸­çš„gæ˜¯outeræœ¬åœ°çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725764542578)

- å¯ä»¥è®©innerã€outerä¸­çš„g
	- éƒ½å˜æˆ å…¨å±€çš„(global)çš„ å—ï¼Ÿ

### å°è¯•

```
g = 0
c = 1
l = 2

def outer():
    global g
    g = 3
    c = 4
    l = 5
    def inner():
        global g
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- å¯ä»¥çš„outerå’Œinnerä¸­çš„g
	- éƒ½æ˜¯globalçš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725764593225)

- å¦‚æœinneré‡Œé¢çš„gæ˜¯nonlocalçš„å‘¢ï¼Ÿ

### nonlocal

```
g = 0
c = 1
l = 2

def outer():
    global g
    g = 3
    c = 4
    l = 5
    def inner():
        nonlocal g
        g = 6
        c = 7
        l = 8
        print("inner====",g,c,l)
    inner()
    print("outer====",g,c,l)

outer()
print("global====",g,c,l)
```

- ä¸èƒ½è®¿é—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240908-1725760400671)

- inneré‡Œæƒ³è¦è®¿é—® 
	- outerä¸­çš„é—­åŒ…çš„g
- ä½†æ˜¯outä¸­çš„g
	- ä¸æ˜¯é—­åŒ…(closure)å˜é‡
	- è€Œæ˜¯å…¨å±€(global)çš„ 
	- æ ¹æœ¬æ‰¾ä¸åˆ°closureçš„g

### global

- nonlocalä¸èƒ½å£°æ˜å·²ç»å£°æ˜ä¸ºå…¨å±€(global)çš„å˜é‡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220820-1660964368332)

- ä¸‰ä¸ªä½œç”¨åŸŸ
	- ç±»å‹ï¼ï¼ï¼
local æœ¬åœ°å¯è§ (é»˜è®¤)
	- global å…¨å±€å¯è§
	- nonlocal éæœ¬åœ°å¯è§(ä¸Šä¸€å±‚å‡½æ•°ä¹Ÿå¯è§)

| å˜é‡å|ç±»å‹|è‹±æ–‡|ç®€ç§°|
|---|---|---|---|
|global_temp|å…¨å±€å†…|global|g|
|outer_temp|é—­åŒ…å†…|closure|c|
|inner_temp|æœ¬åœ°å†…|local|l|

### æ€»ç»“
- æˆ‘ä»¬ç ”ç©¶äº†nonlocal




