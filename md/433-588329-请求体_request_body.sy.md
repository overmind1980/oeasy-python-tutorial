---
show: step
version: 1.0
enable_checker: true
---

# fastapi

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬ç ”ç©¶äº†è·¯å¾„å‚æ•°ä¹‹å¤–çš„å‚æ•°
	- è¯·æ±‚å‚æ•°(query_parameter)
		- è¯·æ±‚å‚æ•°ä¸€èˆ¬åœ¨é—®å·ä¹‹å
		- ä½¿ç”¨&è¿›è¡Œåˆ†å‰²
			- http://127.0.0.1:8000/items/?skip=0&limit=10
- è¯·æ±‚å‚æ•°
	- å¯ä»¥å£°æ˜ç±»å‹
	- å¯ä»¥æœ‰é»˜è®¤å€¼
	- å¯ä»¥æ˜¯å¯é€‰çš„
- urlä¸­çš„è¯·æ±‚æˆ‘ä»¬å°±äº†è§£åˆ°è¿™é‡Œäº†
- ä¸‹æ¬¡çœ‹çœ‹è¿˜æœ‰ä»€ä¹ˆèƒ½å¤Ÿæ”¾åˆ°è¯·æ±‚é‡Œé¢å—?

### æ¦‚å¿µ

- é¦–å…ˆæ˜ç¡®ä¸¤ä¸ªæ¦‚å¿µ
	- è¯·æ±‚ 
		- request
		- æµè§ˆå™¨ç»™æœåŠ¡å™¨å‘é€çš„å«åšè¯·æ±‚
	- å“åº” 
		- response
		- æœåŠ¡å™¨ç»™æµè§ˆå™¨å‘é€çš„å«åšå“åº”

- é™¤äº†urlä¸­çš„è¯·æ±‚ä¹‹å¤–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221019-1666189634759)

- è¿˜æœ‰åˆ«çš„ç±»å‹çš„è¯·æ±‚å—ï¼Ÿ

### å…ˆä¸Šä»£ç 

```
from typing import Union

from fastapi import FastAPI
from pydantic import BaseModel


class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None


app = FastAPI()


@app.post("/items/")
async def create_item(item: Item):
    return item
```

- æˆ‘ä»¬ä¸€ç‚¹ç‚¹æ¥åˆ†æä»£ç 
- é¦–å…ˆæ˜¯Itemç±»


### itemç±»

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666251487067)

- å°±åƒå£°æ˜è¯·æ±‚å‹å‚æ•°ä¸€æ ·
- å½“ä¸€ä¸ªå±æ€§æœ‰é»˜è®¤å€¼çš„æ—¶å€™
- ä»–æ˜¯å¯é€‰çš„å±æ€§
- ä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ˜¯
	- ä¸€ä¸ªjsonå¯¹è±¡
	- æˆ–è€…è¯´ä¸€ä¸ªpythonçš„å­—å…¸dict

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666251692498)

- ä½¿ç”¨é»˜è®¤å‚æ•°
- ä¸‹é¢çš„å¯¹è±¡ä¹Ÿå¯ç”¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666251728894)

### å‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666251763997)

- é«˜äº®çš„éƒ¨åˆ†æ ‡è®°äº†
- è¯·æ±‚é‡Œé¢æœ‰ä¸€ä¸ªItemå‹çš„å‚æ•°

### è¿‡ç¨‹ç»“æœ

- æ ¹æ®pythonç±»å‹çš„å®šä¹‰
- fastapiå°†ä¼š
	- è¯»å–è¯·æ±‚ä½“ä½œä¸ºä¸€ä¸ªjson
	- å¦‚æœéœ€è¦è¿›è¡Œç±»å‹è½¬åŒ–
	- éªŒè¯æ•°æ®çš„åˆæ³•åŒ–
		- å¦‚æœæ•°æ®ä¸åˆæ³•
		- å°†ä¼šè¿”å›ä¸€ä¸ªæ¸…æ™°æ˜ç¡®çš„error
			- ç›´æ¥æŒ‡å‡ºé”™è¯¯æ•°æ®æ¥è‡ªäºå“ªé‡Œ
	- æ¥æ”¶åˆ°çš„å‚æ•°ä¼šæ”¾åˆ°itemé‡Œé¢
		- å½“ä½ åœ¨å‡½æ•°ä¸­å£°æ˜ç±»å‹æ˜¯Itemæ—¶
		- ä½ å¯ä»¥è·å¾—ç¼–è¾‘å™¨å…³äºItemå¯¹è±¡ä»£ç æç¤º
	- ä¸ºä½ çš„æ¨¡å‹å»ºç«‹jsonæ–¹æ¡ˆå®šä¹‰
		- ä½ å¯ä»¥åœ¨å…¶ä»–æƒ³ç”¨è¿™ä¸ªå¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆ
	- è¿™äº›æ–¹æ¡ˆå°†æ˜¯openapiçš„æ–¹æ¡ˆ
		- å¯ä»¥è¢«ç”¨æ¥è‡ªåŠ¨åŒ–ç”Ÿæˆæ–‡æ¡£UI

### å°è¯•è¿è¡Œ

- å¼€ä¸€ä¸ªtmuxçª—å£è¿è¡Œ
	- å¦‚æœä¸æ¸…æ¥štmuxçš„è¯
	- å¯ä»¥å‚è€ƒ[oeasyæ•™æ‚¨ç©è½¬linux](https://www.lanqiao.cn/courses/2712)
		- tmuxç« èŠ‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253307161)

- å¯åŠ¨æœåŠ¡å™¨ä¹‹å
- ç”¨ç»ˆç«¯å¼€å¯firefox

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253416654)

- ç„¶åå»æµè§ˆå™¨è§‚å¯Ÿ

### å°è¯•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253462415/wm)

- ç‚¹å‡»try it out

### æ¨¡æ‹Ÿè¡¨å•æäº¤

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253592431)

- å¯ä»¥çœ‹åˆ°è¯·æ±‚ä½“ä¸­
- ç¡®å®å‡ºç°äº†jsonå¯¹è±¡
- æˆ–è€…è¯´pythonå­—å…¸å¯¹è±¡
- è¿™å°±æ˜¯æˆ‘ä»¬è¦æäº¤ç»™æœåŠ¡å™¨çš„è¯·æ±‚ä½“
- ç‚¹å‡»æ‰§è¡Œæ¨¡æ‹Ÿè¡¨å•æäº¤

### æ‰§è¡Œä¹‹å

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253855234)

- å®¢æˆ·ç«¯ä¼šæ”¶åˆ°æœåŠ¡å™¨ç«¯çš„å“åº”
- å…·ä½“å“åº”ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ

### å¾—åˆ°å“åº”

- è¿”å›çš„å¯¹è±¡å°±æ˜¯itemæœ¬èº«

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253924731)

- åŸå› å¯è§æºä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666253993802)

### ä¿®æ”¹è¯·æ±‚å‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254110749)

- å†æ¬¡ç‚¹å‡»excuteè¿›è¡Œå‘é€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254164169/wm)

- å¦‚æœæœ‰é»˜è®¤å‚æ•°çš„å±æ€§æ²¡æœ‰è¢«ä¼ é€’
- ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

### é»˜è®¤å‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254262163)

- èƒ½å¤Ÿå¾—åˆ°å¯¹è±¡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254317654)

- æ²¡æœ‰æŠ¥é”™
- å¦‚æœæˆ‘æŠŠæ²¡æœ‰é»˜è®¤å€¼çš„å±æ€§ä¹Ÿå»æ‰

### æ²¡æœ‰é»˜è®¤å€¼çš„å±æ€§

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254400060)

- è¿™åº”è¯¥ä¼šæŠ¥é”™
- priceæ²¡æœ‰é»˜è®¤å€¼
- ä¹Ÿæ²¡æœ‰ä¼ é€’è¿‡å»

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254416789)

- å®é™…ä¸Šç¡®å®æŠ¥é”™äº†
- priceè¿™ä¸ªåŸŸæ˜¯å¿…é¡»è¦æœ‰çš„
- ç¼ºäº†å°±æŠ¥é”™
- å¦‚æœæœ‰å‚æ•°ä½†æ˜¯ç±»å‹ä¸å¯¹å‘¢

### priceå‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254572184)

- é»˜è®¤æ˜¯float ç±»å‹
- ä½†æ˜¯æˆ‘ä¼ ç»™ä»–ä¸€ä¸ªstr

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254622118)

- ä½†æ˜¯float("123")å¯ä»¥è½¬åŒ–ä¸ºç¬¦åˆè¦æ±‚çš„ç±»å‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254656042)

- æœ€ç»ˆitemè¿˜æ˜¯èƒ½å¤Ÿè¿”å›çš„
- ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿”å›ä¸€ä¸ªä¸èƒ½è½¬åŒ–ä¸ºfloatç±»å‹çš„å­—ç¬¦ä¸²å‘¢ï¼Ÿ

### æ— æ³•è½¬åŒ–ä¸ºç±»å‹è¦æ±‚çš„å±æ€§

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254758856)

- float("o2z")æ— æ³•è¿›è¡Œè½¬åŒ–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666254792303)

- æœ€ç»ˆæŠ¥é”™
- å¦‚æœèƒ½æ­£å¸¸æ¥æ”¶åˆ°ä¼ è¿‡æ¥çš„jsonå¯¹è±¡
- å¯ä»¥å°†è¿”å›å¯¹è±¡è¿›è¡Œä¿®æ”¹å—ï¼Ÿ

### ä¿®æ”¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666256447283)

- åœ¨1å·çª—å£ç¼–è¾‘main.py

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666256507246)

- åœ¨0å·çª—å£ä¸­å¯ä»¥å‘ç°ä»–å®Œæˆäº†æœåŠ¡å™¨çš„æ›´æ–°ä¸è‡ªåŠ¨é‡å¯
- å»æµè§ˆå™¨è§‚å¯Ÿä¸€ä¸‹

### è§‚å¯Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666256689087)

- å‘é€è¯·æ±‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666256707559)

- ç¡®å®æ¥æ”¶åˆ°äº†æ–°çš„å­—å…¸é¡¹
- è¯·æ±‚ä½“å¯ä»¥å’Œè·¯å¾„å‚æ•°ä¸€èµ·ç”¨å—ï¼Ÿ

## è¯·æ±‚ä½“é…åˆè·¯å¾„å‚æ•°

```
from typing import Union

from fastapi import FastAPI
from pydantic import BaseModel


class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None


app = FastAPI()


@app.put("/items/{item_id}")
async def create_item(item_id: int, item: Item):
    return {"item_id": item_id, **item.dict()}
```

- è¿™è¯­æ³•å¦‚ä½•ç†è§£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666257364910)

- ä¿å­˜æ›´æ–°

### æ›´æ–°ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666257106508)

- è®¾ç½®å¥½item_id
- å‘é€è¯·æ±‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666257269466)

- è¯·æ±‚å¯ä»¥æ­£ç¡®å‘é€
- æœåŠ¡å™¨å®Œæˆæ›´æ–°
- æµè§ˆå™¨å¯ä»¥æ¥å—åˆ°æ›´æ–°åçš„ç»“æœ

## è¯·æ±‚ä½“ + è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°

```
from typing import Union

from fastapi import FastAPI
from pydantic import BaseModel


class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None


app = FastAPI()


@app.put("/items/{item_id}")
async def create_item(item_id: int, item: Item, q: Union[str, None] = None):
    result = {"item_id": item_id, **item.dict()}
    if q:
        result.update({"q": q})
    return result
```

- qä¸æ˜¯å¿…é¡»çš„å‚æ•°
- è€Œæ˜¯å¯é€‰çš„è¯·æ±‚å‚æ•°

### å‘é€è¿‡ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666258660450)

- åˆ†åˆ«è®¾ç½®
	- è¯·æ±‚ä½“ 
	- è·¯å¾„å‚æ•° 
	- æŸ¥è¯¢å‚æ•°
- ç„¶åæ‰§è¡Œ

### ç»“æœ

- urlä¸­çš„è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°éƒ½å¯ä»¥æ­£å¸¸å‘é€

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666258766904)

- æœåŠ¡å™¨å¯ä»¥æ­£å¸¸æ›´æ–°
- æµè§ˆå™¨å¯ä»¥æ¥å—åˆ°æ›´æ–°åçš„ç»“æœ

### ä¸åŒå‚æ•°ç±»å‹

- å‡½æ•°å‚æ•°å°†ä¾æ¬¡æŒ‰å¦‚ä¸‹è§„åˆ™è¿›è¡Œè¯†åˆ«ï¼š
    - å¦‚æœåœ¨è·¯å¾„ä¸­ä¹Ÿå£°æ˜äº†è¯¥å‚æ•°
    	- å®ƒå°†è¢«ç”¨ä½œè·¯å¾„å‚æ•°
	- å¦‚æœå‚æ•°å±äºå•ä¸€ç±»å‹
		- æ¯”å¦‚ intã€floatã€strã€bool ç­‰
		- å®ƒå°†è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°
	- å¦‚æœå‚æ•°çš„ç±»å‹è¢«å£°æ˜ä¸ºä¸€ä¸ª Pydantic æ¨¡å‹
		- å®ƒå°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666259510746)

- è·¯å¾„ä¸­ä¹Ÿå£°æ˜äº†
	- item_id
- å‚æ•°ä¸ºå•ä¸€ç±»å‹
	- q
- å‚æ•°ä¸ºPydanticæ¨¡å‹
	- item

### æ€»ç»“ğŸ¤”
- è¿™æ¬¡æˆ‘ä»¬ç ”ç©¶äº†è¯·æ±‚ä½“
- è¯·æ±‚ä½“
	- æ˜¯ä½¿ç”¨POSTæˆ–è€…PUTå‘é€åˆ°æœåŠ¡å™¨çš„jsonå­—å…¸å¯¹è±¡
	- å¯¹åº”ä¸€ä¸ªpythonç±»
- è¯·æ±‚ä½“å¯¹è±¡ä¹Ÿå¯ä»¥è®¾ç½®
	- æ•°æ®ç±»å‹
	- é»˜è®¤å€¼
- è¯·æ±‚ä½“å‘é€ç»™æœåŠ¡å™¨ä¹‹å
	- æœåŠ¡å™¨å¯ä»¥è¿›è¡Œå¤„ç†
	- å†è¿”å›ç»™æµè§ˆå™¨ä¸€ä¸ªjsonå¯¹è±¡
- è¯·æ±‚ä½“å¯ä»¥é…åˆ
	- è·¯å¾„å‚æ•°
	- æŸ¥è¯¢å‚æ•°
- ä¸‹æ¬¡å†è¯´ğŸ‘‹