---
show: step
version: 1.0
enable_checker: true
---

# xpath è·¯å¾„è¡¨è¾¾å¼

## å›å¿†

- ä¸Šæ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
  - oeasy.org
  - æƒ³è¦å¾—åˆ° èœå•ä¸Šçš„æ‰€æœ‰é“¾æ¥
  
1. è·å– xpath
	- å³é”®æ£€æŸ¥å…ƒç´ 
2. çˆ¬å–ä¹‹å
	- è·å¾—å±æ€§ href çš„å€¼
	- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
	- å¹¶ä¸”å­˜å‚¨åˆ°äº† urls.txt ä¸­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722223759)

- èƒ½è¿›å…¥ è¿™äº›å¾—åˆ°çš„é“¾æ¥
	- å†å» æ·±å…¥çˆ¬å– å—ï¼ŸğŸ¤”

### éå†

- å¦å¼€
	- ä¸€ä¸ªo2z.py
	- ç„¶åæ‰“å¼€ä¿®æ”¹

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()
for url in urls:
    response = requests.get(url)
    b_html = response.content
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath(".")
    for et_target in et_targets:
        print(et_target.tag)
```

- è¿è¡Œå‡ºç°äº† 12 æ¬¡ html èŠ‚ç‚¹

### å°è¯•è¾“å‡ºå­—èŠ‚æµ

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()
for url in urls:
    response = requests.get(url)
    b_html = response.content
    print(b_html)
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath(".")
    for et_target in et_targets:
        print(et_target.tag)
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152199291)

- çˆ¬å–åˆ°çš„é¡µé¢ä¸º404

### è¾“å‡ºurl

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152491889)

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152531167)

- åŸæ¥æ˜¯æ¯ä¸ªç½‘å€åé¢
	- å¤šäº†ä¸ª`\n`

### ä¿®æ”¹

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()
for url in urls:
    url = url.replace("\n","")
    response = requests.get(url)
    b_html = response.content
    print(b_html)
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath(".")
    for et_target in et_targets:
        print(et_target.tag)
```

- æ›¿æ¢æ‰å›è½¦æ ‡è®°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152701913)

- å“åº” ä¸å† æ˜¯404äº†

### æŸ¥æ‰¾xpath

- å³é”®å•å‡»çœ‹ç”µè·¯åŸºç¡€
	- æ£€æŸ¥å…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152845095)

- ç¬¬ä¸€ä¸ªå­æ ç›®
	- çˆ±æƒ… å’Œ å…¶ä»–å­æ ç›®ä¸åŒ
	- ä»åˆ—è¡¨ä¸­ åˆ‡å»
- æ‰¾åˆ°ç”µè·¯åŸºç¡€çš„xpath
	- /html/body/div/div[1]/div[1]

### ä¿®æ”¹ä»£ç 

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()[1:]
for url in urls:
    url = url.replace("\n","")
    response = requests.get(url)
    b_html = response.content
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath("/html/body/div/div[1]/div[1]")
    for et_target in et_targets:
        print(et_target.text)
```

- å¾—åˆ°æ¯ä¸ªå­é¡µé¢çš„
	- ç¬¬ä¸€ä¸ªæ ç›®å

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713152970469)

- æƒ³è¦å¾—åˆ°æ¯ä¸ªå­é¡µé¢çš„
	- æ‰€æœ‰æ ç›®åå‘¢ï¼Ÿ

### ä¿®æ”¹xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713153084126)

- æŸ¥æ‰¾åˆ°æ¯ä¸ªé“¾æ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713153109104)

- é™¤äº†è¯¾ç¨‹å
  - è¿˜æƒ³ä¿å­˜æ•™ç¨‹ç½‘å€

### æ–°çš„xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657723049808)

- æ‰¾åˆ° å’Œæ—§ç‰ˆ çš„å…³è”æ€§
	- ä¸€ä¸ªé¢˜ç›®
	- å¯¹åº” ä¸€ä¸ªé“¾æ¥

### ä»£ç 

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()[1:]
for url in urls:
    url = url.replace("\n","")
    response = requests.get(url)
    b_html = response.content
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath("/html/body/div/div/div[1]")
    et_links = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    for num in range(len(et_targets)):
        print(et_targets[num].text,end=",")
        print(et_links[num].attrib["href"])
```

- ç»“æœ
	- å¯ä»¥æŠŠå„ä¸ªç½‘å€è¾“å‡ºåˆ°å±å¹•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713153306791)

- å¯ä»¥å°†è¾“å‡ºç»“æœ
	- é‡å®šå‘åˆ°æ–‡æœ¬å—?

### è¾“å‡ºé‡å®šå‘

- :w|!python3 % > urls.csv
	- è¾“å‡ºé‡å®šå‘ åˆ°ä¸€ä¸ªcsvæ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713153541586)

- å¯ä»¥ç†è§£ä¸º
	- ä¸€ä¸ªæ–‡æœ¬å½¢å¼çš„
	- ç”µå­è¡¨æ ¼
- å¯ä»¥ç”¨ç”µå­è¡¨æ ¼æ‰“å¼€å—ï¼Ÿ

### å®‰è£…ç”µå­è¡¨æ ¼è½¯ä»¶

```
sudo apt update
yes|sudo apt install libreoffice

```

- å®‰è£…å®Œæ¯•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713153988405)

### æ‰“å¼€csv

```
libreoffice urls.csv
```

- æ‰“å¼€ç”µå­è¡¨æ ¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154085083)


### å›é¡¾æµç¨‹

- æˆ‘ä»¬å…ˆçˆ¬çš„æ˜¯é¦–é¡µ
  - çˆ¬å‡ºå¾ˆå¤šé“¾æ¥
  - ç„¶åå­˜åˆ° urls.txt çš„é‡Œé¢
- ç„¶åéå† urls é‡Œé¢çš„æ¯ä¸€ä¸ªåœ°å€
  - å¾—åˆ°è¯¾ç¨‹çš„åå­—å’Œé“¾æ¥
  - ç„¶åå…¥åº“

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154167399)

- å¯ä»¥ å°†æ•°æ® æ”¾å…¥
	- çœŸæ­£çš„æ•°æ®åº“å—ï¼Ÿ

### å…¥åº“

- æ›´æ–°ç³»ç»Ÿå®‰è£… postgres
- å¯åŠ¨ postgres
- å¹¶ä»¥ postgres ç™»å½•

```
sudo apt update
yes | sudo apt install postgresql
sudo /etc/init.d/postgresql start
sudo -u postgres psql

```

- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ database

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630664944685)

### æŸ¥çœ‹æ•°æ®åº“

```
\l
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665003642)

- å»ºç«‹æ•°æ®åº“ oeasy
- å¹¶è¿›å…¥

```
CREATE DATABASE 
    oeasy;
\l
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665050881)

- æŒ‰<kbd>q</kbd
	- é€€å‡ºæŸ¥è¯¢

### è¿›å…¥æ•°æ®åº“

```
\c oeasy
\dt
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665134696)

###  å»ºè¡¨

```
CREATE TABLE urls(
    topic varchar, 
    url varchar
);
\dt
```

- å»ºè¡¨å¹¶æŸ¥çœ‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154508667)

###  å¯¼å…¥æ•°æ®

```
\COPY urls  FROM  '/home/shiyanlou/urls.csv'  DELIMITER ',' CSV ;
```

- å¯¼å…¥33æ¡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154638061)

### æŸ¥è¯¢æ•°æ®

```
SELECT 
    * 
FROM 
    urls
WHERE
    topic LIKE '%e%'
;
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154675093)

### å¦å¤–çš„æŸ¥è¯¢

```
SELECT 
    * 
FROM 
    urls
WHERE
	LENGTH(topic) > '5'
;
```

- ç­›é€‰ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240415-1713154703809)


### æ€»ç»“

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
  - oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
  - è·å– xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§ href çš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”æŠŠæ¯ä¸€ä¸ªé“¾æ¥éƒ½çˆ¬äº†ä¸€é
- èƒ½å‡ºå»çˆ¬ä¸ªç™¾åº¦ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
