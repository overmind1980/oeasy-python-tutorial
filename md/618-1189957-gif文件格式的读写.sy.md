---
show: step
version: 1.0
enable_checker: true
---

# opencv

## å›å¿†

- ä¸Šæ¬¡åˆ¶ä½œçš„æ—¶é’Ÿ
	- æ•°å­—å¼
	- è¡¨ç›˜å¼
- åœ¨æ­¤è¿‡ç¨‹ä¸­ä½¿ç”¨PILåŒ…
	- ä½¿ç”¨ç³»ç»Ÿå­—ä½“ åœ¨çŸ©é˜µä¸­è¿›è¡Œäº†ç»˜ç”»
	- è€Œä¸”è®©ç”»é¢åŠ¨äº†èµ·æ¥
- å¯ä»¥æŠŠåŠ¨ç”»ä¿å­˜ä¸‹æ¥å—ï¼ŸğŸ¤”

### å®‰è£…åŒ…

- é¦–å…ˆè¦å®‰è£…ä¸€ä¸ªè¯»å†™æ–‡ä»¶çš„å·¥å…·
	- imageio

```
pip install imageio
```

- å®‰è£…ä¹‹åæŸ¥çœ‹å¸®åŠ©

### imageio

```
firefox https://pypi.org/project/imageio/
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704964935407)

- ä¾‹ç¨‹æ˜¾ç¤ºè¯»å†™æ–¹æ³•

```
>>> import imageio
>>> im = imageio.imread('imageio:astronaut.png')
>>> im.shape  # im is a numpy array
(512, 512, 3)
>>> imageio.imwrite('astronaut-gray.jpg', im[:, :, 0])
```

- é‚£å¦‚ä½•å°†åŠ¨ç”»ä¿å­˜æˆgifæ ¼å¼å‘¢ï¼Ÿ

### é»‘ç™½é—ªåŠ¨çš„gifå›¾

- é€šè¿‡æŸ¥è¯¢å¯ä»¥ä½¿ç”¨imageioå®Œæˆ

```
firefox https://github.com/imageio/imageio
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704966318433)

### å…·ä½“ä»£ç 

```
import numpy as np       
import imageio        
import cv2            
from random import randint
black = np.zeros((480,640,3), np.uint8)
white = np.zeros((480,640,3), np.uint8)
white[:] = (255,255,255)
image_lst = []        
image_lst.append(black)
image_lst.append(white)
imageio.mimsave('./test.gif', image_lst, fps=1)
```

- ä¸€ç§’é»‘ï¼Œç„¶åä¸€ç›´éƒ½æ˜¯ç™½çš„

```
firefox test.gif
```

- å¯ä»¥åšå½©è‰²é—ªåŠ¨çš„æ•ˆæœå—ï¼Ÿ

### çº¢ç»¿è“çš„é—ªåŠ¨æ•ˆæœ
```
import numpy as np
import imageio
import cv2
from random import randint
red = np.zeros((480,640,3), np.uint8)
green = np.zeros((480,640,3), np.uint8)
blue = np.zeros((480,640,3), np.uint8)
blue[:] = (0,0,255)
green[:] = (0,255,0)
red[:] = (255,0,0)
image_lst = [red,green,blue]
imageio.mimsave('./test.gif', image_lst, fps=1)
```

- åˆ·æ–°ç½‘é¡µ
	- çº¢ç»¿è“å„ä¸€ç§’
	- ç„¶ååœæ­¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704966847723)

- å¯ä»¥æ— é™å¾ªç¯å—ï¼Ÿ

### å¾ªç¯è®¾ç½®

```
imageio.mimsave('./test.gif', image_lst,duration=0.5,loop=0)
```

- ä¿®æ”¹æœ€åä¸€å¥
	- fps å¸§é¢‘ç‡
	- duration æ¯å¸§æŒç»­æ—¶é—´
	- loop å¾ªç¯æ¬¡æ•° 0ä¸ºæ— é™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704967241106)

- åˆ·æ–°ç½‘é¡µè§‚å¯Ÿ

### æŠ–éŸ³çš„åŸºç¡€æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231104-1699092919251)

- æœŸå¾…æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704972147544)

### ä»£ç å®ç°

```
import cv2           
import imageio       
import numpy as np   
from random import randint
before = cv2.imread("/home/shiyanlou/tiktok.jpg")
image_list = []      
for i in range(30):  
    after = np.zeros((300,300,3),np.uint8)
    r = randint(0,50)
    print(r)         
    after[r:300,r:300,0] = before[0:300-r,0:300-r,0]
    after[0:300-r,0:300-r,1] = before[r:300,r:300,1]
    after[0:300-r,0:300-r,2] = before[r:300,r:300,2]
    image_list.append(after)
imageio.mimsave("./test.gif",image_list,fps=30)
```

- é—®é¢˜æ˜¯æ–¹å‘å¤ªè¿‡å›ºå®š
- èƒ½å¦æ›´åŠ éšæœºå‘¢ï¼Ÿ


### ä¸‹é¢çš„æ˜¯æŠ–éŸ³å®Œæ•´ç‰ˆ
```
import cv2                                                   
import imageio                                               
import numpy as np                                           
from random import randint                       
before = cv2.imread("/home/shiyanlou/tiktok.jpg")          
image_list = []                                              
for i in range(30):                                          
    after = np.zeros((300,300,3),np.uint8)                   
    r0 = randint(0,50) - 25                                  
    r1 = randint(0,50) - 25                                  
    r2 = randint(0,50) - 25                                  
    r3 = randint(0,50) - 25                                  
    if r0 >= 0 and r1 >= 0:                                  
        after[r0:300,r1:300,0] = before[0:300-r0,0:300-r1,0] 
    elif r0 >=0 and r1<0:                                    
        after[r0:300,0:300+r1,0] = before[0:300-r0,-r1:300,0]
    elif r0<0 and r1>=0:                                     
        after[0:300+r0,r1:300,0] = before[-r0:300,0:300-r1,0]
    else:                                                    
        after[0:300+r0,0:300+r1,0] = before[-r0:300,-r1:300,0]
    if r2 >= 0 and r3 >= 0:                                  
        after[r2:300,r3:300,1:3] = before[0:300-r2,0:300-r3,1:3]
    elif r2 >=0 and r3<0:                                    
        after[r2:300,0:300+r3,1:3] = before[0:300-r2,-r3:300,1:3]
    elif r2<0 and r3>=0:                                     
        after[0:300+r2,r3:300,1:3] = before[-r2:300,0:300-r3,1:3]
    else:                                                    
        after[0:300+r2,0:300+r3,1:3] = before[-r2:300,-r3:300,1:3]
                                                             
    image_list.append(after)                                 
imageio.mimsave("./test.gif",image_list,fps=30)
```

- è¿è¡Œæ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704972294131)

- å¯ä»¥æ…¢ä¸‹æ¥ å¹¶ä¸”çœ‹æ¸…æ¯æ¬¡ä½ç§»å—ï¼Ÿ

### æŠ–éŸ³æ•°æ®

```
import cv2                                                   
import imageio                                               
import numpy as np                                           
from random import randint   
before = cv2.imread("/home/shiyanlou/tiktok.jpg")
image_list = []                              
for i in range(30):                          
    after = np.zeros((300,300,3),np.uint8)   
    r0 = randint(0,50) - 25                  
    r1 = randint(0,50) - 25                  
    r2 = randint(0,50) - 25                  
    r3 = randint(0,50) - 25                  
    if r0 >= 0 and r1 >= 0:                  
        after[r0:300,r1:300,0] = before[0:300-r0,0:300-r1,0]
    elif r0 >=0 and r1<0:                    
        after[r0:300,0:300+r1,0] = before[0:300-r0,-r1:300,0]
    elif r0<0 and r1>=0:                     
        after[0:300+r0,r1:300,0] = before[-r0:300,0:300-r1,0]
    else:                                    
        after[0:300+r0,0:300+r1,0] = before[-r0:300,-r1:300,0]
    if r2 >= 0 and r3 >= 0:                  
        after[r2:300,r3:300,1:3] = before[0:300-r2,0:300-r3,1:3]
    elif r2 >=0 and r3<0:                    
        after[r2:300,0:300+r3,1:3] = before[0:300-r2,-r3:300,1:3]
    elif r2<0 and r3>=0:                     
        after[0:300+r2,r3:300,1:3] = before[-r2:300,0:300-r3,1:3]
    else:                                    
        after[0:300+r2,0:300+r3,1:3] = before[-r2:300,-r3:300,1:3]
    s = str(r0) + ":" + str(r1) + "," + str(r2) + ":" + str(r3)
    cv2.putText(after,s,(0,80),cv2.FONT_HERSHEY_TRIPLEX,1,(255,255,255),1)
    image_list.append(after)                 
imageio.mimsave("./test.gif",image_list,fps=1)
```

- å‚æ•°è§‚å¯Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240111-1704972710582)

### æ€»ç»“ 

- è¿™æ¬¡åˆ¶ä½œäº†åŠ¨å›¾gif
- å¯ä»¥è®¾ç½®
	- fps
	- duration
	- loop
- ä»¥å‰çš„åŠ¨ç”»
	- åº”è¯¥éƒ½å¯ä»¥ä¿å­˜æˆåŠ¨å›¾äº†
- åŠ¨ç”»è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å—ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ğŸ‘‹