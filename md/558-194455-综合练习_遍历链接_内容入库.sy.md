---
show: step
version: 1.0
enable_checker: true
---

# xpath è·¯å¾„è¡¨è¾¾å¼

## å›å¿†

- ä¸Šæ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
  - oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
  - è·å– xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§ href çš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”å­˜å‚¨åˆ°äº† urls.txt ä¸­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722223759)

- èƒ½æŠŠè¿™äº›é“¾æ¥éƒ½çˆ¬ä¸€éä¹ˆï¼ŸğŸ¤”

### éå†

- å¦å­˜ä¸€ä¸ªo2z.py
	- ç„¶åæ‰“å¼€ä¿®æ”¹


```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()
for url in urls:
    response = requests.get(url)
    b_html = response.content
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath(".")
    for et_target in et_targets:
        print(et_target.tag)
```

- è¿è¡Œå‡ºç°äº† 12 æ¬¡ html èŠ‚ç‚¹


### ä¿®æ”¹ä»£ç 

### æ‰¾åˆ° xpath

- å³é”®`ç”µè·¯`ä¸‹çš„ç”µè·¯åŸºç¡€é“¾æ¥
	- å¤åˆ¶ xpath
	- ä¿®æ”¹ä»£ç 
- æŒ‰ç…§åœ°å€
  - è¾“å‡ºé¡¹ç›®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657721910608)

- æœ‰ä¸€ç‚¹é—®é¢˜
	- loveè¿™ä¸€é¡µ
	- ä¸å…¶ä»–ä¹Ÿä¸åŒ
	- åº”è¯¥æ’é™¤
	- ä½¿ç”¨sliceåˆ‡ç‰‡çš„æ–¹å¼

### æŠ¥é”™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722628688)

- è¾“å‡ºçš„ç½‘å€è²Œä¼¼å¯ä»¥ç›´æ¥åœ¨ç«ç‹é‡Œè®¿é—®
- ä½†æ˜¯çˆ¬è™«çˆ¬åˆ°çš„éƒ½æ˜¯404

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722676601)

### è¾“å‡ºurl

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722813147)

- æŠŠurlå¤´å°¾éƒ½åŠ ä¸Šä¸­åˆ’çº¿
- å¯ä»¥æ˜ç¡®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722826335)

- åŸæ¥æ˜¯ç½‘å€åé¢å¤šäº†ä¸ª`\n`

### ä¿®æ”¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722916867)

- æ›¿æ¢æ‰å›è½¦æ ‡è®°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657722933261)

- é™¤äº†è¯¾ç¨‹å
  - è¿˜æƒ³ä¿å­˜æ•™ç¨‹ç½‘å€

### æ–°çš„xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657723049808)

### åˆ†åˆ«è¾“å‡º

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657723201033)

- å¯ä»¥åˆ†åˆ«è¾“å‡º

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657723217357)

### éå†

- æ‰“å¼€é“¾æ¥åå†å­˜å‚¨
  - å„æ•™ç¨‹åç§°
  - çœ‹æ•™ç¨‹ç½‘å€

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.readlines()[1:]
for url in urls:
    url = url.replace("\n","")
    response = requests.get(url)
    b_html = response.content
    et_html = etree.HTML(b_html)
    et_targets = et_html.xpath("/html/body/div/div/div[1]")
    et_links = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    for num in range(len(et_targets)):
        print(et_targets[num].text)
        print(et_links[num].attrib["href"])
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220713-1657723432377)


```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")[1:-1]
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath("/html/body/div/div/div[1]")
    et_target2 = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    print("url----"+url)
    count = 0
    while ( count < len(et_target)):
        print(et_target[count].text)
        print(et_target2[count].text)
        print(et_target2[count].attrib["href"])
        count = count + 1
        print("count====" + str(count))
```

- å°†urls.txtä¸­å¾—åˆ°çš„åˆ—è¡¨è¿›è¡Œè£åˆ‡[1:-1]
	- å‰é¢çš„1 æ’é™¤äº†ç¬¬0ä¸ª
	- åé¢çš„-1 æ’é™¤äº†æœ€åä¸€ä¸ª
- å¯ä»¥æŠŠå„ä¸ªç½‘å€è¾“å‡ºåˆ°å±å¹•
- ç°åœ¨éœ€è¦æŠŠè¾“å‡ºé‡å®šå‘åˆ°æ–‡æœ¬æ–‡ä»¶

### ä¿å­˜åˆ°æŒä¹…æ–‡ä»¶

```
import requests
from lxml import etree
with open("urls.txt") as f:
    urls = f.read().split("\n")[1:-1]
for url in urls:
    response = requests.get(url)
    s_html = response.content.decode("utf-8")
    et_html = etree.HTML(s_html)
    et_target = et_html.xpath("/html/body/div/div/div[1]")
    et_target2 = et_html.xpath("/html/body/div/div/div[2]/a[1]")
    count = len(et_target)
    with open("urls.csv","at") as f:
        for cur in range(0,count):
            print("cur====" + str(cur))
            print(et_target[cur].text)
            print(et_target2[cur].text)
            print(et_target2[cur].attrib["href"])
            s_url = et_target[cur].text + "," \
                  + et_target2[cur].attrib["href"] + "\n"
            f.write(s_url)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220313-1647160146482)


### å›é¡¾æµç¨‹

- æˆ‘ä»¬å…ˆçˆ¬çš„æ˜¯é¦–é¡µ
  - çˆ¬å‡ºå¾ˆå¤šé“¾æ¥
  - ç„¶åå­˜åˆ° urls.txt çš„é‡Œé¢
- ç„¶åéå† urls é‡Œé¢çš„æ¯ä¸€ä¸ªåœ°å€
  - å¾—åˆ°è¯¾ç¨‹çš„åå­—å’Œé“¾æ¥
  - ç„¶åå…¥åº“
- æˆ‘ç°åœ¨å…ˆæŠŠæ•´ä¸ªæµç¨‹åˆåœ¨ä¸€èµ·
- åšæˆä¸€ä¸ª py æ–‡ä»¶


### å…¥åº“

- æ›´æ–°ç³»ç»Ÿå®‰è£… postgres
- å¯åŠ¨ postgres
- å¹¶ä»¥ postgres ç™»å½•

```
sudo apt update
sudo apt install postgresql
sudo /etc/init.d/postgresql start
sudo -u postgres psql
```

- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ database

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630664944685)

### æŸ¥çœ‹æ•°æ®åº“

```
\l
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665003642)

- å»ºç«‹æ•°æ®åº“ oeasy
- å¹¶è¿›å…¥

```
create database oeasy;
\l
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665050881)

### å»ºè¡¨å¹¶å¯¼å…¥æ•°æ®

```
\c oeasy
\dt
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665134696)

- å»ºè¡¨

```
create table urls(topic varchar, url varchar);
\dt
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665232801)

- å¯¼å…¥æ•°æ®

```
\copy urls from '/home/shiyanlou/urls.csv' delimiter ',' csv ;
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665741698)

- æŸ¥è¯¢æ•°æ®

```
select * from urls where topic like '%e%';
select * from urls where length(topic) > '5';
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210903-1630665711812)

### æ€»ç»“

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
  - oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
  - è·å– xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§ href çš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”æŠŠæ¯ä¸€ä¸ªé“¾æ¥éƒ½çˆ¬äº†ä¸€é
- èƒ½å‡ºå»çˆ¬ä¸ªç™¾åº¦ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
