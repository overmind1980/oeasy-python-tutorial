---
show: step
version: 1.0
enable_checker: true
---

# 双层架构
## 我们来回顾一下 😌

- 最初的计算
	- 都在 `一个`机器上进行
	- 自身 对于自身 进行`反馈`
- 反馈分成两种
	- 正反馈(容易失控)
	- 负反馈(稳定在平衡位置)
- 下面这个 就是1-tier架构
	- 纯纯的 模拟电路

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651726915855)

- 如果 规模化 之后	
	- 一般 都要控制 
	- 很多传感器和水泵
	- 又要 `怎么办`呢？🤔

### 保湿

- 每个大棚
	- 都有湿度传感器
	- 位置是分散的
	- 数据传回 上位机

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20240409-1712651785807)

- 上位机
	- 其实就是一个 
	- 服务器
	- server
	- 通过 程序 处理 湿度信息

### 处理

- 程序接受 监测信息 进行判断
	- 如果湿度不够就浇水
	- 如果湿度够了就停止
	- 不能旱的旱死涝旳涝死

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651726480650)

- 具体哪个
	- 滴灌 设备 浇水
	- 浇多少水
	- 都是由 服务器 决定的
- 这就是2-tier架构

### Host

- 一个主机(Host)可以
	- 有 `多个`终端(terminal)
	- 和他相连

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20230429-1682766155830)

- 这种主机-终端的模式
	- 被保留了下来

### 网吧游戏

- 所有人不可能都在 
	- 同一个电脑上打游戏
	- 这就需要都连接到主机

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220519-1652931093478)

- 有人建主机(Host)
	- 然后等待玩家加入
	- 等待的玩家算是客(client)
- 客到了
	- 加入了主机建立的游戏
	- 才能玩游戏

### 协议进化

- 后来 链接的协议
	- 从局域网的ipx
	- 进化到了英特网的tcp/ip

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220519-1652930765716)

- 但是原理
	- 没有变
- `一个` 服务器
	- 响应 `多个` 客户端请求

### 服务器

- 大家  
	- 都连接到 某个ip的服务器
	- 然后 一起玩游戏
- 这其实就分出了两端
	- 前端
	- 后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651721298317)

- 那前后端
	- 各管什么呢？
- 先说说
	- 前端或者说客户端管什么？

### 前端

- 游戏的
	- 图形界面
	- 峡谷场景模型
	- 英雄皮肤
	- 动作数据
	- 魔法效果
	- 语音包

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724450462)

- 这些看得见、听得着的东西
- 更新客户端
	- 就是从服务器上 下载这些看得见、听得着的东西
	- 就可以看到 新的模型、动作和特效
- 那 后端 管什么 呢？

### 后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724754077)

- 后端或者说服务端管什么
	- 对玩家的奖惩
	- 拉新促活的活动
	- 对战双方的匹配
	- 铭文的装备
	- 技能的具体数值

### 卡顿

- 如果游戏过程中
	- 把网给断了
	- wifi、5g 都断了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220515-1652621228834)

- 比如你放了一个大
	- 由于网断了
		- 所以无法上传到服务器
		- 服务器也就无法更新你的数据
- 服务器一直在运行
	- 那九个人还在玩
- 你
	- 不但没有放出大
	- 而且已经死了
	- 根本连不上去了

### 更新

- 运行游戏之前
	- 需要更新

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724292725)

- 有各种各样的资源包
	- 这些都要下载到手机前端(客户端)
	- 更新的是手机存储器上的app
	- 这种属于热更新
	- 服务器不用停机重启
- 那什么东西 
	- 放在后端呢？

### 核心数据

- 对于你所拥有
	- 哪些英雄
	- 哪些铭文
	- 哪些皮肤
	- 都放在后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725280922)

- 如果 要对核心的程序 `结构`更新
	- 比如加入 一个防沉迷系统
	- 会发生什么呢？
- `只`在 前端变化 或者 后端 调整 
	- 都不行
- 要一起 更新
	- 大的补丁(防沉迷)
	- 会发生什么呢？

### 先测试

- 让部分玩家 
	- 下载体验服 对应的客户端
	- 测试客户端 连接到 测试服务期
	- 有新的内容和业务逻辑
	- 玩的过程 进行反馈
	- 调整 解决问题到 
	- 最终发布版

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725608053)

- 等待 最终发布

### 停服更新

- 把服务器停下来(冷更新)
	- 用 新代码编译后的结果
	- 替代旧代码
	- 服务器就更新了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725302964)

- 所有人进入客户端的时候
	- 更新到新版客户端
- 这样服务器和客户端就都更新了
	- 这种C/S架构是internet的基础
- 随着时间的推移
	- 出现了一种新的客户端

### 浏览器

- 原来每种客户端都有自己的用途
	- 游戏客户端
	- 邮件客户端
	- 视频app客户端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651727397152)

- 但是 浏览器 什么都能做
	- 玩游戏
	- 收发网页
	- 看视频
- 甚至可以
	- 网页版聊天

- 那这种浏览器
	- 相对于客户端 有什么好处么？

### VS

- 客户端能干的事情
	- 浏览器都能干
	- 而且他还不用
	- 下载或者更新客户端
- 直接 就能 用起来 

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651727646995)

- 浏览器(browser)
	- 本质上也是一个客户端(client)
	- 一个网页查看客户端
	- 也是2-tier架构
	- 分成前后两端

### 划分

- 后端
	- 优点是浏览器看不见，保密性好
	- 数据敏感度、安全性高的放在后端安全
- 前端
	- 优点是 在浏览器上就直接计算
	- 数据响应时间 敏感度高的 就在前端
	- 比如 
		- 一个浏览器的动画效果
			- 没有必要再去服务器走个来回
		- 前端 密码验证一致性
	- UI交互相关度较高
		- 也都放到前端
	- 还是 那些
		- 看得见听得着的东西
- 这种划分 也就造成了
	- 前后端工程师侧重的不同

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636897719334)

- 双方都有
	- `什么`看家本事呢？

### 前端 vs 后端

- 前端工程师
	- html、css、javascript
	- 注重 美术、设计
	- 注重 前端交互技术
	- 考虑怎样 能让用户 觉得 用起来更舒服
	- 考虑 界面布局、交互效果、页面加载速度
	- 主要是 偏向用户看得见的部分
	- 客户端（pc、手机、pad）上浏览web

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898000231)

- 后端工程师
	- java、python、go等后端语言
	- 后端的应用服务器比如tomcat
	- 通过语言访问后台数据库
	- 管的是用户看不到的部分
	- 想办法让服务速度更快
		- 考虑业务逻辑
		- 数据库表结构设计
		- 服务器配置
		- 负载均衡
		- 数据的存储
		- 跨平台API设计
- 可以从整体上分析么？

### 整体

- 前后端有不同的技术
	- 各自都很厉害

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220515-1652620801694)

- 中间使用网络通信协议连接起来 
	- 需要彼此配合

### 回归

- 今天我们可以看到前后端技术如此不同

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898102314)

- 但是 也不要忘了 回到当初
	- 我们把计算机 使用网络 连接了起来
	- 人为地区分出
		- 主机(host)和终端(terminal)
		- 服务器(server)和客户端(client)
		- 乃至到今天的
		- 服务器(server)和浏览器(browser)
- 一分为二很容易
	- 难的是合二为一

### 总结

- 只有两端都了解
	- 才能促进中间接口的进化

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898021424)

- 前端 可以计算
- 后端 也可以计算
- 那究竟
	- 计算 放在 `哪端` 好呢？
- 比如 我想要计算
	- 1到100的和
- 前后端 分别会 
	- `如何处理` 呢？🤔
- 下次再说👋🏻