---
show: step
version: 1.0
enable_checker: true
---

# çˆ¬å–ç™¾åº¦

## å›å¿†

- è¿™æ¬¡çœŸçš„çˆ¬äº†ä¸€ä¸ªç½‘ç«™
  - oeasy.org
- å³é”®æ£€æŸ¥å…ƒç´ 
  - è·å– xpath
- çˆ¬å–ä¹‹åè·å¾—å±æ€§ href çš„å€¼
- ç„¶ååˆ‡ç‰‡å¹¶æ‹¼æ¥ä¸ºç»å¯¹é“¾æ¥åœ°å€
- å¹¶ä¸”æŠŠæ¯ä¸€ä¸ªé“¾æ¥éƒ½çˆ¬äº†ä¸€é
- èƒ½å‡ºå»çˆ¬ä¸ªç™¾åº¦ä¹ˆï¼ŸğŸ¤”

### ç¡®è®¤ä¸Šç½‘

- ä¸€èˆ¬çš„å®éªŒæ¥¼æ³¨å†Œä¼šå‘˜
	- æ˜¯ä¸èƒ½åœ¨è™šæ‹Ÿæœºé‡Œä¸Š baidu ä¹‹ç±»çš„ç½‘ç«™çš„
	- å¯ä»¥åœ¨æœ¬æœºé‡Œä½¿ç”¨ç«ç‹å’Œ python

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635045425558)

- æƒ³è¦çˆ¬ç™¾åº¦
	- é¦–å…ˆè¦ç¡®è®¤èƒ½ä¸Šç™¾åº¦

### å‡†å¤‡ç¯å¢ƒ

- å¯¼å…¥äº†è¯¥åŒ…
	- ç„¶åå‘é€è¯·æ±‚

```
import requests
from lxml import etree
response = requests.get("http://www.baidu.com")
print(response.content)
```

- è¿”å›ç»“æœå¼‚å¸¸ç®€å•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231029-1698541705991)

### æ¯”è¾ƒ

- å°è¯•å’Œç™¾åº¦æºä»£ç æ¯”è¾ƒ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231029-1698541728162)

- ç™¾åº¦æœ¬èº«ä¹Ÿæ˜¯çˆ¬è™«
- ä»–å‘ç°äº†æˆ‘ä»¬æ˜¯çˆ¬è™«
- ç»“æœå°±æŠŠæˆ‘ä»¬ç»™ç¦äº† ğŸ˜°
- é‚£æ€ä¹ˆåŠï¼ŸğŸ˜±

### å‡è£…

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635046905973)

- ç„¶åæŠŠè¿™ä¸ª key-value å¯¹å†™åˆ° header ä¸­

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("http://www.baidu.com", headers=headers)
print(response.content)
```

- æ³¨æ„ headers æ˜¯ä¸€ä¸ªå­—å…¸
  - key-value ä¹‹é—´æœ‰å†’å·
  - key å’Œ value éƒ½æœ‰åŒå¼•å·åŒ…è£¹
  - å†’å·åŒå¼•å·éƒ½æ˜¯åŠè§’çš„
- è¯·æ±‚ä¸­çš„åè®®æ˜¯ https
- å¥½åƒå¯ä»¥å¾—åˆ°æ­£ç¡®çš„å“åº”

### å¤åˆ¶header

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220716-1657979859154)

- ä¸Šå›¾å¯çŸ¥
- æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠæ‰€æœ‰çš„headerå¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­
- å› ä¸ºæœ‰äº›åœ°æ–¹è®¿é—®çš„æ—¶å€™é™¤äº†Use-Agent
- è¿˜è¦æ±‚å…¶ä»–çš„Header

### ç”Ÿæˆ etree

- è¿™ä¸‹æŠŠæ­£ç¡®çš„å“åº”æ”¾åˆ° lxml ä¸­è¿›è¡Œè§£æ
- ç”Ÿæˆä¸€æ£µ etree

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635047598112)

- ä½†æ˜¯å¾—åˆ°çš„è¿™ä¸€æ£µæ ‘
- æˆ‘æ€æ ·æ‰èƒ½æ‰¾åˆ°ç›¸åº”çš„å†…å®¹å‘¢
- è¿™å°±éœ€è¦ xpath

### æ‰¾ xpath

- æ‰¾ä¹‹å‰è¦ç¡®è®¤ç™»å½•çŠ¶æ€
  - æˆ‘ä»¬è¿™ä¸ªæ˜¯æ²¡æœ‰ç™»é™†çš„ç™¾åº¦é¦–é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635047760757)

- å³é”®å·¦ä¸Šè§’çš„æ–°é—»
  - æ£€æŸ¥å…ƒç´ 
- å¯ä»¥çœ‹åˆ°ä»–å¯¹åº”ç€ a æ ‡ç­¾
- åé¢çš„åœ°å›¾ä¹‹ç±»çš„ä¹Ÿå¯¹åº”ç€ a æ ‡ç­¾
- å¦‚ä½•å¾—åˆ° xpath å‘¢ï¼Ÿ

### å¾—åˆ° xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635047839977)

- å³é”®å…ƒç´ å¯ä»¥æ‰¾åˆ°ä»–å¯¹åº”çš„ xpath
  - /html/body/div[2]/div[1]/div[3]/a[1]
- ä½†æ˜¯å®é™…ä¸Šèƒ½çˆ¬å–åˆ°çš„æ˜¯
	- /html/body/div[1]/div[1]/div[3]/a[1]
- è¿™æ€ä¹ˆåŠï¼Ÿ

### å°è¯•

- å¯ä»¥é€ä¸ªå»é™¤ä½ç½®è°“è¯æ‰¾ä¸€ä¸‹
	- /html/body/div/div[1]/div[3]/a[1]
- ç¡®è®¤å¯ä»¥æ‰¾åˆ° åœ¨å»é™¤açš„ä½ç½®è°“è¯
	- /html/body/div/div[1]/div[3]/a[1]

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("https://www.baidu.com", headers=headers)
#print(response.text)
et_html = etree.HTML(response.content)
l_et_a = et_html.xpath("/html/body/div/div[1]/div[@id='s-top-left']/a")
for anchor in l_et_a:
    print(anchor.text)
```

- ä¹Ÿå¯ä»¥ä½¿ç”¨idå±æ€§è°“è¯ç¡®è®¤div
- æˆ–è€…åŒé‡è°“è¯

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("https://www.baidu.com", headers=headers)
#print(response.text)
et_html = etree.HTML(response.content)
l_et_a = et_html.xpath("/html/body/div/div[1]/div[@id='s-top-left'][3]/a")
for anchor in l_et_a:
    print(anchor.text)
```

### ç­›é€‰å…ƒç´ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635047975898)

- æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ª a å…ƒç´ çš„åˆ—è¡¨
- æˆ‘ä»¬éå†è¿™ä¸ªåˆ—è¡¨

### éå†åˆ—è¡¨

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("https://www.baidu.com", headers=headers)
#print(response.text)
et_html = etree.HTML(response.content)
l_et_a = et_html.xpath("/html/body/div/div[1]/div[3][@id='s-top-left']/a")
for anchor in l_et_a:
    print(anchor.text)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635048067904)

- å› ä¸ºidå±æ€§ä¸€èˆ¬æ˜¯å”¯ä¸€çš„
- æ‰€ä»¥å¯ä»¥ä¿®æ”¹ä¸º

### ä¿®æ”¹å

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("https://www.baidu.com", headers=headers)
#print(response.text)
et_html = etree.HTML(response.content)
l_et_a = et_html.xpath("//div[@id='s-top-left']/a")
for anchor in l_et_a:
    print(anchor.text)
```

- å¦‚æœæˆ‘æƒ³æŠŠé“¾æ¥ä¹Ÿè¾“å‡º
- åº”è¯¥æ€ä¹ˆåŠï¼Ÿ

### è¾“å‡ºè¿æ¥

- å…ˆæŸ¥ä¸€ä¸‹æ–‡æ¡£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635048399340)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635048417860)

- éå†å®Œæˆ
- è¿™å¾ˆç®€å•
- æˆ‘ä»¬å†çœ‹çœ‹ç™¾åº¦çƒ­æœ

### ç™¾åº¦çƒ­æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635048555965)

- xpath æ˜¯
  - /html/body/div[1]/div[1]/div[5]/div/div/div[3]/ul/li[1]/a/span[2]
  - é€šè¿‡è§‚å¯Ÿ
  - ç›¸å…³çš„åˆ—è¡¨å¯¹åº”çš„ xpath åº”è¯¥æ˜¯
    - /html/body/div[1]/div[1]/div[5]/div/div/div[3]/ul/li/a/span[2]

### è¿›è¡Œéå†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635048757888)

- ä½†æ˜¯æˆ‘å¦‚æœæƒ³è¦åŒæ—¶è¾“å‡ºå…·ä½“é“¾æ¥å‘¢ï¼Ÿ

### é‡æ–°æ„é€ åˆ—è¡¨

- span åœ¨ a é‡Œé¢
- æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰çš„ a çš„åˆ—è¡¨æ‹¿åˆ°
- ç„¶åå†ä½¿ç”¨ä¸‹è¡¨çš„æ–¹å¼æ‰¾åˆ° span çš„ text

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635049094363)

- è¿˜å¯ä»¥éå†æœ€ä¸‹é¢çš„é“¾æ¥å—ï¼Ÿ

### æœ€ä¸‹é¢çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635049252958)

- è¿™ä¸ªå¥½åƒæ¯”è¾ƒç®€å•
- æ–‡å­—å’Œé“¾æ¥éƒ½åœ¨ a å…ƒç´ ä¸­

### xpath

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635049346923)

- a å…ƒç´ åœ¨ p å…ƒç´ ä¸­
- æ‰€ä»¥æŠŠ p å…ƒç´ çš„ç´¢å¼•å»æ‰
- /html/body/div[1]/div[1]/div[7]/div/p/a

### éå†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211024-1635049450518)

```
import requests
from lxml import etree
headers ={"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"}
response = requests.get("https://www.baidu.com", headers=headers)
#print(response.text)
et_html = etree.HTML(response.content)
#l_et_a = et_html.xpath("/html/body/div/div[1]/div[3][@id='s-top-left']/a")
#l_et_a = et_html.xpath("/html/body/div/div[1]/div[5]/div/div/div[3]/ul/li/a/span")
l_et_a = et_html.xpath("/html/body/div[1]/div[1]/div[7]/div/p/a")
for anchor in l_et_a:
    print(anchor.text)
    print(anchor.attrib["href"])
```

### æ€»ç»“

- è¿™æ¬¡çˆ¬äº† baidu.com
	- æ‰¾åˆ°äº†ä¸‰ç»„é“¾æ¥
	- ç„¶ååˆ†åˆ«éå†
- ä½†æ˜¯ headers ç”Ÿæˆçš„æ–¹æ³•æœ‰ç‚¹éº»çƒ¦
- æœ‰æ›´å¿«çš„ç”Ÿæˆheadersçš„æ–¹æ³•å—ï¼Ÿ
- ä¸‹æ¬¡å†è¯´
