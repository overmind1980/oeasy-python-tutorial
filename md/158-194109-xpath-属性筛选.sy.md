---
show: step
version: 1.0
enable_checker: true
---

# è¯­æ³• html ç”Ÿæˆ

## å›å¿†

- ä¸Šæ¬¡æ·±å…¥äº† xpath
- xpath å¯ä»¥ç”¨æ¥ç­›é€‰ xml æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹
- xpath æœ‰ä¸€å¥—è‡ªå·±çš„è¯­æ³•
  - nodename ç›´æ¥å­èŠ‚ç‚¹
  - /åœ¨æœ€å‰é¢æ˜¯æ ¹ä¸‹çš„æ„æ€
  - /åœ¨ä¸­é—´æ˜¯ç›®å½•ä¸‹çš„æ„æ€
  - //å­å­™ç»“ç‚¹
  - . å½“å‰èŠ‚ç‚¹
  - .. å‘ä¸Šä¸€å±‚èŠ‚ç‚¹
  - @ å±æ€§
- è¿™ä¸ªå±æ€§æˆ‘ä»¬è¿˜æ²¡æœ‰è¯•è¯•
- æ€ä¹ˆç”¨å‘¢ï¼ŸğŸ¤”

### ä¿®æ”¹ç½‘é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552088832)

### æ£€æŸ¥å…ƒç´ 

- åœ¨æµè§ˆå™¨ä¸­é€‰ä¸­å…ƒç´ 
- ç„¶åå³é”® `æ£€æŸ¥å…ƒç´ `

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552096699)

### ä¿®æ”¹ä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552149907)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552158701)

- ç¬¬ 7 è¡Œæ²¡æœ‰é—®é¢˜
- ç¬¬ 9 è¡Œå‡ºç°äº†é—®é¢˜
- xpath èƒ½å¤Ÿæ‰¾åˆ°äº›ä»€ä¹ˆ
- ä½†æ˜¯æ‰¾åˆ°çš„ä¸œè¥¿æ²¡æœ‰ tag

### å†æ”¹ä»£ç 

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.content
#print(s_html)
et_html = etree.HTML(s_html)
et_target = et_html.xpath("//@lang")
for value in et_target:
    print(value)
```

- è¿è¡ŒæˆåŠŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552310013)

- æ‰¾åˆ°ç›¸åº”çš„å±æ€§å€¼
- è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ‹¿åˆ°äº†
  - Element å…ƒç´ çš„
    - å±æ€§ attrib çš„
      - value
- å…·ä½“æ¥è¯´å°±æ˜¯
  - html å…ƒç´ çš„
    - lang å±æ€§çš„
      - value
- å¯æ˜¯ä»–æ˜¯æ€ä¹ˆæ‹¿åˆ°çš„å‘¢ï¼Ÿ

### ä»£ç åˆ†æ

```
et_target = et_html.xpath("//@lang")
```

- et_html æ˜¯æ ¹å…ƒç´ 
- xpath çš„å‚æ•°æ˜¯"//@lang"
  - //æ˜¯æ‰¾ä¸‹é¢æ‰€æœ‰å­å­™
  - @è¯´æ˜æ‰¾çš„ä¸æ˜¯ Element å…ƒç´ 
  - @èŠ± a è¯´æ˜æ‰¾çš„æ˜¯ Attribute å±æ€§
  - å±æ€§çš„åå­—å«åš lang
- è¿™æ ·æ‰å¾—åˆ° lang å±æ€§çš„å€¼
  - è¿˜æœ‰ä»€ä¹ˆå¯ä»¥æ‰¾åˆ°çš„ä¸œè¥¿ä¹ˆï¼Ÿ

### è°“è¯­ predicates

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630552360248)

- æˆ‘ä»¬é’ˆå¯¹ä¸€æ¡æ¡çš„éƒ½è¯•è¯•

### å°è¯•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553079798)

- è¿™é‡Œé¢å‡ºç°äº†ä¸‹è¡¨è¿ç®—ç¬¦
- æˆ‘æƒ³æ‰¾ä¸€ä¸‹ç¬¬ 1 ä¸ª li

### ä¸Šç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553178100)

- et_target = et_html.xpath("//ul/li[1]")
  - li[0]æ‰¾ä¸åˆ°
  - etree çš„å­å…ƒç´ ç¼–å·æ˜¯ä» 1 å¼€å§‹çš„
  - li[1]æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ 
  - æ³¨æ„è¿™é‡Œè¾“å‡ºçš„æ˜¯ text

### æœ€åä¸€ä¸ª

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553237854)

- åœ¨ç´¢å¼•è¿ç®—ç¬¦ä¸­ä½¿ç”¨äº† last()

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

### ä¿®æ”¹ä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553305681)

- et_target = et_html.xpath("//ul/li[last()]")
- å¯ä»¥æ‰¾åˆ°æœ€åä¸€ä¸ªèœ
  - æŠ˜è€³æ ¹

### å€’æ•°ç¬¬äºŒ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

- å…³é”®è¿˜æ˜¯å¯¹ li ä½¿ç”¨ç´¢å¼•è¿ç®—ç¬¦
  - last()æ˜¯æœ€åä¸€ä¸ª
  - last() - 1 æ˜¯å€’æ•°ç¬¬äºŒä¸ª

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553455827)

- et_target = et_html.xpath("//ul/li[last()-1]")
- å¯ä»¥æ‰¾åˆ°å€’æ•°ç¬¬äºŒä¸ªèœ
  - ç¾Šç˜ªæ±¤

### å‰ä¸¤å position

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553841920)

- et_target = et_html.xpath("//ul/li[position()<3]")
- å¯ä»¥æ‰¾åˆ°å‰ä¸¤é¡¹
- å¦‚æœæˆ‘æƒ³æ‰¾åä¸¤é¡¹å‘¢ï¼ŸğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

### åä¸¤é¡¹ é…åˆ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

- et_target = et_html.xpath("//ul/li[position()>last()-2]")
- å¯ä»¥æ‰¾åˆ°åä¸¤é¡¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630554055572)

### å±æ€§æ˜¯å¦å­˜åœ¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630554130261)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

- et_target = et_html.xpath("//html[@lang]")
- et_target = et_html.xpath("//ul[@id]")
- et_target = et_html.xpath("//body[@class]")
- éƒ½å¯ä»¥è¯•è¯• ğŸ¤ª

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630554342781)

### å±æ€§å†…å®¹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630554498481)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630553027505)

- et_target = et_html.xpath("//html[@lang=\\"eng\\"]")
  - æ‰¾ä¸åˆ°
- et_target = et_html.xpath("//html[@lang=\\"zh-cn\\"]")
  - å¯ä»¥æ‰¾åˆ°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210902-1630554794130)

- et_target = et_html.xpath("//ul[@id=\"ulist\"]")
  - æ³¨æ„è¿™é‡Œçš„åŒå¼•å·éœ€è¦è½¬ä¹‰
  - å¯ä»¥è¯•è¯•

### æ€»ç»“

- è¿™æ¬¡æ·±å…¥äº† xpath çš„ç­›é€‰
  - å¯ä»¥ç”¨ä¸­æ‹¬å·ç´¢å¼•çš„æ–¹å¼å¯¹äºå­å…ƒç´ çš„ä½ç½®è¿›è¡Œç­›é€‰
    - ç¬¬ä¸€ä¸ª
      - xpath("//ul/li[1]")
    - æœ€åä¸€ä¸ª
      - xpath("//ul/li[last()]")
    - æ­£æ•°å‰ä¸‰ä¸ª
      - xpath("//ul/li[position()<=3]")
    - å€’æ•°ä¸¤ä¸ª
      - xpath("//ul/li[position()>last()-2"])
  - å¯ä»¥åœ¨ç´¢å¼•ä¸­å¯¹å±æ€§è¿›è¡Œç­›é€‰
    - @ ä¿—ç§°èŠ± a
    - å¯¹åº”@ttribute
    - å¯ä»¥æ‰¾å‡ºæ˜¯å¦æœ‰è¿™ä¸ªå±æ€§
      - et_html.xpath("@lang")
    - ä¹Ÿèƒ½æ‰¾åˆ°å…·ä½“å±æ€§çš„å€¼
      - et_html.xpath("@lang=\\"zh-cn\\"")
  - ä½ç½®ã€å±æ€§ç­›é€‰è¿˜å¯ä»¥é…åˆèŠ‚ç‚¹ç­›é€‰
    - et_target = et_html.xpath("//ul[@id=\\"ulist\\"]")
    - et_target = et_html.xpath("//ul/li[last()]")
- xpath çš„æ–‡æ¡£è¿˜æ²¡æœ‰åˆ·å®Œ
- è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´
