---
show: step
version: 1.0
enable_checker: true
---

# fastapi

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬ç ”ç©¶äº†è¯·æ±‚ä½“
- è¯·æ±‚ä½“
	- æ˜¯ä½¿ç”¨POSTæˆ–è€…PUTå‘é€åˆ°æœåŠ¡å™¨çš„jsonå­—å…¸å¯¹è±¡
	- å¯¹åº”ä¸€ä¸ªpythonç±»
- è¯·æ±‚ä½“å¯¹è±¡ä¹Ÿå¯ä»¥è®¾ç½®
	- æ•°æ®ç±»å‹
	- é»˜è®¤å€¼
- è¯·æ±‚ä½“å‘é€ç»™æœåŠ¡å™¨ä¹‹å
	- æœåŠ¡å™¨å¯ä»¥è¿›è¡Œå¤„ç†
	- å†è¿”å›ç»™æµè§ˆå™¨ä¸€ä¸ªjsonå¯¹è±¡
- è¯·æ±‚ä½“å¯ä»¥é…åˆ
	- è·¯å¾„å‚æ•°
	- æŸ¥è¯¢å‚æ•°

### å­—ç¬¦ä¸²å‚æ•°

```
from typing import Union

from fastapi import FastAPI

app = FastAPI()


@app.get("/items/")
async def read_items(q: Union[str, None] = None):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

- qæ˜¯
	- æŸ¥è¯¢å‚æ•°
	- å¯é€‰çš„
		- é»˜è®¤å€¼ä¸ºNone

- ç°åœ¨è¦å¢åŠ éªŒè¯
	- å­—ç¬¦ä¸²ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦

### å¼•å…¥QueryåŒ…


- æˆ‘ä»¬æŠŠé»˜è®¤å€¼None
	- æ¢æˆäº†Queryå‡½æ•°


```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: Union[str, None] = Query(default=None, max_length=50)):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

- æˆ‘ä»¬ä»ç„¶èƒ½è®¾ç½®é»˜è®¤å€¼
	- ç”¨Query(default=None)
- q çš„é»˜è®¤å€¼æ˜¯Query()å‡½æ•°çš„ç»“æœ
	- è¯´æ˜qæ˜¯ä¸€ä¸ªæŸ¥è¯¢å‚æ•°
	- å‡½æ•°Queryçš„é»˜è®¤å‚æ•°max_lengthä¸º50
		- éœ€è¦éªŒè¯max_lengthæœ€å¤§å®½åº¦ä¸º50
- é™¤äº†max_length
	- è¿˜å¯ä»¥æœ‰ä»€ä¹ˆå…¶å®ƒå‚æ•°å—ï¼Ÿ

### min_length

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(
    q: Union[str, None] = Query(default=None, min_length=3, max_length=50)
):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

- è¿˜å¯ä»¥è®¾ç½®min_length

### è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666271660472/wm)

- qçœŸçš„ç»™ä¸ªNoneçš„è¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666271685610)

- è¿”å›ç»“æœæ˜¯å­—å…¸
	- å…¶ä¸­çš„å­—å…¸é¡¹æ˜¯åˆ—è¡¨
	- åˆ—è¡¨çš„åˆ—è¡¨é¡¹æ˜¯å­—å…¸
- å¦‚æœqæ˜¯ç»™çš„å­—ç¬¦ä¸²
- ä½†æ˜¯é•¿åº¦ä¸º2
- ä¸æ»¡è¶³min_lengthå‘¢ï¼Ÿ

### min_length

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666271775522)

- å‰ç«¯éªŒè¯æ— æ³•é€šè¿‡
- ç›´æ¥æŠ¥é”™
- å¯ä»¥éªŒè¯å­—ç¬¦ä¸²çš„æ¨¡å¼å—ï¼Ÿ

### æ­£åˆ™éªŒè¯

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(
    q: Union[str, None] = Query(
        default=None, min_length=3, max_length=50, regex="^fixedquery$"
    )
):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

- regex="^fixedquery$"
	- ^
		- ä»¥è¯¥ç¬¦å·ä¹‹åçš„å­—ç¬¦å¼€å¤´
		- ç¬¦å·ä¹‹å‰æ²¡æœ‰å­—ç¬¦
	- fixedquery
		- å€¼ç²¾ç¡®åœ°ç­‰äº fixedquery
	- $
		- åˆ°æ­¤ç»“æŸ
		- åœ¨ fixedquery ä¹‹åæ²¡æœ‰æ›´å¤šå­—ç¬¦

### éªŒè¯æ­£åˆ™å¤±è´¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666272225337)

- ä¸æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼è¦æ±‚çš„è¯
- å‰ç«¯éªŒè¯å‡ºé—®é¢˜
- ç›´æ¥æŠ¥é”™
- ä¸ä¼šæäº¤åˆ°æœåŠ¡å™¨

### éªŒè¯æ­£åˆ™æˆåŠŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666272384273)

- æ­£ç¡®çš„å‚æ•°å¯ä»¥éªŒè¯æˆåŠŸ
- å‘é€è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨
- åç«¯æœåŠ¡å™¨è¿”å›jsonå¯¹è±¡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666272436015)

### é»˜è®¤éNoneå‚æ•°

```
from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: str = Query(default="fixedquery", min_length=3)):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

- å¯ä»¥ä¸ºqè®¾ç½®éNoneçš„é»˜è®¤å€¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666272660048)

### è®¾ç½®å¿…å¡«é¡¹

- å£°æ˜é»˜è®¤å€¼å¯ä»¥è®¾ç½®å‚æ•°ä¸ºå¯é€‰
	- q: str
	- q: Union[str, None] = Query(default=None, min_length=3)
- ä¸å£°æ˜é»˜è®¤å€¼å°±å¯ä»¥è®¾ç½®å‚æ•°ä¸ºå¿…å¡«
	- q: str = None
	- q: str = Query(min_length=3

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666274098345)

- è¿˜æœ‰ä¸€ç§æ˜¾å¼è¦æ±‚å‚æ•°ä¸ºå¿…å¡«é¡¹çš„æ–¹æ³•
	- ...
	- Ellipsis
	- çœç•¥å·

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666274301582)

### å¿…å¡«é¡¹ä½†æ˜¯é»˜è®¤ä¸ºNone

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: Union[str, None] = Query(default=..., min_length=3)):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

### ç”¨requiredä»£æ›¿...

```
from fastapi import FastAPI, Query
from pydantic import Required

app = FastAPI()


@app.get("/items/")
async def read_items(q: str = Query(default=Required, min_length=3)):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

### æŸ¥è¯¢å‚æ•°é‡Œåˆ—è¡¨

- åˆ—è¡¨å¯ä»¥æ¥å—å¤šä¸ªå€¼

```
from typing import List, Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: Union[List[str], None] = Query(default=None)):
    query_items = {"q": q}
    return query_items

```

- è®¿é—®http://localhost:8000/items/?q=foo&q=bar

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666274617717)

### å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨

```
from typing import List

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: List[str] = Query(default=["foo", "bar"])):
    query_items = {"q": q}
    return query_items
```

- python3.9ä¹‹åå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–

```
from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: list = Query(default=[])):
    query_items = {"q": q}
    return query_items
```

### è®¾ç½®éªŒè¯å‚æ•°çš„è¯´æ˜

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(
    q: Union[str, None] = Query(
        default=None,
        title="Query string",
        description="Query string for the items to search in the database that have a good match",
        min_length=3,
    )
):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results

```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666275014701)

### åˆ«å

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(q: Union[str, None] = Query(default=None, alias="item-query")):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```

-  æƒ³ç”¨ç²¾å‡†çš„item-query
-  ä½†è¿™ä¸ç¬¦åˆpythonçš„å°é©¼å³°é£æ ¼
-  æ‰€ä»¥å£°æ˜ä¸ªåˆ«å

### åºŸå¼ƒçš„

- deprecatedå°±æ˜¯åºŸå¼ƒçš„

```
from typing import Union

from fastapi import FastAPI, Query

app = FastAPI()


@app.get("/items/")
async def read_items(
    q: Union[str, None] = Query(
        default=None,
        alias="item-query",
        title="Query string",
        description="Query string for the items to search in the database that have a good match",
        min_length=3,
        max_length=50,
        regex="^fixedquery$",
        deprecated=True,
    )
):
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    if q:
        results.update({"q": q})
    return results
```


- ä½ ä¸å¾—ä¸å°†å…¶ä¿ç•™ä¸€æ®µæ—¶é—´
- å› ä¸ºæœ‰äº›å®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨å®ƒï¼Œä½†ä½ å¸Œæœ›æ–‡æ¡£æ¸…æ¥šåœ°å°†å…¶å±•ç¤ºä¸ºå·²å¼ƒç”¨ã€‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221020-1666275263355/wm)

### æ€»ç»“ğŸ¤”

- æˆ‘ä»¬å¯ä»¥å¯¹äºæŸ¥è¯¢å‚æ•°åšå‡ºéªŒè¯
	- alias
    - title
    - description
    - deprecated
- ç‰¹å®šäºå­—ç¬¦ä¸²çš„æ ¡éªŒï¼š
    - min_length
    - max_length
    - regex

- ä¸‹æ¬¡å†è¯´ğŸ‘‹