---
show: step
version: 1.0
enable_checker: true
---

# 列表 - 深拷贝 deepcopy

## 回忆

- 赋值的时候注意有两种情况
  - = 
	- 直接复制变量引用的地址
  - 拷贝 copy
	- 新建列表
	- 复制列表项的引用地址	
	- 但如果列表项 是列表
		- 就原样复制地址
		- 引用同一个位置

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221129-1669730371125)

- 想做 真正互不影响的copy副本
	- 无论列表维度如何
	- 都不互相影响
- 可能吗？🤔

### 查看文档

- help(list.copy)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221129-1669710271108)

- 目前的拷贝是一种shallow copy
	- 浅浅的拷贝
	- 只复制列表项具体引用的地址
	- 而不为新的容器重新申请新的内存空间
- 除了浅拷贝之外可以有深拷贝吗？

### 深拷贝

- 提问

![图片描述](https://doc.shiyanlou.com/courses/3584/labs/763913/uid1190679-20250115-1736931279815/wm) 


- 比较了 浅拷贝、深拷贝(deepcopy)
  - 浅拷贝 
	- 把原列表里面 列表项的引用 拷贝出来 
		- 做成新的 list 赋过去
		- 多维列表会导致引用到同一个地址空间
		- 一改全改
  - 深拷贝
    - 彻底复制 地址里面  每一个东西
    - 重新分配内存空间
    - 制作一个真正新的副本
    - 副本和原本彼此互不影响
- 观察试试深拷贝

### 具体操作

- 有深浅变化才有意思啊
	- 不同的拷贝类型

```
import copy
l1 = [["oeasy",[165,70]],["o2z",[170,100]]]
l2 = copy.deepcopy(l1)
l1[0][1][0] = 150
```

- 完全新申请的地址
	- 没有任何 复用地址

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20231205-1701786120254)

- 更高维度的列表呢？
	- 深拷贝 也能 制作 新副本 吗？

###  知深浅

```python
import copy
l1 = [1, [2, [3, 4, [5, 6]]]]
l2 = copy.deepcopy(l1)
```

- 这维度明显上去了
	- https://pythontutor.com/visualize.html#mode=edit

![图片描述](https://doc.shiyanlou.com/courses/3584/labs/763913/uid1190679-20250115-1736931815296) 

- 这么深的层次的话
	- 深拷贝都能一层层复制出来么？

### 深拷贝的威力

- 深拷贝确实很深

![图片描述](https://doc.shiyanlou.com/courses/3584/labs/763913/uid1190679-20250115-1736931842506/wm) 

- 所有列表项引用的地址 `都`不相同！


### 深浅拷贝总结

```
l2 = l1
```

- 等号赋值的 意思 是
	- 把对象地址 直接 赋给另一个对象

```
l2 = l1.copy
```


- 浅拷贝的意思是
  - 目标列表 拥有自己的 独立地址
  - 目标列表的列表项 也有独立地址
  - 但是目标列表的列表项引用的地址 还是原来的地址

```
l2 = copy.deepcopy(l1)
```

- 深拷贝的意思是
  - 完全为 各个层级 被复制的元素 新申请空间
  - 整个列表 是 新的
  - 和原来的列表 彻底无关

### 总结

- 三种 赋值的 情况 
  - = 
	- 直接 复制变量地址
  - 浅拷贝 
	- 新建列表
	- 复制 第一层列表项
  - 深拷贝 
	- 新申请空间
	- 彻底做一个新的副本
	- 把所有东西都复制出来
	- 这就是深拷贝所谓深的地方

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221129-1669712354030)


- 如果 是 多维列表的运算 呢？
	- 内存中的样子 是 如何的 呢？🤔
- 下次再说 👋


