---
show: step
version: 1.0
enable_checker: true
---

# 列表 - 切片 - 赋值 - assignment

## 回忆

- 上次研究的是del
	- 删除
	- 可以删除列表项
	- 也可以把一段切片择出去
- 就像择菜一样

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669113091247)

- del把不要的菜从列表里面剔除出去
- 择出去的菜就消失了吗？🤔

### 观察

- 去一个网站观察
	- https://pythontutor.com/visualize.html#mode=edit

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630203709851)

### 演示

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630208623942)

- 点击 Live Programming Mode
- 然后进入到实时编程模式

### 字符串运算

- 这种直接的计算
	- 并不能为内存中的变量赋值

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630209077502)

- 没有变量接收这些值
	- 这些值也就没有被任何变量引用
	- 这些值也就被垃圾回收了
- 在左边的帧(frames)的位置是空的
	- 现在尝试赋值

### 赋值

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630209062770)

- 有两个变量
	- s1 
	- s2
- 他俩 在 调用(call)栈(stack)的 帧(frame)上
	- 看得见了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220903-1662158505337)

- 可以用 prev 和 next 控制流程运行
- 数字型变量的情况呢？

### 数字变量

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630209240049)

- 数字变量
	- 也都能在帧栈空间上看见
	- 这些变量在帧栈空间上都有自己的位置

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220903-1662158557838)

- 那么列表 list 变量呢？

### 列表变量

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220903-1662163960956)

- 可以看到 l 变量在栈帧上有一个位置
- 或者说l 在 主程序的globals里面可见

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220706-1657092248699)

- 注意那条带箭头的线
	-  global frame 中 可见的 l
	-  l在帧栈上的位置为0536
	-  指向一个堆空间中 list对象
- 帧上只能看见 l 
	- 看不见 l[0] 、l[1]、l[2]等具体元素
	- 只能通过l[0]这种索引的方式来访问到l[0]
	- 得到l[0] 里面存着一个str 对象
	- 值为"刘备"

### 地址

- 帧上存着 l 的 引用的地址(id)
	- 也只能看见 l

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220903-1662164129442)

- l[0]、l[1]、l[2]是在堆(heap)申请的内存
	- 并且将引用(id) 存储在 l 中的列表项中
		- 可以用l来访问l[0]
		- 可以看到id(l[0]) 引用的就是 
			- "刘备" 在堆空间的地址
- 切片应该如何理解呢？

### 观察

- 切片

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630224932111)

- 切片切完了之后
	- 如果没有被赋给任何对象
		- 也就消失了
	- 但如果把切片信息给一个列表变量
		- 这个切片就保留下来了
- 修改切片会影响原始列表吗？

### 修改切片

- 新的切片有自己独立的存储空间

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669121650271)

- 对新切片对象的操作不影响原来的切片
- 那如何让列表能互相影响呢？

### 互相影响

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669123282969)

- 为啥l1、l2会相互影响？
- 因为这种赋值的方法
- 我们去看看变量具体的值

### id

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669123385853)

- 这两个变量名l1、l2指向的是同一个列表对象地址
- 所以不论谁append
- 都会append到这个列表上
- 我可以看到这个列表对象被引用的次数吗？

### getrefcount

- getrefcount可以得到 heap 中空间的对象
	- 到底由几个变量名进行引用



- 明明是 l1 1个变量引用啊
- 为什么显示为2呢？
	- 查看帮助

### 帮助手册

- 本来确实应该是1个
	- 但是由于这个函数调用的时候
	- 在函数内部还有一个参数变量也引用了这个位置
	- 所以会比想象地变量多 1

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210905-1630830139942)

- 引用数量变化

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669123647436)

- 这时候如果在把l1引用的地址再修改
	- 那[1, 2, 3]这个列表对象就没有人引用了
	- 系统垃圾回收装置就该回收他了
- 如果我想将 l2 做成 l1的副本
- 但是分别引用不同的地址空间
- 应该如何呢？


### copy 函数

- 所谓副本
	- 就是拷贝

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630210731635)

- 返回列表的浅拷贝
- shallow copy(浅拷贝)是什么意思？
	- 还不清楚
	- 难道还有深拷贝不成？
- 先了解什么是拷贝？

### copy

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220728-1658976784346)

- 这个单词源于中世纪时候抄写文字
	- 后来也表示胶片的拷贝
	- 制片公司其实卖的是拷贝
- 后来有了复印机指的是复印
	- 到了电脑时代
	- 复制文件就是cp(copy)
	- 具体来试试

### 验证

- 拷贝明白了
	- 两个列表分别的引用两个位置

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630210778781)

- 怎么确保这两个列表不指向同一个对象呢？

### 确保

- 观察id

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669124490608)

- 这两个列表确实id不同
- 只要id不同
- 引用的就是不同的地址空间
- 还有其他制作副本的方法吗？

### 制作副本方法2

- 使用list的构造函数
	- 根据l1再构造一个l2

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669124730716)

- 确实id不同
- 还有其他制作副本的方法吗？

### 制作副本的方法3

- 使用切片

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221122-1669124769593)

- 确实id也不同
- 目前我就想到这三种方法
- 你还有其他的方法么？

### 总结🤔
- 赋值运算
  - 直接用列表引用的地址赋值
	- 造成两个列表指向同一个对象
		- 一荣俱荣
		- 一损俱损
		- 所有操作都会作用到一个对象上
  - 如果将列表副本赋给变量
	- 这两个列表变量指向不同的对象
	- 互不影响
	- 制作副本的3种方法
		- copy拷贝
		- list构造
		- slice切片
- 赋值运算符号=很简单
	- 但是由于等号右边的对象不同
	- 还是有很多细节的
- 还有什么好玩的细节呢？
- 列表可以做加法吗？🤔
	- 比如l1 + l2

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221115-1668500786899)

- 下次再说 👋
