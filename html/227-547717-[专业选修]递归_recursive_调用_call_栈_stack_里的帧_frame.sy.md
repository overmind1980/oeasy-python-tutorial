---
show: step
version: 1.0
enable_checker: true
---

# åµŒå¥—è°ƒç”¨

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬äº†è§£äº†é€’å½’
	- é€’å½’å°±æ˜¯å‡½æ•°è‡ªå·±è°ƒç”¨è‡ªå·±
	- è¿™ç¡®å®å¾ˆæ–¹ä¾¿
- æœ‰ç‚¹åƒæ•°å­¦å½’çº³æ³•
	- ä¸€å±‚å±‚å¾€æºå¤´èµ°
	- ç›´åˆ°å¯ä»¥å¾—åˆ°è¿”å›å€¼çš„æœ€åˆä½ç½®
	- å°±æ˜¯å½’çº³å¼€å§‹çš„åœ°æ–¹
- è‡ªå·±è°ƒè‡ªå·±ä¹Ÿä¸æ˜¯æ— é™è°ƒç”¨çš„
	- æ”¶åˆ°å†…å­˜å¤§å°çš„é™åˆ¶
	- è¶…å‡ºäº†å‡½æ•°æ ˆä¼šæº¢å‡º(stack overflow)
- å‡½æ•°å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå‡½æ•°
- å‡½æ•°æ¥å—æ–°å‚æ•°numçš„æ—¶å€™
- åŸæ¥çš„å‚æ•°ä¸ºä»€ä¹ˆä¸æ¶ˆå¤±å‘¢ï¼Ÿ
- ä¸åº”è¯¥è¦†ç›–äº†ä¹ˆï¼ŸğŸ¤”

### æŸ¥çœ‹å¸§(frame)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175345924)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175351548)

- ç¡®å®æ˜¯4æ¬¡è°ƒç”¨
- æ¯ä¸€æ¬¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„frameå¯¹è±¡
- é‚£è¿™äº›frameå¯¹åº”çš„ä»£ç (code)å¯¹è±¡(object)æ˜¯ä¸€ä¸ªä¹ˆï¼Ÿ

### ä»£ç (code)å¯¹è±¡(object)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175522190)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175528768)

- è™½ç„¶æ˜¯4ä¸ªå¸§(frame)å¯¹è±¡
- ä½†æ˜¯å¯¹ç€åŒä¸€ä¸ªä»£ç (code)å¯¹è±¡(object)
- æ‰§è¡Œè¿˜æ˜¯å¾—åˆ°è¿™ä¸ªå‡½æ•°çš„ä»£ç (code)å¯¹è±¡(object)é‡Œé¢æ‰§è¡Œ
- å‡½æ•°æœ¬èº«æ²¡æœ‰å˜
- ä¸€æ ·çš„é€»è¾‘
- åªæ˜¯æ‰€åœ¨çš„å¸§(frame)ä¸åŒ
- ä¸åŒçš„å¸§ä¸Šå‚æ•°ä¸åŒ
- å‚æ•°ä¹Ÿèƒ½çœ‹åˆ°ä¹ˆï¼Ÿ

### å‚æ•° 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175750726)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661175763019)

- nç¡®å®æ˜¯4321
- å±‚å±‚æ·±å…¥
- èƒ½çœ‹åˆ°æ¯æ¬¡è°ƒç”¨æ—¶å †æ ˆçš„æ ·å­ä¹ˆï¼Ÿ

### æ„é€ ç»“æ„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220823-1661218690599)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220823-1661218698933)

### å›å¿†exec

- execæ˜¯ä¸€ä¸ªå†…å»º(builtin)å‡½æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220828-1661647171474)

- å¯ä»¥æŠŠä¼ é€’ç»™å‡½æ•°çš„å­—ç¬¦ä¸²
- ä½œä¸ºä¸€è¡Œpythonä»£ç æ¥æ‰§è¡Œ

### æ„é€ å †æ ˆ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176526886)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176533610)

- æ„é€ æˆåŠŸ
- æŸ¥çœ‹å…·ä½“å †æ ˆ

### å…·ä½“å †æ ˆ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176661905)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176673567)

- ç¡®å®æ˜¯åœ¨ä¸€å±‚å±‚å‹æ ˆ
- å‡½æ•°è°ƒç”¨(call)æ ˆ(stack)ä¸Šé¢çš„å¸§(frame)
- ç¡®å®æ˜¯ä¸€å±‚å±‚å¾€ä¸‹å‹æ ˆçš„
- å› ä¸ºè¿™æ˜¯æ ˆ(stack)è¿™ç§æ•°æ®ç»“æ„

### æœ€ç»ˆä»£ç 

```
import sys
def fact(n):
    print(n,"==============================")
    frame = sys._getframe()
    for i in range(5-n):
        s = ".f_back" * i
        s = "frame" + s
        print("n=",n,"--------",s)
        exec("print(" + s + ")")
    if n == 1:
        return 1
    else:
        return n * fact(n-1)


fact(4)
```

- exec("print(" + s + ")")
- æ‹¬å·é‡Œä¸‰ä¸ªä¸œè¥¿ç›¸åŠ 
- ä¸‰ä¸ªéƒ½æ˜¯å­—ç¬¦ä¸²
    - "print(" 
    -  s  
    - ")"


### åˆ†æç»“æœ

- æˆ‘ä»¬åªçœ‹è¢«æ‰§è¡Œçš„è¯­å¥
- æœ€å¼€å§‹çš„æ—¶å€™ï¼Œn=4æ—¶
    - print(frame)
    - è¾“å‡ºå½“å‰å¸§
- é€’å½’è¿›å»ä¹‹åï¼Œn=3æ—¶
   - print(frame)
	   - è¾“å‡ºå½“å‰å¸§
   - print(frame.f_back)
	  - è¾“å‡ºè¾“å‡ºè°ƒç”¨å½“å‰å¸§çš„ä¸€å¸§
   - å¯ä»¥çœ‹åˆ°è°ƒç”¨(call)æ ˆ(stack)å¾€é‡Œé¢å‹äº†ä¸€å¸§(frame)
- å†è¿›å»
	- å†å¾€æ ˆé‡Œé¢å‹ä¸€å¸§
- å†è¿›å»
	- å†å‹æ ˆ
- ç›´åˆ° n=1 
	- ä¸ç”¨å†å‹æ ˆ
- ä¸€æ¬¡å¼¹æ ˆè¿”å›

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220822-1661176673567)

### æ€»ç»“ 

- æˆ‘ä»¬è¿™æ¬¡çœ‹è§
- é€’å½’è°ƒç”¨çš„å‹(push)æ ˆ(stack)è¿‡ç¨‹
	- ä¸€å±‚å±‚å‹
	- å‹çš„æ˜¯å¸§(frame)
	- ä¸åŒçš„å¸§æœ‰ä¸åŒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡
- ä»£ç (code)å¯¹è±¡(object)å°±ä¸€ä¸ª
	- é€»è¾‘ä¸å˜
	- åå¤æ‰§è¡Œ
- èƒ½æ›´ç›´è§‚ä¸€ç‚¹ä¹ˆï¼ŸğŸ¤”
- æˆ‘ä»¬ä¸‹æ¬¡å†è¯´ğŸ‘‹
