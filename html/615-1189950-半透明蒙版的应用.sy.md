---
show: step
version: 1.0
enable_checker: true
---

# opencv

## å›å¿†

- ä¸Šæ¬¡è®¾ç½®äº†å„ç§æ¸å˜çš„æ•ˆæœ
	- å¯ä»¥æ§åˆ¶ç°åº¦çš„æ¸å˜
	- ä¹Ÿå¯ä»¥æ§åˆ¶å½©è‰²çš„æ¸å˜
	- è¿˜å¯ä»¥é…åˆæ»šåŠ¨æ¡åˆ¶ä½œæ¸å˜
- è¿˜èƒ½ç©ç‚¹ä»€ä¹ˆå‘¢ï¼ŸğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231104-1699092722813)



### è’™ç‰ˆæ©æ˜ é®ç½©çš„åº”ç”¨
```
import numpy as np        
import cv2                
img = cv2.imread("kun1.png")
print(img.shape)          
mask = np.zeros((305,483,1),np.uint8)                                        
mask[75:118,214:255,:] = 255
black = np.zeros((305,483,3),np.uint8)
final = cv2.add(img,black,mask=mask)
cv2.imshow("final",final) 
cv2.waitKey()             
cv2.destroyAllWindows()
```

### åœ†å½¢é®ç½©

```
#coding:utf-8
import cv2  
import numpy as np  
 
#è¯»å–å›¾ç‰‡ 
img = cv2.imread("/usr/local/support/lena.png", cv2.IMREAD_GRAYSCALE)

#è·å–å›¾åƒå®½å’Œé«˜
rows, cols = img.shape[:2]
print(rows, cols)

#ç”»åœ†å½¢
circle = np.zeros((rows, cols), dtype="uint8")
cv2.circle(circle, (int(rows/2.0), int(cols/2)), 80, 255, -1)
print(circle.shape)
print(img.size, circle.size)

#OpenCVå›¾åƒä¸è¿ç®—
result = cv2.bitwise_and(img, circle)

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("original", img)
cv2.imshow("circle", circle)
cv2.imshow("result", result)

#ç­‰å¾…æ˜¾ç¤º
cv2.waitKey(0)
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240219-1708341138008)

### å¾„å‘æ¸å˜å›¾å±‚è’™ç‰ˆ

```
import cv2
import numpy as np
import math

#è·å–å›¾åƒå®½å’Œé«˜
img = cv2.imread("lena.png", cv2.IMREAD_GRAYSCALE)
rows, cols = img.shape[:2]

def draw_gradient(pos_x,pos_y,radius,image):
    for x in range(0,cols):
        for y in range(rows):
            dx = abs(x - pos_x)
            dy = abs(y - pos_y)
            dis = (dy**2 + dx**2) ** 0.5
            if dis < radius:
                color = dis / radius * 255
                color = 255 - int(color)
                image[y,x] = color

#ç”»åœ†å½¢

mask = np.zeros((rows, cols), dtype="uint8")
draw_gradient(int(rows/2.0), int(cols/2), 80, mask)

#OpenCVå›¾åƒä¸è¿ç®—
result = np.zeros((rows, cols), dtype="uint8")
for x in range(cols):
    for y in range(rows):
        result[y, x] = int ( mask[y,x]/255* img[y,x])

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("original", img)
cv2.imshow("mask", mask)
cv2.imshow("result", result)

#ç­‰å¾…æ˜¾ç¤º
cv2.waitKey(0)
cv2.destroyAllWindows()
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240219-1708342462024)

- è¿™ä¸ªè’™ç‰ˆå¯ä»¥åº”ç”¨å—ï¼Ÿ

### è’™ç‰ˆåº”ç”¨

```
import cv2
import numpy as np
import math

#è·å–å›¾åƒå®½å’Œé«˜
img = cv2.imread("lena.png", cv2.IMREAD_GRAYSCALE)
rows, cols = img.shape[:2]

def draw_gradient(pos_x,pos_y,radius,image):
    for x in range(0,cols):
        for y in range(rows):
            dx = abs(x - pos_x)
            dy = abs(y - pos_y)
            dis = (dy**2 + dx**2) ** 0.5
            if dis < radius:
                color = dis / radius * 255
                color = 255 - int(color)
                image[y,x] = color

#ç”»åœ†å½¢
img2 = cv2.imread("gear.jpg", cv2.IMREAD_GRAYSCALE)
mask = np.zeros((rows, cols), dtype="uint8")
draw_gradient(int(rows/2.0), int(cols/2), 80, mask)

#OpenCVå›¾åƒä¸è¿ç®—
result = img2
rows, cols = img2.shape[:2]
dy = 100
dx = 100
for x in range(cols):
    for y in range(rows):
        percent = mask[y+dy,x+dx] / 255
        result2[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("original", img)
cv2.imshow("mask", mask)
cv2.imshow("result", result)

#ç­‰å¾…æ˜¾ç¤º
cv2.waitKey(0)
cv2.destroyAllWindows()
```

- æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240219-1708352456668)

- å¯ä»¥å¯¹æ¯” è½¯ç¡¬è’™ç‰ˆçš„æ•ˆæœçš„ä¸åŒå—ï¼Ÿ

### ä¸¤ç§è’™ç‰ˆ

```
import cv2
import numpy as np
import math

#è·å–å›¾åƒå®½å’Œé«˜
img = cv2.imread("lena.png", cv2.IMREAD_GRAYSCALE)
rows, cols = img.shape[:2]

def draw_gradient(pos_x,pos_y,radius,image):
    for x in range(0,cols):
        for y in range(rows):
            dx = abs(x - pos_x)
            dy = abs(y - pos_y)
            dis = (dy**2 + dx**2) ** 0.5
            if dis < radius:
                color = dis / radius * 255
                color = 255 - int(color)
                image[y,x] = color

#ç”»åœ†å½¢
img2 = cv2.imread("gear.jpg", cv2.IMREAD_GRAYSCALE)
mask = np.zeros((rows, cols), dtype="uint8")
draw_gradient(int(rows/2.0), int(cols/2), 80, mask)

#OpenCVå›¾åƒä¸è¿ç®—
result = img2
dest_rows, dest_cols = img2.shape[:2]
dy = 100
dx = 100
for x in range(dest_cols):
    for y in range(dest_rows):
        percent = mask[y+dy,x+dx] / 255
        result2[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("result", result)

result2 = img2
mask = np.zeros((rows,cols),dtype="uint8")
mask = cv2.circle(mask,(int(rows/2),int(cols/2)),80,255,-1)
cv2.imshow("mask", mask)
for x in range(dest_cols):
    for y in range(dest_rows):
        percent = mask[y+dy,x+dx] / 255
        result2[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("result2", result2)


#ç­‰å¾…æ˜¾ç¤º
cv2.waitKey(0)
cv2.destroyAllWindows()
```

- å¯ä»¥åšä¸€ä¸ªæ»‘å—çœ‹æ•ˆæœå—ï¼Ÿ

### æ»‘å—æ•ˆæœ

```
import cv2
import numpy as np
import math

#è·å–å›¾åƒå®½å’Œé«˜
img = cv2.imread("lena.png", cv2.IMREAD_GRAYSCALE)
rows, cols = img.shape[:2]

def draw_gradient(pos_x,pos_y,radius,image):
    for x in range(0,cols):
        for y in range(rows):
            dx = abs(x - pos_x)
            dy = abs(y - pos_y)
            dis = (dy**2 + dx**2) ** 0.5
            if dis < radius:
                color = dis / radius * 255
                color = 255 - int(color)
                image[y,x] = color

#ç”»åœ†å½¢
img2 = cv2.imread("gear.jpg", cv2.IMREAD_GRAYSCALE)
mask = np.zeros((rows, cols), dtype="uint8")
draw_gradient(int(rows/2.0), int(cols/2), 80, mask)

#OpenCVå›¾åƒä¸è¿ç®—
result = img2
dest_rows, dest_cols = img2.shape[:2]
dy = 100
dx = 100
for x in range(dest_cols):
    for y in range(dest_rows):
        result[y, x] = int ( mask[y+dy,x+dx]/255* img[y+dy,x+dx]) + img2[y,x]

#æ˜¾ç¤ºå›¾åƒ
def callback(value):
    dx = value
    img2 = cv2.imread("gear.jpg", cv2.IMREAD_GRAYSCALE)
    mask = np.zeros((rows, cols), dtype="uint8")
    draw_gradient(int(rows/2.0), int(cols/2), 80, mask)
    for x in range(dest_cols):
        for y in range(dest_rows):
            percent = mask[y+dy,x+dx] / 255
            result[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])
    cv2.imshow("result", result)

def callback2(value):
    dx = value
    img2 = cv2.imread("gear.jpg", cv2.IMREAD_GRAYSCALE)
    mask = np.zeros((rows, cols), dtype="uint8")
    mask = cv2.circle(mask,(int(rows/2),int(cols/2)),80,255,-1)
    for x in range(dest_cols):
        for y in range(dest_rows):
            percent = mask[y+dy,x+dx] / 255
            result2[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])
    cv2.imshow("result2", result2)

result2 = img2.copy()
cv2.imshow("result", result)
cv2.createTrackbar('x', 'result', 0, 100, callback)
mask = np.zeros((rows,cols),dtype="uint8")
mask = cv2.circle(mask,(int(rows/2),int(cols/2)),80,255,-1)
for x in range(dest_cols):
    for y in range(dest_rows):
        percent = mask[y+dy,x+dx] / 255
        result2[y, x] = int(percent*img[y+dy,x+dx] + (1-percent)*img2[y,x])

#æ˜¾ç¤ºå›¾åƒ
cv2.imshow("result2", result2)
cv2.createTrackbar('x', 'result2', 0, 100, callback2)


#ç­‰å¾…æ˜¾ç¤º
cv2.waitKey(0)
cv2.destroyAllWindows()
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240219-1708354995472)

- å¯ä»¥æ§åˆ¶x
- å¯ä»¥æ§åˆ¶yï¼Œradiusæˆ–è€…è’™ç‰ˆçš„ç¡¬åº¦å—ï¼Ÿ

### æ€»ç»“ ğŸ¤”
- è¿™æ¬¡äº†è§£äº† è’™ç‰ˆçš„ç”¨æ³•
	- å¯ä»¥æ§åˆ¶è’™ç‰ˆçš„ 
		- ä½ç½®
		- è½¯ç¡¬
		- åŠå¾„
		- å½¢çŠ¶
- è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„å—ï¼Ÿ
- ä¸‹æ¬¡å†è¯´ğŸ‘‹